{"decls":[{"kind":"export","names":["http_auth_goldens.access_token_in_query_400","http_auth_goldens.insufficient_scope_403","http_auth_goldens.missing_authorization_401","http_auth_goldens.prm_200"]},{"body":["begin",["if",["<","map_off",0],["return","fallback"],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return","fallback"],0],["if",["!=",["ext.data_model.kind_at","doc","off"],1],["return","fallback"],0],["ext.data_model.bool_get","doc","off"]],"kind":"defn","name":"http_auth_goldens._map_bool_or_default_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"},{"name":"fallback","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<","map_off",0],["return",["bytes.alloc",0]],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","off"],2],["return",["bytes.alloc",0]],0],["ext.data_model.number_get","doc","off"]],"kind":"defn","name":"http_auth_goldens._map_number_text_or_empty_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<","map_off",0],["return",-1],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return",-1],0],["if",["!=",["ext.data_model.kind_at","doc","off"],5],["return",-1],0],"off"],"kind":"defn","name":"http_auth_goldens._map_obj_off_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<","map_off",0],["return",["bytes.alloc",0]],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","off"],3],["return",["bytes.alloc",0]],0],["ext.data_model.string_get","doc","off"]],"kind":"defn","name":"http_auth_goldens._map_string_or_empty_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","cfg_path",["bytes.lit","../mcp.server.json"]],["let","router_res",["ext.mcp.server.make_router_from_fs_v1",["bytes.view","cfg_path"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","router_res"],0,5301]],["let","router",["result_bytes.unwrap_or","router_res",["bytes.alloc",0]]],["let","req_json",["bytes.lit","{\"method\":\"POST\",\"path\":\"/mcp?access_token=BAD\",\"headers\":{\"Origin\":\"http://localhost:3000\",\"Accept\":\"application/json, text/event-stream\",\"Content-Type\":\"application/json\",\"MCP-Protocol-Version\":\"2025-11-25\"},\"body_json\":{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"initialize\",\"params\":{\"protocolVersion\":\"2025-11-25\",\"capabilities\":{}}}}"]],["let","resp_res",["ext.mcp.server.dispatch_http_v1","router",["bytes.view","req_json"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","resp_res"],0,5302]],["let","resp_json",["result_bytes.unwrap_or","resp_res",["bytes.alloc",0]]],["try",["std.test.assert_i32_eq",[">",["bytes.len",["bytes.view","resp_json"]],0],1,5303]],["let","doc_b",["ext.json.data_model.parse",["bytes.view","resp_json"]]],["let","doc",["bytes.view","doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","doc"],0,5304]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","doc"],5,5305]],["let","root",["ext.data_model.root_offset","doc"]],["let","k_status",["bytes.lit","status"]],["let","status_txt",["http_auth_goldens._map_number_text_or_empty_v1","doc","root",["bytes.view","k_status"]]],["let","want_400",["bytes.lit","400"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","status_txt"],["bytes.view","want_400"]],1,5306]],["let","k_body_empty",["bytes.lit","body_empty"]],["let","body_empty",["http_auth_goldens._map_bool_or_default_v1","doc","root",["bytes.view","k_body_empty"],-1]],["try",["std.test.assert_i32_eq","body_empty",1,5307]],["let","k_body_json",["bytes.lit","body_json"]],["let","body_json_off",["http_auth_goldens._map_obj_off_v1","doc","root",["bytes.view","k_body_json"]]],["try",["std.test.assert_i32_eq","body_json_off",-1,5308]],["std.test.pass"]],"kind":"defn","name":"http_auth_goldens.access_token_in_query_400","params":[],"result":"result_i32"},{"body":["begin",["let","cfg_path",["bytes.lit","../mcp.server.json"]],["let","router_res",["ext.mcp.server.make_router_from_fs_v1",["bytes.view","cfg_path"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","router_res"],0,5401]],["let","router",["result_bytes.unwrap_or","router_res",["bytes.alloc",0]]],["let","req_json",["bytes.lit","{\"method\":\"POST\",\"path\":\"/mcp\",\"headers\":{\"Origin\":\"http://localhost:3000\",\"Accept\":\"application/json, text/event-stream\",\"Content-Type\":\"application/json\",\"MCP-Protocol-Version\":\"2025-11-25\",\"Authorization\":\"Bearer TOKEN_TOOLS\"},\"body_json\":{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tasks/list\",\"params\":{}}}"]],["let","resp_res",["ext.mcp.server.dispatch_http_v1","router",["bytes.view","req_json"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","resp_res"],0,5402]],["let","resp_json",["result_bytes.unwrap_or","resp_res",["bytes.alloc",0]]],["try",["std.test.assert_i32_eq",[">",["bytes.len",["bytes.view","resp_json"]],0],1,5403]],["let","doc_b",["ext.json.data_model.parse",["bytes.view","resp_json"]]],["let","doc",["bytes.view","doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","doc"],0,5404]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","doc"],5,5405]],["let","root",["ext.data_model.root_offset","doc"]],["let","k_status",["bytes.lit","status"]],["let","status_txt",["http_auth_goldens._map_number_text_or_empty_v1","doc","root",["bytes.view","k_status"]]],["let","want_403",["bytes.lit","403"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","status_txt"],["bytes.view","want_403"]],1,5406]],["let","k_body_empty",["bytes.lit","body_empty"]],["let","body_empty",["http_auth_goldens._map_bool_or_default_v1","doc","root",["bytes.view","k_body_empty"],-1]],["try",["std.test.assert_i32_eq","body_empty",1,5407]],["let","k_headers",["bytes.lit","headers"]],["let","headers_off",["http_auth_goldens._map_obj_off_v1","doc","root",["bytes.view","k_headers"]]],["try",["std.test.assert_i32_eq",[">=","headers_off",0],1,5408]],["let","k_www",["bytes.lit","WWW-Authenticate"]],["let","www",["http_auth_goldens._map_string_or_empty_v1","doc","headers_off",["bytes.view","k_www"]]],["let","want_www",["bytes.lit","Bearer resource_metadata=\"http://127.0.0.1:8080/.well-known/oauth-protected-resource/mcp\", scope=\"mcp:tasks\", error=\"insufficient_scope\""]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","www"],["bytes.view","want_www"]],1,5409]],["std.test.pass"]],"kind":"defn","name":"http_auth_goldens.insufficient_scope_403","params":[],"result":"result_i32"},{"body":["begin",["let","cfg_path",["bytes.lit","../mcp.server.json"]],["let","router_res",["ext.mcp.server.make_router_from_fs_v1",["bytes.view","cfg_path"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","router_res"],0,5201]],["let","router",["result_bytes.unwrap_or","router_res",["bytes.alloc",0]]],["let","req_json",["bytes.lit","{\"method\":\"POST\",\"path\":\"/mcp\",\"headers\":{\"Origin\":\"http://localhost:3000\",\"Accept\":\"application/json, text/event-stream\",\"Content-Type\":\"application/json\",\"MCP-Protocol-Version\":\"2025-11-25\"},\"body_json\":{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"initialize\",\"params\":{\"protocolVersion\":\"2025-11-25\",\"capabilities\":{}}}}"]],["let","resp_res",["ext.mcp.server.dispatch_http_v1","router",["bytes.view","req_json"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","resp_res"],0,5202]],["let","resp_json",["result_bytes.unwrap_or","resp_res",["bytes.alloc",0]]],["try",["std.test.assert_i32_eq",[">",["bytes.len",["bytes.view","resp_json"]],0],1,5203]],["let","doc_b",["ext.json.data_model.parse",["bytes.view","resp_json"]]],["let","doc",["bytes.view","doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","doc"],0,5204]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","doc"],5,5205]],["let","root",["ext.data_model.root_offset","doc"]],["let","k_status",["bytes.lit","status"]],["let","status_txt",["http_auth_goldens._map_number_text_or_empty_v1","doc","root",["bytes.view","k_status"]]],["let","want_401",["bytes.lit","401"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","status_txt"],["bytes.view","want_401"]],1,5206]],["let","k_body_empty",["bytes.lit","body_empty"]],["let","body_empty",["http_auth_goldens._map_bool_or_default_v1","doc","root",["bytes.view","k_body_empty"],-1]],["try",["std.test.assert_i32_eq","body_empty",1,5207]],["let","k_headers",["bytes.lit","headers"]],["let","headers_off",["http_auth_goldens._map_obj_off_v1","doc","root",["bytes.view","k_headers"]]],["try",["std.test.assert_i32_eq",[">=","headers_off",0],1,5208]],["let","k_www",["bytes.lit","WWW-Authenticate"]],["let","www",["http_auth_goldens._map_string_or_empty_v1","doc","headers_off",["bytes.view","k_www"]]],["let","want_www",["bytes.lit","Bearer resource_metadata=\"http://127.0.0.1:8080/.well-known/oauth-protected-resource/mcp\", scope=\"mcp:tools\""]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","www"],["bytes.view","want_www"]],1,5209]],["std.test.pass"]],"kind":"defn","name":"http_auth_goldens.missing_authorization_401","params":[],"result":"result_i32"},{"body":["begin",["let","cfg_path",["bytes.lit","../mcp.server.json"]],["let","router_res",["ext.mcp.server.make_router_from_fs_v1",["bytes.view","cfg_path"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","router_res"],0,5101]],["let","router",["result_bytes.unwrap_or","router_res",["bytes.alloc",0]]],["let","req_json",["bytes.lit","{\"method\":\"GET\",\"path\":\"/.well-known/oauth-protected-resource/mcp\",\"headers\":{\"Origin\":\"http://localhost:3000\",\"Accept\":\"application/json\"}}"]],["let","resp_res",["ext.mcp.server.dispatch_http_v1","router",["bytes.view","req_json"]]],["try",["std.test.assert_i32_eq",["result_bytes.err_code","resp_res"],0,5102]],["let","resp_json",["result_bytes.unwrap_or","resp_res",["bytes.alloc",0]]],["try",["std.test.assert_i32_eq",[">",["bytes.len",["bytes.view","resp_json"]],0],1,5103]],["let","doc_b",["ext.json.data_model.parse",["bytes.view","resp_json"]]],["let","doc",["bytes.view","doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","doc"],0,5104]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","doc"],5,5105]],["let","root",["ext.data_model.root_offset","doc"]],["let","k_status",["bytes.lit","status"]],["let","status_txt",["http_auth_goldens._map_number_text_or_empty_v1","doc","root",["bytes.view","k_status"]]],["let","want_200",["bytes.lit","200"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","status_txt"],["bytes.view","want_200"]],1,5106]],["let","k_body_empty",["bytes.lit","body_empty"]],["let","body_empty",["http_auth_goldens._map_bool_or_default_v1","doc","root",["bytes.view","k_body_empty"],-1]],["try",["std.test.assert_i32_eq","body_empty",0,5107]],["let","k_headers",["bytes.lit","headers"]],["let","headers_off",["http_auth_goldens._map_obj_off_v1","doc","root",["bytes.view","k_headers"]]],["try",["std.test.assert_i32_eq",[">=","headers_off",0],1,5108]],["let","k_ct",["bytes.lit","Content-Type"]],["let","ct",["http_auth_goldens._map_string_or_empty_v1","doc","headers_off",["bytes.view","k_ct"]]],["let","want_ct",["bytes.lit","application/json"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","ct"],["bytes.view","want_ct"]],1,5109]],["let","k_body_json",["bytes.lit","body_json"]],["let","body_json_off",["http_auth_goldens._map_obj_off_v1","doc","root",["bytes.view","k_body_json"]]],["try",["std.test.assert_i32_eq",[">=","body_json_off",0],1,5110]],["let","k_resource",["bytes.lit","resource"]],["let","resource",["http_auth_goldens._map_string_or_empty_v1","doc","body_json_off",["bytes.view","k_resource"]]],["let","want_resource",["bytes.lit","http://127.0.0.1:8080/mcp"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","resource"],["bytes.view","want_resource"]],1,5111]],["std.test.pass"]],"kind":"defn","name":"http_auth_goldens.prm_200","params":[],"result":"result_i32"}],"imports":["ext.data_model","ext.json.data_model","ext.mcp.server","std.test"],"kind":"module","module_id":"http_auth_goldens","schema_version":"x07.x07ast@0.5.0"}
