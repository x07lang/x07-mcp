{"decls":[{"kind":"export","names":["mcp.user.call_tool_v1"]},{"body":["begin",["let","diag",["std.mcp.diag.code_invalid_args_v1"]],["let","detail",["bytes.lit","{}"]],["std.mcp.tool.result.err_v1",["bytes.view","diag"],["bytes.view","human_text_utf8"],["bytes.view","detail"]]],"kind":"defn","name":"mcp.user._err_invalid_args_v1","params":[{"name":"human_text_utf8","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","st",["std.parse.i32_status_le","b"]],["if",["if",[">=u",["bytes.len","st"],5],["=",["bytes.get_u8","st",0],1],0],["codec.read_u32_le","st",1],-1]],"kind":"defn","name":"mcp.user._parse_i32_or_neg1_v1","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","args_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","invalid arguments JSON"]]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","arguments must be an object"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_text",["bytes.lit","text"]],["let","text_off",["ext.data_model.map_find","doc","root",["bytes.view","k_text"]]],["if",["if",["<","text_off",0],1,["!=",["ext.data_model.kind_at","doc","text_off"],3]],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","missing text argument"]]],0],["let","text",["ext.data_model.string_get","doc","text_off"]],["std.mcp.tool.result.ok_text_v1",["bytes.view","text"]]],"kind":"defn","name":"mcp.user._tool_echo_v1","params":[{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["std.mcp.toolkit.toolctx.resources_notify_updated_v1","ctx_json",["bytes.lit","about:example"]],["std.mcp.tool.result.ok_text_v1",["bytes.view",["bytes.lit","bumped"]]]],"kind":"defn","name":"mcp.user._tool_hello_bump_resource_v1","params":[{"name":"ctx_json","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","steps",3],["let","doc_b",["ext.json.data_model.parse","args_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],0,["begin",["if",["=",["ext.data_model.root_kind","doc"],5],["begin",["let","root",["ext.data_model.root_offset","doc"]],["let","k_steps",["bytes.lit","steps"]],["let","steps_off",["ext.data_model.map_find","doc","root",["bytes.view","k_steps"]]],["if",["if",["<","steps_off",0],1,["!=",["ext.data_model.kind_at","doc","steps_off"],2]],0,["begin",["let","raw",["ext.data_model.number_get","doc","steps_off"]],["let","v",["mcp.user._parse_i32_or_neg1_v1",["bytes.view","raw"]]],["if",[">","v",0],["set","steps","v"],0],0]],0],0],0]],["let","empty",["bytes.alloc",0]],["for","i",0,"steps",["begin",["std.mcp.toolkit.toolctx.progress_emit_v1","ctx_json",["+","i",1],"steps",["bytes.view","empty"]],0]],["std.mcp.tool.result.ok_text_v1",["bytes.view",["bytes.lit","done"]]]],"kind":"defn","name":"mcp.user._tool_hello_work_v1","params":[{"name":"ctx_json","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","args_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","invalid arguments JSON"]]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","arguments must be an object"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_path",["bytes.lit","path"]],["let","path_off",["ext.data_model.map_find","doc","root",["bytes.view","k_path"]]],["if",["if",["<","path_off",0],1,["!=",["ext.data_model.kind_at","doc","path_off"],3]],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","missing path argument"]]],0],["let","path",["ext.data_model.string_get","doc","path_off"]],["let","max_bytes",64],["let","k_max",["bytes.lit","max_bytes"]],["let","max_off",["ext.data_model.map_find","doc","root",["bytes.view","k_max"]]],["if",["if",["<","max_off",0],1,["!=",["ext.data_model.kind_at","doc","max_off"],2]],0,["begin",["let","raw",["ext.data_model.number_get","doc","max_off"]],["let","v",["mcp.user._parse_i32_or_neg1_v1",["bytes.view","raw"]]],["if",[">","v",0],["set","max_bytes","v"],0]]],["let","file",["std.fs.read",["bytes.view","path"]]],["let","n",["bytes.len","file"]],["let","take",["if",["<","max_bytes","n"],"max_bytes","n"]],["let","preview",["bytes.slice","file",0,"take"]],["let","hex",["ext.hex.hex_encode",["bytes.view","preview"]]],["let","pfx",["bytes.lit","hex:"]],["let","text",["std.bytes.concat",["bytes.view","pfx"],["bytes.view","hex"]]],["std.mcp.tool.result.ok_text_v1",["bytes.view","text"]]],"kind":"defn","name":"mcp.user._tool_read_file_preview_v1","params":[{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","args_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","invalid arguments JSON"]]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","arguments must be an object"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_a",["bytes.lit","a"]],["let","k_b",["bytes.lit","b"]],["let","a_off",["ext.data_model.map_find","doc","root",["bytes.view","k_a"]]],["let","b_off",["ext.data_model.map_find","doc","root",["bytes.view","k_b"]]],["if",["if",["if",["<","a_off",0],1,["!=",["ext.data_model.kind_at","doc","a_off"],2]],1,["if",["<","b_off",0],1,["!=",["ext.data_model.kind_at","doc","b_off"],2]]],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","expected numeric a and b arguments"]]],0],["let","a_raw",["ext.data_model.number_get","doc","a_off"]],["let","b_raw",["ext.data_model.number_get","doc","b_off"]],["let","a",["mcp.user._parse_i32_or_neg1_v1",["bytes.view","a_raw"]]],["let","b",["mcp.user._parse_i32_or_neg1_v1",["bytes.view","b_raw"]]],["if",["if",["<","a",0],1,["<","b",0]],["return",["mcp.user._err_invalid_args_v1",["bytes.lit","expected integer a and b arguments"]]],0],["let","sum",["+","a","b"]],["let","out",["std.fmt.s32_to_dec","sum"]],["std.mcp.tool.result.ok_text_v1",["bytes.view","out"]]],"kind":"defn","name":"mcp.user._tool_sum_v1","params":[{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","t_echo",["bytes.lit","echo"]],["let","t_sum",["bytes.lit","sum"]],["let","t_read",["bytes.lit","read_file_preview"]],["let","t_work",["bytes.lit","hello.work"]],["let","t_bump",["bytes.lit","hello.bump_resource"]],["if",["=",["bytes.eq","tool_name",["bytes.view","t_echo"]],1],["return",["mcp.user._tool_echo_v1","args_json"]],0],["if",["=",["bytes.eq","tool_name",["bytes.view","t_sum"]],1],["return",["mcp.user._tool_sum_v1","args_json"]],0],["if",["=",["bytes.eq","tool_name",["bytes.view","t_read"]],1],["return",["mcp.user._tool_read_file_preview_v1","args_json"]],0],["if",["=",["bytes.eq","tool_name",["bytes.view","t_work"]],1],["return",["mcp.user._tool_hello_work_v1","ctx_json","args_json"]],0],["if",["=",["bytes.eq","tool_name",["bytes.view","t_bump"]],1],["return",["mcp.user._tool_hello_bump_resource_v1","ctx_json","args_json"]],0],["mcp.user._err_invalid_args_v1",["bytes.lit","unknown tool"]]],"kind":"defn","name":"mcp.user.call_tool_v1","params":[{"name":"tool_name","ty":"bytes_view"},{"name":"ctx_json","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.hex","ext.json.data_model","std.bytes","std.fmt","std.fs","std.mcp.diag","std.mcp.tool.result","std.mcp.toolkit.toolctx","std.parse"],"kind":"module","module_id":"mcp.user","schema_version":"x07.x07ast@0.5.0"}
