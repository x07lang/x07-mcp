{"decls":[{"kind":"export","names":["app.solve"]},{"body":["option_bytes.unwrap_or",["ext.cli.matches_get","doc","key",3],["bytes.alloc",0]],"kind":"defn","name":"app._arg_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","entries",["std.vec.with_capacity",["+",4,["view.len","payload"]]]],["let","count_b",["codec.write_u32_le","count"]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","count_b"]]],["set","entries",["std.vec.extend_bytes","entries","payload"]],["let","entries_b",["std.vec.as_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"app._dm_map_from_payload_v1","params":[{"name":"count","ty":"i32"},{"name":"payload","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","key_len_b",["codec.write_u32_le",["view.len","key"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","key_len_b"]]],["set","payload",["std.vec.extend_bytes","payload","key"]],["let","value_len_b",["codec.write_u32_le",["view.len","value"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","value_len_b"]]],["set","payload",["std.vec.extend_bytes","payload","value"]],"payload"],"kind":"defn","name":"app._dm_payload_push_entry_v1","params":[{"name":"payload","ty":"vec_u8"},{"name":"key","ty":"bytes_view"},{"name":"value","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","len_b",["codec.write_u32_le",["view.len","value"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","len_b"]]],["set","payload",["std.vec.extend_bytes","payload","value"]],"payload"],"kind":"defn","name":"app._dm_payload_push_value_v1","params":[{"name":"payload","ty":"vec_u8"},{"name":"value","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","x7sl",["std.text.ascii.split_lines_view","text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","payload",["std.vec.with_capacity",0]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","text","x7sl_v","i"]],["let","val",["ext.data_model.value_string","line"]],["set","payload",["app._dm_payload_push_value_v1","payload",["bytes.view","val"]]],["set","i",["+","i",1]],0]],["let","payload_b",["std.vec.as_bytes","payload"]],["app._dm_seq_from_payload_v1","n",["bytes.view","payload_b"]]],"kind":"defn","name":"app._dm_seq_from_lines_text_v1","params":[{"name":"text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","elems",["std.vec.with_capacity",["+",4,["view.len","payload"]]]],["let","count_b",["codec.write_u32_le","count"]],["set","elems",["std.vec.extend_bytes","elems",["bytes.view","count_b"]]],["set","elems",["std.vec.extend_bytes","elems","payload"]],["let","elems_b",["std.vec.as_bytes","elems"]],["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],"kind":"defn","name":"app._dm_seq_from_payload_v1","params":[{"name":"count","ty":"i32"},{"name":"payload","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","created_val",["app._dm_seq_from_lines_text_v1","created_text"]],["let","steps_val",["app._dm_seq_from_lines_text_v1","steps_text"]],["let","entries_payload",["std.vec.with_capacity",0]],["let","entries_count",0],["let","k_ok",["bytes.lit","ok"]],["let","k_created",["bytes.lit","created"]],["let","k_next_steps",["bytes.lit","next_steps"]],["let","k_error",["bytes.lit","error"]],["let","k_message",["bytes.lit","message"]],["let","v_ok",["ext.data_model.value_bool","ok"]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_ok"],["bytes.view","v_ok"]]],["set","entries_count",["+","entries_count",1]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_created"],["bytes.view","created_val"]]],["set","entries_count",["+","entries_count",1]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_next_steps"],["bytes.view","steps_val"]]],["set","entries_count",["+","entries_count",1]],["if",[">",["view.len","error_msg"],0],["begin",["let","err_payload",["std.vec.with_capacity",0]],["let","v_message",["ext.data_model.value_string","error_msg"]],["set","err_payload",["app._dm_payload_push_entry_v1","err_payload",["bytes.view","k_message"],["bytes.view","v_message"]]],["let","err_payload_b",["std.vec.as_bytes","err_payload"]],["let","err_map",["app._dm_map_from_payload_v1",1,["bytes.view","err_payload_b"]]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_error"],["bytes.view","err_map"]]],["set","entries_count",["+","entries_count",1]]],0],["let","entries_payload_b",["std.vec.as_bytes","entries_payload"]],["let","root_map",["app._dm_map_from_payload_v1","entries_count",["bytes.view","entries_payload_b"]]],["let","doc",["ext.data_model.doc_ok",["bytes.view","root_map"]]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","doc"]]],["let","json_docv",["bytes.view","json_doc"]],["if",["ext.data_model.doc_is_err","json_docv"],["bytes.lit","{\"ok\":false,\"created\":[],\"next_steps\":[],\"error\":{\"message\":\"emit_failed\"}}\n"],["begin",["let","payload_v",["view.slice","json_docv",1,["-",["view.len","json_docv"],1]]],["let","payload",["view.to_bytes","payload_v"]],["let","out",["std.vec.with_capacity",["+",["bytes.len","payload"],1]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","payload"]]],["set","out",["std.vec.push","out",10]],["std.vec.as_bytes","out"]]]],"kind":"defn","name":"app._emit_report_json_v1","params":[{"name":"ok","ty":"i32"},{"name":"created_text","ty":"bytes_view"},{"name":"steps_text","ty":"bytes_view"},{"name":"error_msg","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","hit",["ext.cli.matches_get","doc","key",1]],["option_bytes.is_some","hit"]],"kind":"defn","name":"app._flag_present_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","flags",["+",["std.os.fs.spec.flag_allow_hidden_v1"],["+",["std.os.fs.spec.flag_create_parents_v1"],["std.os.fs.spec.flag_atomic_write_v1"]]]],["std.os.fs.spec.caps_pack_v1",16777216,16777216,10000,64,"flags"]],"kind":"defn","name":"app._fs_caps_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp bundle\n\nUsage:\n  x07-mcp bundle --dir <path> [--out-dir <path>] [--machine json]\n"],"kind":"defn","name":"app._help_bundle_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp check\n\nUsage:\n  x07-mcp check --dir <path> [--machine json]\n"],"kind":"defn","name":"app._help_check_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp codegen\n\nUsage:\n  x07-mcp codegen [--repo-root <path>] [--machine json]\n"],"kind":"defn","name":"app._help_codegen_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp conformance\n\nUsage:\n  x07-mcp conformance --dir <path> [--machine json]\n"],"kind":"defn","name":"app._help_conformance_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp dev\n\nUsage:\n  x07-mcp dev [--dir <path>] [--cfg <path>]\n"],"kind":"defn","name":"app._help_dev_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp\n\nUsage:\n  x07-mcp scaffold init --template <mcp-server|mcp-server-stdio|mcp-server-http> --dir <path> [--toolchain-version <semver>] [--machine json]\n  x07-mcp check --dir <path> [--machine json]\n  x07-mcp bundle --dir <path> [--out-dir <path>] [--machine json]\n  x07-mcp dev [--dir <path>] [--cfg <path>]\n  x07-mcp codegen [--repo-root <path>] [--machine json]\n  x07-mcp conformance --dir <path> [--machine json]\n\nCommands:\n  scaffold     Scaffolding and template generation.\n  check        Validate an MCP server project.\n  bundle       Bundle router + worker executables.\n  dev          Run the MCP router from a server config.\n  codegen      Regenerate embedded CLI template assets.\n  conformance  Run deterministic conformance tests for a project.\n\nOptions:\n  --cli-specrows  Emit CLI specrows JSON\n  -h, --help      Show help\n  --version       Show version\n"],"kind":"defn","name":"app._help_root_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp scaffold\n\nUsage:\n  x07-mcp scaffold init --template <mcp-server|mcp-server-stdio|mcp-server-http> --dir <path> [--toolchain-version <semver>] [--machine json]\n"],"kind":"defn","name":"app._help_scaffold_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["view.len","p"]],["if",["=","n",0],["return",1],0],["if",["=",["view.get_u8","p",0],47],["return",1],0],["for","i",0,"n",["if",["=",["view.get_u8","p","i"],92],["return",1],0]],0],"kind":"defn","name":"app._is_bad_rel_path_v1","params":[{"name":"p","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out",["std.vec.with_capacity",256]],["let","b_cd",["bytes.lit","cd "]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_cd"]]],["set","out",["std.vec.extend_bytes","out","dir"]],["set","out",["std.vec.push","out",10]],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["begin",["let","b_add_stdio",["bytes.lit","x07 pkg add ext-mcp-transport-stdio@0.2.0 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_stdio"]]],["set","out",["std.vec.push","out",10]],["let","b_add_rr",["bytes.lit","x07 pkg add ext-mcp-rr@0.2.0 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_rr"]]],["set","out",["std.vec.push","out",10]],["let","b_add_hex",["bytes.lit","x07 pkg add ext-hex-rs@0.1.4 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_hex"]]],["set","out",["std.vec.push","out",10]],["let","b_test",["bytes.lit","x07 test --manifest tests/tests.json"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_test"]]],["set","out",["std.vec.push","out",10]],["let","b_bundle_router",["bytes.lit","x07 bundle --profile os --out out/mcp-router"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_bundle_router"]]],["set","out",["std.vec.push","out",10]],["let","b_bundle_worker",["bytes.lit","x07 bundle --profile sandbox --program src/worker_main.x07.json --out out/mcp-worker"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_bundle_worker"]]],["set","out",["std.vec.push","out",10]],["let","b_run_router",["bytes.lit","./out/mcp-router"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_run_router"]]],["set","out",["std.vec.push","out",10]],0],["begin",["let","b_run",["bytes.lit","x07 run"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_run"]]],["set","out",["std.vec.push","out",10]],["let","b_test",["bytes.lit","x07 test --manifest tests/tests.json"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_test"]]],["set","out",["std.vec.push","out",10]],0]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._next_steps_text_v1","params":[{"name":"template","ty":"bytes"},{"name":"dir","ty":"bytes_view"}],"result":"bytes"},{"body":["option_bytes.unwrap_or",["ext.cli.matches_get","doc","key",2],["bytes.alloc",0]],"kind":"defn","name":"app._opt_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["std.os.process.caps_v1.finish",1048576,1048576,600000,0],"kind":"defn","name":"app._proc_caps_v1","params":[],"result":"bytes","result_brand":"std.os.process.caps_v1"},{"body":["begin",["let","b_error_prefix",["bytes.lit","error: "]],["let","out",["std.vec.with_capacity",["+",["view.len","msg"],16]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_error_prefix"]]],["set","out",["std.vec.extend_bytes","out","msg"]],["set","out",["std.vec.push","out",10]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._render_error_human_v1","params":[{"name":"msg","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","count_dec",["std.fmt.u32_to_dec","created_count"]],["let","b_ok_prefix",["bytes.lit","ok: created "]],["let","b_under",["bytes.lit"," file(s) under "]],["let","b_next_prefix",["bytes.lit","next: "]],["let","out",["std.vec.with_capacity",256]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_ok_prefix"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","count_dec"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_under"]]],["set","out",["std.vec.extend_bytes","out","dir"]],["set","out",["std.vec.push","out",10]],["let","x7sl",["std.text.ascii.split_lines_view","steps_text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","steps_text","x7sl_v","i"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_next_prefix"]]],["set","out",["std.vec.extend_bytes","out","line"]],["set","out",["std.vec.push","out",10]],["set","i",["+","i",1]],0]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._render_ok_human_v1","params":[{"name":"dir","ty":"bytes_view"},{"name":"created_count","ty":"i32"},{"name":"steps_text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","exe_override",["std.os.env.get",["bytes.lit","X07_MCP_X07"]]],["let","env_path",["std.os.env.get",["bytes.lit","PATH"]]],["let","env_home",["std.os.env.get",["bytes.lit","HOME"]]],["let","exe_default",["if",[">",["bytes.len","env_home"],0],["std.path.join",["view.to_bytes",["bytes.view","env_home"]],["bytes.lit",".x07/bin/x07"]],["bytes.lit","/usr/local/bin/x07"]]],["let","exe",["if",[">",["bytes.len","exe_override"],0],"exe_override","exe_default"]],["let","reqb",["std.os.process.req_v1.new","exe"]],["if",[">",["bytes.len","env_path"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","PATH"],"env_path"]],0],["if",[">",["bytes.len","env_home"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","HOME"],"env_home"]],0],["if",[">",["view.len","cwd"],0],["set","reqb",["std.os.process.req_v1.cwd","reqb",["view.to_bytes","cwd"]]],0],["let","x7sl",["std.text.ascii.split_lines_view","args_text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","args_text","x7sl_v","i"]],["if",[">",["view.len","line"],0],["set","reqb",["std.os.process.req_v1.arg","reqb",["view.to_bytes","line"]]],0],["set","i",["+","i",1]],0]],["let","req",["std.os.process.req_v1.finish","reqb"]],["let","caps",["app._proc_caps_v1"]],["std.os.process.run_capture_v1","req","caps"]],"kind":"defn","name":"app._run_x07_capture_v1","params":[{"name":"cwd","ty":"bytes_view"},{"name":"args_text","ty":"bytes_view"}],"result":"bytes"},{"body":["bytes.lit","{\"schema_version\":\"x07cli.specrows@0.1.0\",\"app\":{\"name\":\"x07-mcp\",\"version\":\"0.1.0\",\"about\":\"X07 MCP kit tooling.\"},\"rows\":[[\"root\",\"about\",\"X07 MCP kit tooling.\"],[\"root\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"root\",\"version\",\"\",\"--version\",\"Show version\"],[\"root\",\"flag\",\"\",\"--cli-specrows\",\"cli_specrows\",\"Emit CLI specrows JSON\",{\"global\":true}],[\"scaffold\",\"about\",\"Scaffolding and template generation.\"],[\"scaffold\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"scaffold\",\"arg\",\"SUBCMD\",\"subcmd\",\"Scaffold subcommand (init).\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--template\",\"template\",\"STR\",\"Template name (mcp-server|mcp-server-stdio|mcp-server-http).\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"Target directory (relative).\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--toolchain-version\",\"toolchain_version\",\"STR\",\"Toolchain version hint.\",{}],[\"scaffold\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"Machine mode (json).\",{}],[\"check\",\"about\",\"Validate an MCP server project.\"],[\"check\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"check\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"Project directory.\",{\"required\":true}],[\"check\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"Machine mode (json).\",{}],[\"bundle\",\"about\",\"Bundle router + worker executables.\"],[\"bundle\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"bundle\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"Project directory.\",{\"required\":true}],[\"bundle\",\"opt\",\"\",\"--out-dir\",\"out_dir\",\"PATH\",\"Output directory (relative, default: out).\",{}],[\"bundle\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"Machine mode (json).\",{}],[\"dev\",\"about\",\"Run the MCP router from a server config.\"],[\"dev\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"dev\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"Project directory (default: .).\",{}],[\"dev\",\"opt\",\"\",\"--cfg\",\"cfg\",\"PATH\",\"Server config path (default: config/mcp.server.json).\",{}],[\"codegen\",\"about\",\"Regenerate embedded CLI template assets.\"],[\"codegen\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"codegen\",\"opt\",\"\",\"--repo-root\",\"repo_root\",\"PATH\",\"Repo root (default: .).\",{}],[\"codegen\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"Machine mode (json).\",{}],[\"conformance\",\"about\",\"Run deterministic conformance tests for a project.\"],[\"conformance\",\"help\",\"-h\",\"--help\",\"Show help\"],[\"conformance\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"Project directory.\",{\"required\":true}],[\"conformance\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"Machine mode (json).\",{}]]}"],"kind":"defn","name":"app._spec_json_v1","params":[],"result":"bytes"},{"body":["bytes.lit","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bW9kZSAoanNvbikuBQAAAAAEAwAAAAMDAAAAZGV2AwUAAABhYm91dAMqAAAAUnVuIHRoZSBzdGRpbyByb3V0ZXIgZnJvbSBhIHNlcnZlciBjb25maWcuBAUAAAADAwAAAGRldgMEAAAAaGVscAMCAAAALWgDBgAAAC0taGVscAMJAAAAU2hvdyBoZWxwBAgAAAADAwAAAGRldgMDAAAAb3B0AwAAAAADBQAAAC0tZGlyAwMAAABkaXIDBAAAAFBBVEgDHwAAAFByb2plY3QgZGlyZWN0b3J5IChkZWZhdWx0OiAuKS4FAAAAAAQIAAAAAwMAAABkZXYDAwAAAG9wdAMAAAAAAwUAAAAtLWNmZwMDAAAAY2ZnAwQAAABQQVRIAzUAAABTZXJ2ZXIgY29uZmlnIHBhdGggKGRlZmF1bHQ6IGNvbmZpZy9tY3Auc2VydmVyLmpzb24pLgUAAAAABAMAAAADBwAAAGNvZGVnZW4DBQAAAGFib3V0AygAAABSZWdlbmVyYXRlIGVtYmVkZGVkIENMSSB0ZW1wbGF0ZSBhc3NldHMuBAUAAAADBwAAAGNvZGVnZW4DBAAAAGhlbHADAgAAAC1oAwYAAAAtLWhlbHADCQAAAFNob3cgaGVscAQIAAAAAwcAAABjb2RlZ2VuAwMAAABvcHQDAAAAAAMLAAAALS1yZXBvLXJvb3QDCQAAAHJlcG9fcm9vdAMEAAAAUEFUSAMXAAAAUmVwbyByb290IChkZWZhdWx0OiAuKS4FAAAAAAQIAAAAAwcAAABjb2RlZ2VuAwMAAABvcHQDAAAAAAMJAAAALS1tYWNoaW5lAwcAAABtYWNoaW5lAwMAAABTVFIDFAAAAE1hY2hpbmUgbW9kZSAoanNvbikuBQAAAAAEAwAAAAMLAAAAY29uZm9ybWFuY2UDBQAAAGFib3V0AzIAAABSdW4gZGV0ZXJtaW5pc3RpYyBjb25mb3JtYW5jZSB0ZXN0cyBmb3IgYSBwcm9qZWN0LgQFAAAAAwsAAABjb25mb3JtYW5jZQMEAAAAaGVscAMCAAAALWgDBgAAAC0taGVscAMJAAAAU2hvdyBoZWxwBAgAAAADCwAAAGNvbmZvcm1hbmNlAwMAAABvcHQDAAAAAAMFAAAALS1kaXIDAwAAAGRpcgMEAAAAUEFUSAMSAAAAUHJvamVjdCBkaXJlY3RvcnkuBQEAAAAIAAAAcmVxdWlyZWQBAQQIAAAAAwsAAABjb25mb3JtYW5jZQMDAAAAb3B0AwAAAAADCQAAAC0tbWFjaGluZQMHAAAAbWFjaGluZQMDAAAAU1RSAxQAAABNYWNoaW5lIG1vZGUgKGpzb24pLgUAAAAADgAAAHNjaGVtYV92ZXJzaW9uAxUAAAB4MDdjbGkuc3BlY3Jvd3NAMC4xLjA="],"kind":"defn","name":"app._specbin_b64_v1","params":[],"result":"bytes"},{"body":["if",["bytes.eq","template",["bytes.lit","mcp-server"]],["x07.mcp.cli.assets.mcp-server.get_b64_v1","path"],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["x07.mcp.cli.assets.mcp-server-stdio.get_b64_v1","path"],["if",["bytes.eq","template",["bytes.lit","mcp-server-http"]],["x07.mcp.cli.assets.mcp-server-http.get_b64_v1","path"],["option_bytes.none"]]]],"kind":"defn","name":"app._template_get_b64_v1","params":[{"name":"template","ty":"bytes"},{"name":"path","ty":"bytes_view"}],"result":"option_bytes"},{"body":["if",["bytes.eq","template",["bytes.lit","mcp-server"]],["x07.mcp.cli.assets.mcp-server.paths_text_v1"],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["x07.mcp.cli.assets.mcp-server-stdio.paths_text_v1"],["if",["bytes.eq","template",["bytes.lit","mcp-server-http"]],["x07.mcp.cli.assets.mcp-server-http.paths_text_v1"],["bytes.alloc",0]]]],"kind":"defn","name":"app._template_paths_text_v1","params":[{"name":"template","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","argv_v1",["view.to_bytes","argv_v1_in"]],["let","spec",["app._spec_json_v1"]],["let","specbin_b64",["app._specbin_b64_v1"]],["let","specbin_doc",["ext.base64.base64_decode",["bytes.view","specbin_b64"]]],["if",["=",["ext.base64.base64_is_err",["bytes.view","specbin_doc"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: internal error\n"]]],0],["let","specbin",["ext.base64.base64_get_bytes",["bytes.view","specbin_doc"]]],["let","doc",["ext.cli.parse_compiled","specbin","argv_v1"]],["let","docv",["bytes.view","doc"]],["let","k_cli_specrows",["bytes.lit","cli_specrows"]],["let","b_error_prefix",["bytes.lit","error: "]],["let","k_version",["bytes.lit","version"]],["let","k_help",["bytes.lit","help"]],["let","k_subcmd",["bytes.lit","subcmd"]],["let","k_template",["bytes.lit","template"]],["let","k_dir",["bytes.lit","dir"]],["let","k_out_dir",["bytes.lit","out_dir"]],["let","k_cfg",["bytes.lit","cfg"]],["let","k_repo_root",["bytes.lit","repo_root"]],["let","k_machine",["bytes.lit","machine"]],["let","b_pkg_lock_ok",["bytes.lit","pkg lock: ok\n"]],["let","b_arch_check_ok",["bytes.lit","arch check: ok\n"]],["let","b_tests_ok",["bytes.lit","tests: ok\n"]],["let","b_bundle_prefix_os",["bytes.lit","bundle\n--profile\nos\n--json=off\n--out\n"]],["let","b_bundle_router_ok",["bytes.lit","bundle router: ok\n"]],["let","b_bundle_prefix_worker",["bytes.lit","bundle\n--profile\nsandbox\n--program\nsrc/worker_main.x07.json\n--json=off\n--out\n"]],["let","b_bundle_worker_ok",["bytes.lit","bundle worker: ok\n"]],["let","b_codegen_asset_server",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server.x07.json"]],["let","b_codegen_asset_stdio",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server-stdio.x07.json"]],["let","b_codegen_asset_http",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server-http.x07.json"]],["let","b_codegen_asset_shared",["bytes.lit","cli/src/x07/mcp/cli/assets/shared.x07.json"]],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_cli_specrows"]],1],["begin",["process.set_exit_code_v1",0],["let","out",["std.vec.with_capacity",["+",["bytes.len","spec"],1]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","spec"]]],["set","out",["std.vec.push","out",10]],["return",["std.vec.as_bytes","out"]]],0],["if",["=",["ext.cli.is_ok","docv"],0],["begin",["process.set_exit_code_v1",2],["let","msg",["ext.cli.err_msg","docv"]],["let","usage",["ext.cli.err_usage","docv"]],["let","out",["std.vec.with_capacity",["+",["+",["bytes.len","msg"],["bytes.len","usage"]],32]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_error_prefix"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","msg"]]],["set","out",["std.vec.push","out",10]],["set","out",["std.vec.extend_bytes","out",["bytes.view","usage"]]],["set","out",["std.vec.push","out",10]],["return",["std.vec.as_bytes","out"]]],0],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_version"]],1],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","x07-mcp 0.1.0\n"]]],0],["let","cmd",["ext.cli.matches_cmd","docv"]],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_help"]],1],["begin",["process.set_exit_code_v1",0],["if",["bytes.eq","cmd",["bytes.lit","scaffold"]],["return",["app._help_scaffold_v1"]],["if",["bytes.eq","cmd",["bytes.lit","check"]],["return",["app._help_check_v1"]],["if",["bytes.eq","cmd",["bytes.lit","bundle"]],["return",["app._help_bundle_v1"]],["if",["bytes.eq","cmd",["bytes.lit","dev"]],["return",["app._help_dev_v1"]],["if",["bytes.eq","cmd",["bytes.lit","codegen"]],["return",["app._help_codegen_v1"]],["if",["bytes.eq","cmd",["bytes.lit","conformance"]],["return",["app._help_conformance_v1"]],["return",["app._help_root_v1"]]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","check"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","steps_out",["std.vec.with_capacity",256]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","cfg_rel_check",["bytes.lit","config/mcp.server.json"]],["let","cfg_path_check",["std.path.join",["view.to_bytes","dir_v"],["view.to_bytes",["bytes.view","cfg_rel_check"]]]],["let","cfg_json_check",["std.fs.read",["bytes.view","cfg_path_check"]]],["let","cfg_doc_b_check",["ext.json.data_model.parse",["bytes.view","cfg_json_check"]]],["let","cfg_doc_check",["bytes.view","cfg_doc_b_check"]],["let","cfg_valid_check",["if",["=",["ext.data_model.doc_is_err","cfg_doc_check"],0],["=",["ext.data_model.root_kind","cfg_doc_check"],5],0]],["if",["if",["=","ok",1],["=","cfg_valid_check",0],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","invalid config/mcp.server.json"]],0],0],["let","cfg_root_check",["if",["=","cfg_valid_check",1],["ext.data_model.root_offset","cfg_doc_check"],-1]],["let","transport_off_check",["if",[">=","cfg_root_check",0],["ext.data_model.map_find","cfg_doc_check","cfg_root_check",["bytes.lit","transport"]],-1]],["let","auth_off_check",["if",[">=","cfg_root_check",0],["ext.data_model.map_find","cfg_doc_check","cfg_root_check",["bytes.lit","auth"]],-1]],["let","transport_kind_check",["bytes.lit","stdio"]],["let","bind_host_check",["bytes.lit","127.0.0.1"]],["let","auth_mode_check",["bytes.lit","none"]],["let","origin_allow_missing_check",1],["let","session_mode_check",["bytes.lit","required"]],["if",["=","cfg_valid_check",1],["begin",["if",[">=","transport_off_check",0],["begin",["let","kind_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","kind"]]],["if",["if",[">=","kind_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","kind_off_check"],3],0],["set","transport_kind_check",["ext.data_model.string_get","cfg_doc_check","kind_off_check"]],0],["let","bind_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","bind_host"]]],["if",["if",[">=","bind_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","bind_off_check"],3],0],["set","bind_host_check",["ext.data_model.string_get","cfg_doc_check","bind_off_check"]],0],["let","origin_missing_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","origin_allow_missing"]]],["if",["if",[">=","origin_missing_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","origin_missing_off_check"],1],0],["set","origin_allow_missing_check",["ext.data_model.bool_get","cfg_doc_check","origin_missing_off_check"]],0],["let","session_mode_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","session_mode"]]],["if",["if",[">=","session_mode_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","session_mode_off_check"],3],0],["set","session_mode_check",["ext.data_model.string_get","cfg_doc_check","session_mode_off_check"]],0],0],0],["if",[">=","auth_off_check",0],["begin",["let","auth_mode_off_check",["ext.data_model.map_find","cfg_doc_check","auth_off_check",["bytes.lit","mode"]]],["if",["if",[">=","auth_mode_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","auth_mode_off_check"],3],0],["set","auth_mode_check",["ext.data_model.string_get","cfg_doc_check","auth_mode_off_check"]],0],0],0],0],0],["let","is_http_check",["if",["=",["bytes.eq",["bytes.view","transport_kind_check"],["bytes.lit","http"]],1],1,0]],["let","is_loopback_check",["if",["if",["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","127.0.0.1"]],1],1,["if",["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","localhost"]],1],1,["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","::1"]],1]]],1,0]],["if",["if",["if",["if",["=","ok",1],["=","is_http_check",1],0],["=","is_loopback_check",0],0],["=",["bytes.eq",["bytes.view","auth_mode_check"],["bytes.lit","none"]],1],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","http non-loopback bind requires auth.mode=oauth2"]],0],0],["if",["if",["if",["if",["=","ok",1],["=","is_http_check",1],0],["=","is_loopback_check",0],0],["=","origin_allow_missing_check",1],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","http non-loopback bind requires strict Origin policy"]],0],0],["if",["if",["=","ok",1],["=",["bytes.eq",["bytes.view","session_mode_check"],["bytes.lit","disabled"]],1],0],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.lit","warning: sessions disabled\n"]]],0],["if",["if",["=","ok",1],["=","cfg_valid_check",1],0],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.lit","config gates: ok\n"]]],0],["let","args_pkg",["bytes.lit","pkg\nlock\n--project\nx07.json\n--check\n--json=off\n"]],["let","resp_pkg",["app._run_x07_capture_v1","dir_v",["bytes.view","args_pkg"]]],["let","resp_pkg_v",["bytes.view","resp_pkg"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_pkg_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 pkg lock failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_pkg_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 pkg lock failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_pkg_lock_ok"]]],0],0],0],["let","args_arch",["bytes.lit","arch\ncheck\n--repo-root\n.\n--manifest\narch/manifest.x07arch.json\n--lock\narch/manifest.lock.json\n--json=off\n"]],["let","resp_arch",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args_arch"]],["bytes.alloc",0]]],["let","resp_arch_v",["bytes.view","resp_arch"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_arch_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 arch check failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_arch_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 arch check failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_arch_check_ok"]]],0],0],0],["let","args_test",["bytes.lit","test\n--manifest\ntests/tests.json\n--json=off\n"]],["let","resp_test",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args_test"]],["bytes.alloc",0]]],["let","resp_test_v",["bytes.view","resp_test"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_test_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_test_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_tests_ok"]]],0],0],0],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","bundle"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","out_dir",["app._opt_v1","docv",["bytes.view","k_out_dir"]]],["if",["=",["bytes.len","out_dir"],0],["set","out_dir",["bytes.lit","out"]],0],["if",["=",["app._is_bad_rel_path_v1",["bytes.view","out_dir"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: --out-dir must be a relative path\n"]]],0],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","router_out",["std.path.join",["view.to_bytes",["bytes.view","out_dir"]],["bytes.lit","mcp-router"]]],["let","worker_out",["std.path.join",["view.to_bytes",["bytes.view","out_dir"]],["bytes.lit","mcp-worker"]]],["let","steps_out",["std.vec.with_capacity",256]],["let","created_out",["std.vec.with_capacity",128]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","router_out"]]],["set","created_out",["std.vec.push","created_out",10]],["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","worker_out"]]],["set","created_out",["std.vec.push","created_out",10]],["let","args1_v",["std.vec.with_capacity",0]],["set","args1_v",["std.vec.extend_bytes","args1_v",["bytes.view","b_bundle_prefix_os"]]],["set","args1_v",["std.vec.extend_bytes","args1_v",["bytes.view","router_out"]]],["set","args1_v",["std.vec.push","args1_v",10]],["let","args1",["std.vec.as_bytes","args1_v"]],["let","resp1",["app._run_x07_capture_v1","dir_v",["bytes.view","args1"]]],["let","resp1_v",["bytes.view","resp1"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp1_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle router failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp1_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle router failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_bundle_router_ok"]]],0],0],0],["let","args2_v",["std.vec.with_capacity",0]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.view","b_bundle_prefix_worker"]]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.view","worker_out"]]],["set","args2_v",["std.vec.push","args2_v",10]],["let","args2",["std.vec.as_bytes","args2_v"]],["let","resp2",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args2"]],["bytes.alloc",0]]],["let","resp2_v",["bytes.view","resp2"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp2_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle worker failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp2_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle worker failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_bundle_worker_ok"]]],0],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","codegen"]],["begin",["let","repo_root",["app._opt_v1","docv",["bytes.view","k_repo_root"]]],["if",["=",["bytes.len","repo_root"],0],["set","repo_root",["bytes.lit","."]],0],["let","repo_root_v",["bytes.view","repo_root"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","created_out",["std.vec.with_capacity",256]],["let","steps_out",["std.vec.with_capacity",64]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","args_a",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server\n--module-id\nx07.mcp.cli.assets.mcp-server\n--out\ncli/src/x07/mcp/cli/assets/mcp-server.x07.json\n"]],["let","resp_a",["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_a"]]],["let","resp_a_v",["bytes.view","resp_a"]],["if",["=",["std.os.process.is_err","resp_a_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_a_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server)"]],0],0]],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_server"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_b",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server-stdio\n--module-id\nx07.mcp.cli.assets.mcp-server-stdio\n--out\ncli/src/x07/mcp/cli/assets/mcp-server-stdio.x07.json\n"]],["let","resp_b",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_b"]],["bytes.alloc",0]]],["let","resp_b_v",["bytes.view","resp_b"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_b_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-stdio)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_b_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-stdio)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_stdio"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_c",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server-http\n--module-id\nx07.mcp.cli.assets.mcp-server-http\n--out\ncli/src/x07/mcp/cli/assets/mcp-server-http.x07.json\n"]],["let","resp_c",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_c"]],["bytes.alloc",0]]],["let","resp_c_v",["bytes.view","resp_c"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_c_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-http)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_c_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-http)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_http"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_d",["bytes.lit","assets\nembed-dir\n--in\ntemplates/shared\n--module-id\nx07.mcp.cli.assets.shared\n--out\ncli/src/x07/mcp/cli/assets/shared.x07.json\n"]],["let","resp_d",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_d"]],["bytes.alloc",0]]],["let","resp_d_v",["bytes.view","resp_d"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_d_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (shared)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_d_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (shared)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_shared"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","conformance"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","args_test",["bytes.lit","test\n--manifest\ntests/tests.json\n--json=off\n"]],["let","resp",["app._run_x07_capture_v1","dir_v",["bytes.view","args_test"]]],["let","resp_v",["bytes.view","resp"]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["if",["=",["std.os.process.is_err","resp_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed"]],0],0]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.alloc",0],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.alloc",0],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","dev"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["if",["=",["bytes.len","dir"],0],["set","dir",["bytes.lit","."]],0],["let","cfg",["app._opt_v1","docv",["bytes.view","k_cfg"]]],["if",["=",["bytes.len","cfg"],0],["set","cfg",["bytes.lit","config/mcp.server.json"]],0],["let","cfg_path",["if",["=",["app._is_bad_rel_path_v1",["bytes.view","cfg"]],0],["std.path.join",["view.to_bytes",["bytes.view","dir"]],["view.to_bytes",["bytes.view","cfg"]]],["view.to_bytes",["bytes.view","cfg"]]]],["let","code",["begin",["let","cfg_json_dev",["std.fs.read",["bytes.view","cfg_path"]]],["let","cfg_doc_b_dev",["ext.json.data_model.parse",["bytes.view","cfg_json_dev"]]],["let","cfg_doc_dev",["bytes.view","cfg_doc_b_dev"]],["let","transport_kind_dev",["bytes.lit","stdio"]],["if",["if",["=",["ext.data_model.doc_is_err","cfg_doc_dev"],0],["=",["ext.data_model.root_kind","cfg_doc_dev"],5],0],["begin",["let","root_dev",["ext.data_model.root_offset","cfg_doc_dev"]],["let","transport_off_dev",["ext.data_model.map_find","cfg_doc_dev","root_dev",["bytes.lit","transport"]]],["if",[">=","transport_off_dev",0],["begin",["let","kind_off_dev",["ext.data_model.map_find","cfg_doc_dev","transport_off_dev",["bytes.lit","kind"]]],["if",["if",[">=","kind_off_dev",0],["=",["ext.data_model.kind_at","cfg_doc_dev","kind_off_dev"],3],0],["set","transport_kind_dev",["ext.data_model.string_get","cfg_doc_dev","kind_off_dev"]],0],0],0],0],0],["if",["=",["bytes.eq",["bytes.view","transport_kind_dev"],["bytes.lit","http"]],1],["std.mcp.transport.http.serve_from_fs_v1",["bytes.view","cfg_path"]],["std.mcp.transport.stdio.serve_from_fs_v1",["bytes.view","cfg_path"]]]]],["process.set_exit_code_v1","code"],["return",["bytes.alloc",0]]],0],["if",["=",["bytes.eq","cmd",["bytes.lit","scaffold"]],0],["begin",["process.set_exit_code_v1",2],["return",["app._help_root_v1"]]],0],["let","subcmd",["app._arg_v1","docv",["bytes.view","k_subcmd"]]],["if",["=",["bytes.eq","subcmd",["bytes.lit","init"]],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: expected subcommand 'init'\n"]]],0],["let","template",["app._opt_v1","docv",["bytes.view","k_template"]]],["let","template_v",["bytes.view","template"]],["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","template_for_paths",["view.to_bytes","template_v"]],["let","template_paths_text",["app._template_paths_text_v1","template_for_paths"]],["if",["=",["bytes.len","template_paths_text"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unknown --template\n"]]],0],["if",["=",["app._is_bad_rel_path_v1",["bytes.view","dir"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: --dir must be a relative path\n"]]],0],["let","caps",["app._fs_caps_v1"]],["let","caps_v",["bytes.view","caps"]],["let","created_out",["std.vec.with_capacity",256]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","paths_x7sl",["std.text.ascii.split_lines_view",["bytes.view","template_paths_text"]]],["let","paths_x7sl_v",["bytes.view","paths_x7sl"]],["let","paths_n",["std.text.slices.count_v1","paths_x7sl_v"]],["let","i",0],["for","_",0,"paths_n",["begin",["if",["=","ok",1],["begin",["let","p",["std.text.slices.view_at_v1",["bytes.view","template_paths_text"],"paths_x7sl_v","i"]],["let","template_for_get",["view.to_bytes","template_v"]],["let","b64_opt",["app._template_get_b64_v1","template_for_get","p"]],["if",["=",["option_bytes.is_some","b64_opt"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","missing embedded file payload"]],0],["begin",["let","b64",["option_bytes.unwrap_or","b64_opt",["bytes.alloc",0]]],["let","dec_doc",["ext.base64.base64_decode",["bytes.view","b64"]]],["let","dec_docv",["bytes.view","dec_doc"]],["if",["=",["ext.base64.base64_is_err","dec_docv"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","base64 decode failed"]],0],["begin",["let","contents",["ext.base64.base64_get_bytes","dec_docv"]],["let","dir_copy",["view.to_bytes","dir_v"]],["let","dst",["std.path.join","dir_copy",["view.to_bytes","p"]]],["let","caps_copy",["view.to_bytes","caps_v"]],["let","w",["std.os.fs.write_all_v1","dst","contents","caps_copy"]],["if",["=",["result_i32.is_ok","w"],1],["begin",["set","created_out",["std.vec.extend_bytes","created_out","p"]],["set","created_out",["std.vec.push","created_out",10]],0],["begin",["set","ok",0],["let","code_dec",["std.fmt.u32_to_dec",["result_i32.err_code","w"]]],["let","msgv",["std.vec.with_capacity",128]],["let","b_write_failed_prefix",["bytes.lit","write failed (code="]],["let","b_write_failed_suffix",["bytes.lit",")"]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","b_write_failed_prefix"]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","code_dec"]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","b_write_failed_suffix"]]],["set","err_msg",["std.vec.as_bytes","msgv"]],0]],0]],0]]],0],["set","i",["+","i",1]],0]],["if",["=","ok",1],["begin",["let","shared_paths_text",["x07.mcp.cli.assets.shared.paths_text_v1"]],["let","shared_x7sl",["std.text.ascii.split_lines_view",["bytes.view","shared_paths_text"]]],["let","shared_x7sl_v",["bytes.view","shared_x7sl"]],["let","shared_n",["std.text.slices.count_v1","shared_x7sl_v"]],["let","j",0],["for","_",0,"shared_n",["begin",["let","p",["std.text.slices.view_at_v1",["bytes.view","shared_paths_text"],"shared_x7sl_v","j"]],["let","b64_opt",["x07.mcp.cli.assets.shared.get_b64_v1","p"]],["if",["=",["option_bytes.is_some","b64_opt"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","missing embedded shared file payload"]],0],["begin",["let","b64",["option_bytes.unwrap_or","b64_opt",["bytes.alloc",0]]],["let","dec_doc",["ext.base64.base64_decode",["bytes.view","b64"]]],["let","dec_docv",["bytes.view","dec_doc"]],["if",["=",["ext.base64.base64_is_err","dec_docv"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","base64 decode failed"]],0],["begin",["let","contents",["ext.base64.base64_get_bytes","dec_docv"]],["let","dir_copy",["view.to_bytes","dir_v"]],["let","dst",["std.path.join","dir_copy",["view.to_bytes","p"]]],["let","caps_copy",["view.to_bytes","caps_v"]],["let","w",["std.os.fs.write_all_v1","dst","contents","caps_copy"]],["if",["=",["result_i32.is_ok","w"],1],["begin",["set","created_out",["std.vec.extend_bytes","created_out","p"]],["set","created_out",["std.vec.push","created_out",10]],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","write failed"]],0]],0]],0]],["set","j",["+","j",1]],0]],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","created_x7sl",["std.text.ascii.split_lines_view",["bytes.view","created_text"]]],["let","created_count",["std.text.slices.count_v1",["bytes.view","created_x7sl"]]],["if",["=","ok",1],["begin",["let","template_for_steps",["view.to_bytes","template_v"]],["let","steps_text",["app._next_steps_text_v1","template_for_steps","dir_v"]],["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["app._render_ok_human_v1",["bytes.view","dir"],"created_count",["bytes.view","steps_text"]]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.alloc",0],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],"kind":"defn","name":"app.solve","params":[{"name":"argv_v1_in","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.base64","ext.cli","ext.data_model","ext.data_model.json","ext.json.data_model","std.fmt","std.fs","std.mcp.transport.http","std.mcp.transport.stdio","std.os.env","std.os.fs","std.os.fs.spec","std.os.process","std.os.process.caps_v1","std.os.process.req_v1","std.path","std.text.ascii","std.text.slices","std.vec","x07.mcp.cli.assets.mcp-server","x07.mcp.cli.assets.mcp-server-http","x07.mcp.cli.assets.mcp-server-stdio","x07.mcp.cli.assets.shared"],"kind":"module","module_id":"app","schema_version":"x07.x07ast@0.5.0"}
