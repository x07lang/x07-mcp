{"decls":[{"kind":"export","names":["app.solve"]},{"body":["option_bytes.unwrap_or",["ext.cli.matches_get","doc","key",3],["bytes.alloc",0]],"kind":"defn","name":"app._arg_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","argv_v1"]],["if",["<u","n",4],["return",["view.to_bytes","argv_v1"]],0],["let","argc",["codec.read_u32_le","argv_v1",0]],["if",["<=","argc",0],["return",["view.to_bytes","argv_v1"]],0],["if",["=","argc",1],["return",["codec.write_u32_le",0]],0],["let","out",["std.vec.with_capacity","n"]],["let","new_count_b",["codec.write_u32_le",["-","argc",1]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","new_count_b"]]],["let","off",4],["for","i",0,"argc",["begin",["if",["<u","n",["+","off",4]],["return",["view.to_bytes","argv_v1"]],0],["let","tok_len",["codec.read_u32_le","argv_v1","off"]],["let","tok_start",["+","off",4]],["if",["<u","n",["+","tok_start","tok_len"]],["return",["view.to_bytes","argv_v1"]],0],["if",["=","i",0],0,["begin",["let","tok_len_b",["codec.write_u32_le","tok_len"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","tok_len_b"]]],["let","tok",["view.slice","argv_v1","tok_start","tok_len"]],["set","out",["std.vec.extend_bytes","out","tok"]],0]],["set","off",["+","tok_start","tok_len"]],0]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._argv_drop_first_v1","params":[{"name":"argv_v1","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","argv_v1"]],["if",["<u","n",8],["return",["bytes.alloc",0]],0],["let","argc",["codec.read_u32_le","argv_v1",0]],["if",["<=","argc",0],["return",["bytes.alloc",0]],0],["let","len0",["codec.read_u32_le","argv_v1",4]],["let","start0",8],["if",["<u","n",["+","start0","len0"]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","argv_v1","start0","len0"]]],"kind":"defn","name":"app._argv_first_token_v1","params":[{"name":"argv_v1","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","s"]],["if",["<u","n",3],["return",0],0],["let","limit",["+",["-","n",3],1]],["for","i",0,"limit",["begin",["if",["if",["=",["view.get_u8","s","i"],109],["if",["=",["view.get_u8","s",["+","i",1]],99],["=",["view.get_u8","s",["+","i",2]],112],0],0],["return",1],0],0]],0],"kind":"defn","name":"app._bytes_contains_mcp_v1","params":[{"name":"s","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","tok"]],["for","i",0,"n",["if",["|",["=",["view.get_u8","tok","i"],47],["=",["view.get_u8","tok","i"],92]],["return",1],0]],0],"kind":"defn","name":"app._bytes_has_path_sep_v1","params":[{"name":"tok","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","entries",["std.vec.with_capacity",["+",4,["view.len","payload"]]]],["let","count_b",["codec.write_u32_le","count"]],["set","entries",["std.vec.extend_bytes","entries",["bytes.view","count_b"]]],["set","entries",["std.vec.extend_bytes","entries","payload"]],["let","entries_b",["std.vec.as_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"app._dm_map_from_payload_v1","params":[{"name":"count","ty":"i32"},{"name":"payload","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","off",["ext.data_model.map_find","b","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["if",["=",["ext.data_model.kind_at","b","off"],3],0,["return",["bytes.alloc",0]]],["ext.data_model.string_get","b","off"]],"kind":"defn","name":"app._dm_map_get_string_or_empty_v1","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","off",["ext.data_model.map_find","b","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["let","end",["ext.data_model.skip_value","b","off"]],["if",["<","end",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","b","off",["-","end","off"]]]],"kind":"defn","name":"app._dm_map_get_value_bytes_or_empty_v1","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","key_len_b",["codec.write_u32_le",["view.len","key"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","key_len_b"]]],["set","payload",["std.vec.extend_bytes","payload","key"]],["let","value_len_b",["codec.write_u32_le",["view.len","value"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","value_len_b"]]],["set","payload",["std.vec.extend_bytes","payload","value"]],"payload"],"kind":"defn","name":"app._dm_payload_push_entry_v1","params":[{"name":"payload","ty":"vec_u8"},{"name":"key","ty":"bytes_view"},{"name":"value","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","len_b",["codec.write_u32_le",["view.len","value"]]],["set","payload",["std.vec.extend_bytes","payload",["bytes.view","len_b"]]],["set","payload",["std.vec.extend_bytes","payload","value"]],"payload"],"kind":"defn","name":"app._dm_payload_push_value_v1","params":[{"name":"payload","ty":"vec_u8"},{"name":"value","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","x7sl",["std.text.ascii.split_lines_view","text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","payload",["std.vec.with_capacity",0]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","text","x7sl_v","i"]],["let","val",["ext.data_model.value_string","line"]],["set","payload",["app._dm_payload_push_value_v1","payload",["bytes.view","val"]]],["set","i",["+","i",1]],0]],["let","payload_b",["std.vec.as_bytes","payload"]],["app._dm_seq_from_payload_v1","n",["bytes.view","payload_b"]]],"kind":"defn","name":"app._dm_seq_from_lines_text_v1","params":[{"name":"text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","elems",["std.vec.with_capacity",["+",4,["view.len","payload"]]]],["let","count_b",["codec.write_u32_le","count"]],["set","elems",["std.vec.extend_bytes","elems",["bytes.view","count_b"]]],["set","elems",["std.vec.extend_bytes","elems","payload"]],["let","elems_b",["std.vec.as_bytes","elems"]],["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],"kind":"defn","name":"app._dm_seq_from_payload_v1","params":[{"name":"count","ty":"i32"},{"name":"payload","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","created_val",["app._dm_seq_from_lines_text_v1","created_text"]],["let","steps_val",["app._dm_seq_from_lines_text_v1","steps_text"]],["let","entries_payload",["std.vec.with_capacity",0]],["let","entries_count",0],["let","k_ok",["bytes.lit","ok"]],["let","k_created",["bytes.lit","created"]],["let","k_next_steps",["bytes.lit","next_steps"]],["let","k_error",["bytes.lit","error"]],["let","k_message",["bytes.lit","message"]],["let","v_ok",["ext.data_model.value_bool","ok"]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_ok"],["bytes.view","v_ok"]]],["set","entries_count",["+","entries_count",1]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_created"],["bytes.view","created_val"]]],["set","entries_count",["+","entries_count",1]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_next_steps"],["bytes.view","steps_val"]]],["set","entries_count",["+","entries_count",1]],["if",[">",["view.len","error_msg"],0],["begin",["let","err_payload",["std.vec.with_capacity",0]],["let","v_message",["ext.data_model.value_string","error_msg"]],["set","err_payload",["app._dm_payload_push_entry_v1","err_payload",["bytes.view","k_message"],["bytes.view","v_message"]]],["let","err_payload_b",["std.vec.as_bytes","err_payload"]],["let","err_map",["app._dm_map_from_payload_v1",1,["bytes.view","err_payload_b"]]],["set","entries_payload",["app._dm_payload_push_entry_v1","entries_payload",["bytes.view","k_error"],["bytes.view","err_map"]]],["set","entries_count",["+","entries_count",1]]],0],["let","entries_payload_b",["std.vec.as_bytes","entries_payload"]],["let","root_map",["app._dm_map_from_payload_v1","entries_count",["bytes.view","entries_payload_b"]]],["let","doc",["ext.data_model.doc_ok",["bytes.view","root_map"]]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","doc"]]],["let","json_docv",["bytes.view","json_doc"]],["if",["ext.data_model.doc_is_err","json_docv"],["bytes.lit","{\"ok\":false,\"created\":[],\"next_steps\":[],\"error\":{\"message\":\"emit_failed\"}}\n"],["begin",["let","payload_v",["view.slice","json_docv",1,["-",["view.len","json_docv"],1]]],["let","payload",["view.to_bytes","payload_v"]],["let","out",["std.vec.with_capacity",["+",["bytes.len","payload"],1]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","payload"]]],["set","out",["std.vec.push","out",10]],["std.vec.as_bytes","out"]]]],"kind":"defn","name":"app._emit_report_json_v1","params":[{"name":"ok","ty":"i32"},{"name":"created_text","ty":"bytes_view"},{"name":"steps_text","ty":"bytes_view"},{"name":"error_msg","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","hit",["ext.cli.matches_get","doc","key",1]],["option_bytes.is_some","hit"]],"kind":"defn","name":"app._flag_present_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","flags",["+",["std.os.fs.spec.flag_allow_hidden_v1"],["+",["std.os.fs.spec.flag_create_parents_v1"],["std.os.fs.spec.flag_atomic_write_v1"]]]],["std.os.fs.spec.caps_pack_v1",16777216,16777216,10000,64,"flags"]],"kind":"defn","name":"app._fs_caps_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp bundle\n\nUsage:\n  x07-mcp bundle --dir <path> [--out-dir <path>] [--machine json]\n  x07-mcp bundle --mcpb --server-dir <servers/<id>> [--out <dist/...mcpb>] [--machine json]\n"],"kind":"defn","name":"app._help_bundle_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp check\n\nUsage:\n  x07-mcp check --dir <path> [--machine json]\n"],"kind":"defn","name":"app._help_check_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp codegen\n\nUsage:\n  x07-mcp codegen [--repo-root <path>] [--machine json]\n"],"kind":"defn","name":"app._help_codegen_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp conformance\n\nUsage:\n  x07-mcp conformance --url <url> [--baseline <path>] [--spawn <server-id> --mode <noauth|oauth>] [--machine json]\n"],"kind":"defn","name":"app._help_conformance_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp dev\n\nUsage:\n  x07-mcp dev [--dir <path>] [--cfg <path>]\n"],"kind":"defn","name":"app._help_dev_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp publish\n\nUsage:\n  x07-mcp publish --dry-run --server-json <server.json> --mcpb <file> [--machine json]\n"],"kind":"defn","name":"app._help_publish_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp registry\n\nUsage:\n  x07-mcp registry gen --in <x07.mcp.json> --out <server.json> [--mcpb <file>] [--schema <pinned-schema-file>] [--machine json]\n"],"kind":"defn","name":"app._help_registry_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp\n\nUsage:\n  x07-mcp scaffold init --template <mcp-server|mcp-server-stdio|mcp-server-http> --dir <path> [--toolchain-version <semver>] [--machine json]\n  x07-mcp check --dir <path> [--machine json]\n  x07-mcp bundle --dir <path> [--out-dir <path>] [--machine json]\n  x07-mcp bundle --mcpb --server-dir <servers/<id>> [--out <dist/...mcpb>] [--machine json]\n  x07-mcp registry gen --in <x07.mcp.json> --out <server.json> [--mcpb <file>] [--schema <pinned-schema-file>] [--machine json]\n  x07-mcp publish --dry-run --server-json <server.json> --mcpb <file> [--machine json]\n  x07-mcp conformance --url <url> [--baseline <path>] [--spawn <server-id> --mode <noauth|oauth>] [--machine json]\n  x07-mcp dev [--dir <path>] [--cfg <path>]\n  x07-mcp codegen [--repo-root <path>] [--machine json]\n\nCommands:\n  scaffold     Scaffolding and template generation.\n  check        Validate an MCP server project.\n  bundle       Bundle router + worker executables or build .mcpb artifacts.\n  registry     Generate pinned MCP registry server.json artifacts.\n  publish      Validate server.json + .mcpb for publish dry-run.\n  dev          Run the MCP router from a server config.\n  codegen      Regenerate embedded CLI template assets.\n  conformance  Run deterministic MCP conformance checks.\n\nOptions:\n  --cli-specrows  Emit CLI specrows JSON\n  -h, --help      Show help\n  --version       Show version\n"],"kind":"defn","name":"app._help_root_v1","params":[],"result":"bytes"},{"body":["bytes.lit","x07-mcp scaffold\n\nUsage:\n  x07-mcp scaffold init --template <mcp-server|mcp-server-stdio|mcp-server-http> --dir <path> [--toolchain-version <semver>] [--machine json]\n"],"kind":"defn","name":"app._help_scaffold_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["view.len","p"]],["if",["=","n",0],["return",1],0],["if",["=",["view.get_u8","p",0],47],["return",1],0],["for","i",0,"n",["if",["=",["view.get_u8","p","i"],92],["return",1],0]],0],"kind":"defn","name":"app._is_bad_rel_path_v1","params":[{"name":"p","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["view.len","s"],64],0,["return",0]],["for","i",0,64,["begin",["let","c",["view.get_u8","s","i"]],["let","is_digit",["if",[">=u","c",48],["<u","c",58],0]],["let","is_low",["if",[">=u","c",97],["<u","c",103],0]],["if",["=",["|","is_digit","is_low"],1],0,["return",0]],0]],1],"kind":"defn","name":"app._is_hex64_lower_v1","params":[{"name":"s","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out",["std.vec.with_capacity",256]],["let","b_cd",["bytes.lit","cd "]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_cd"]]],["set","out",["std.vec.extend_bytes","out","dir"]],["set","out",["std.vec.push","out",10]],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["begin",["let","b_add_stdio",["bytes.lit","x07 pkg add ext-mcp-transport-stdio@0.2.0 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_stdio"]]],["set","out",["std.vec.push","out",10]],["let","b_add_rr",["bytes.lit","x07 pkg add ext-mcp-rr@0.2.0 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_rr"]]],["set","out",["std.vec.push","out",10]],["let","b_add_hex",["bytes.lit","x07 pkg add ext-hex-rs@0.1.4 --sync"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_add_hex"]]],["set","out",["std.vec.push","out",10]],["let","b_test",["bytes.lit","x07 test --manifest tests/tests.json"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_test"]]],["set","out",["std.vec.push","out",10]],["let","b_bundle_router",["bytes.lit","x07 bundle --profile os --out out/mcp-router"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_bundle_router"]]],["set","out",["std.vec.push","out",10]],["let","b_bundle_worker",["bytes.lit","x07 bundle --profile sandbox --program src/worker_main.x07.json --out out/mcp-worker"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_bundle_worker"]]],["set","out",["std.vec.push","out",10]],["let","b_run_router",["bytes.lit","./out/mcp-router"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_run_router"]]],["set","out",["std.vec.push","out",10]],0],["begin",["let","b_run",["bytes.lit","x07 run"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_run"]]],["set","out",["std.vec.push","out",10]],["let","b_test",["bytes.lit","x07 test --manifest tests/tests.json"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_test"]]],["set","out",["std.vec.push","out",10]],0]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._next_steps_text_v1","params":[{"name":"template","ty":"bytes"},{"name":"dir","ty":"bytes_view"}],"result":"bytes"},{"body":["option_bytes.unwrap_or",["ext.cli.matches_get","doc","key",2],["bytes.alloc",0]],"kind":"defn","name":"app._opt_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","pins_path",["bytes.lit","arch/pins/mcp_kit.json"]],["let","caps",["std.os.fs.spec.caps_default_v1"]],["let","caps_v",["bytes.view","caps"]],["let","read",["std.os.fs.read_all_v1","pins_path",["view.to_bytes","caps_v"]]],["if",["!=",["result_bytes.err_code","read"],0],["begin",["let","_bytes_owner_1",["bytes.lit","missing pins file"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_1"]]]],0],["let","pins_json",["result_bytes.unwrap_or","read",["bytes.alloc",0]]],["let","pins_doc",["ext.json.data_model.parse",["bytes.view","pins_json"]]],["let","pins_docv",["bytes.view","pins_doc"]],["if",["=",["ext.data_model.doc_is_err","pins_docv"],1],["begin",["let","_bytes_owner_2",["ext.data_model.doc_error_msg","pins_docv"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_2"]]]],0],["let","root_off",["ext.data_model.root_offset","pins_docv"]],["if",["=",["ext.data_model.root_kind","pins_docv"],5],0,["begin",["let","_bytes_owner_3",["bytes.lit","pins must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_3"]]]]],["let","_bytes_owner_4",["bytes.lit","registry"]],["let","reg_off",["ext.data_model.map_find","pins_docv","root_off",["bytes.view","_bytes_owner_4"]]],["if",["<","reg_off",0],["begin",["let","_bytes_owner_5",["bytes.lit","pins missing registry"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_5"]]]],0],["if",["=",["ext.data_model.kind_at","pins_docv","reg_off"],5],0,["begin",["let","_bytes_owner_6",["bytes.lit","pins registry must be object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_6"]]]]],["let","_bytes_owner_7",["bytes.lit","server_schema_url"]],["let","schema_url",["app._dm_map_get_string_or_empty_v1","pins_docv","reg_off",["bytes.view","_bytes_owner_7"]]],["let","_bytes_owner_8",["bytes.lit","server_schema_file"]],["let","schema_file",["app._dm_map_get_string_or_empty_v1","pins_docv","reg_off",["bytes.view","_bytes_owner_8"]]],["if",["=",["bytes.len","schema_url"],0],["begin",["let","_bytes_owner_9",["bytes.lit","pins missing registry.server_schema_url"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_9"]]]],0],["if",["=",["bytes.len","schema_file"],0],["begin",["let","_bytes_owner_10",["bytes.lit","pins missing registry.server_schema_file"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_10"]]]],0],["let","payload",["std.vec.with_capacity",0]],["let","k_url",["bytes.lit","schema_url"]],["let","k_file",["bytes.lit","schema_file"]],["let","v_url",["ext.data_model.value_string",["bytes.view","schema_url"]]],["let","v_file",["ext.data_model.value_string",["bytes.view","schema_file"]]],["set","payload",["app._dm_payload_push_entry_v1","payload",["bytes.view","k_url"],["bytes.view","v_url"]]],["set","payload",["app._dm_payload_push_entry_v1","payload",["bytes.view","k_file"],["bytes.view","v_file"]]],["let","payload_b",["std.vec.as_bytes","payload"]],["let","m",["app._dm_map_from_payload_v1",2,["bytes.view","payload_b"]]],["ext.data_model.doc_ok",["bytes.view","m"]]],"kind":"defn","name":"app._pins_registry_schema_info_doc_v1","params":[],"result":"bytes"},{"body":["std.os.process.caps_v1.finish",1048576,1048576,600000,0],"kind":"defn","name":"app._proc_caps_v1","params":[],"result":"bytes","result_brand":"std.os.process.caps_v1"},{"body":["begin",["let","ok",1],["let","err",["bytes.alloc",0]],["let","pins",["app._pins_registry_schema_info_doc_v1"]],["let","pinsv",["bytes.view","pins"]],["if",["=",["ext.data_model.doc_is_err","pinsv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","pinsv"]],0],0],["let","schema_url",["bytes.alloc",0]],["let","schema_file",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","p_root",["ext.data_model.root_offset","pinsv"]],["let","_bytes_owner_11",["bytes.lit","schema_url"]],["set","schema_url",["app._dm_map_get_string_or_empty_v1","pinsv","p_root",["bytes.view","_bytes_owner_11"]]],["let","_bytes_owner_12",["bytes.lit","schema_file"]],["set","schema_file",["app._dm_map_get_string_or_empty_v1","pinsv","p_root",["bytes.view","_bytes_owner_12"]]],["if",["=",["bytes.len","schema_url"],0],["begin",["set","ok",0],["set","err",["bytes.lit","pins missing schema_url"]],0],0],["if",["=",["bytes.len","schema_file"],0],["begin",["set","ok",0],["set","err",["bytes.lit","pins missing schema_file"]],0],0],0],0],["let","schema_path",["bytes.alloc",0]],["if",[">",["view.len","schema_path_opt"],0],["set","schema_path",["view.to_bytes","schema_path_opt"]],["set","schema_path","schema_file"]],["let","caps",["app._fs_caps_v1"]],["let","capsv",["bytes.view","caps"]],["let","srv_b",["view.to_bytes","server_json_path"]],["let","mcpb_b",["view.to_bytes","mcpb_path"]],["let","srv_json",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","r",["std.os.fs.read_all_v1","srv_b",["view.to_bytes","capsv"]]],["if",["!=",["result_bytes.err_code","r"],0],["begin",["set","ok",0],["set","err",["bytes.lit","missing server.json file"]],0],["set","srv_json",["result_bytes.unwrap_or","r",["bytes.alloc",0]]]],0],0],["let","srv_doc",["bytes.alloc",0]],["let","srv_off",-1],["if",["=","ok",1],["begin",["set","srv_doc",["ext.json.data_model.parse",["bytes.view","srv_json"]]],0,["if",["=",["ext.data_model.doc_is_err",["bytes.view","srv_doc"]],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg",["bytes.view","srv_doc"]]],0],0],["if",["=","ok",1],["set","srv_off",["ext.data_model.root_offset",["bytes.view","srv_doc"]]],0],["if",["=","ok",1],["if",["=",["ext.data_model.root_kind",["bytes.view","srv_doc"]],5],0,["begin",["set","ok",0],["set","err",["bytes.lit","server.json must be an object"]],0]],0],0],0],["if",["=","ok",1],["begin",["let","_bytes_owner_13",["bytes.lit","$schema"]],["let","s",["app._dm_map_get_string_or_empty_v1",["bytes.view","srv_doc"],"srv_off",["bytes.view","_bytes_owner_13"]]],["if",["=",["bytes.eq","s","schema_url"],1],0,["begin",["set","ok",0],["set","err",["bytes.lit","server.json $schema must match pinned URL"]],0]],0],0],["if",["=","ok",1],["begin",["let","sv",["app._schema_validate_json_or_err_doc_v1",["bytes.view","schema_path"],["bytes.view","srv_json"]]],["let","svv",["bytes.view","sv"]],["if",["=",["ext.data_model.doc_is_err","svv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","svv"]],0],0],0],0],["if",["=","ok",1],["begin",["let","nv",["app._validate_non_schema_constraints_or_err_doc_v1",["bytes.view","srv_doc"],"srv_off"]],["let","nvv",["bytes.view","nv"]],["if",["=",["ext.data_model.doc_is_err","nvv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","nvv"]],0],0],0],0],["let","mcpb_pkg",-1],["if",["=","ok",1],["begin",["let","_bytes_owner_14",["bytes.lit","packages"]],["let","packages_off",["ext.data_model.map_find",["bytes.view","srv_doc"],"srv_off",["bytes.view","_bytes_owner_14"]]],["if",["<","packages_off",0],["begin",["set","ok",0],["set","err",["bytes.lit","server.json must include at least one mcpb package"]],0],["begin",["if",["=",["ext.data_model.kind_at",["bytes.view","srv_doc"],"packages_off"],4],0,["begin",["set","ok",0],["set","err",["bytes.lit","server.json packages must be an array"]],0]],["if",["=","ok",1],["begin",["let","count",["ext.data_model.seq_len",["bytes.view","srv_doc"],"packages_off"]],["for","i",0,"count",["if",["<","mcpb_pkg",0],["begin",["let","pkg_off",["ext.data_model.seq_get",["bytes.view","srv_doc"],"packages_off","i"]],["if",["=",["ext.data_model.kind_at",["bytes.view","srv_doc"],"pkg_off"],5],["begin",["let","_bytes_owner_15",["bytes.lit","registryType"]],["let","rt",["app._dm_map_get_string_or_empty_v1",["bytes.view","srv_doc"],"pkg_off",["bytes.view","_bytes_owner_15"]]],["if",["=",["bytes.eq","rt",["bytes.lit","mcpb"]],1],["set","mcpb_pkg","pkg_off"],0],0],0],0],0]],0],0],0]],0],0],["if",["=","ok",1],["if",["<","mcpb_pkg",0],["begin",["set","ok",0],["set","err",["bytes.lit","server.json must include at least one mcpb package"]],0],0],0],["let","expected_sha",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","_bytes_owner_16",["bytes.lit","fileSha256"]],["set","expected_sha",["app._dm_map_get_string_or_empty_v1",["bytes.view","srv_doc"],"mcpb_pkg",["bytes.view","_bytes_owner_16"]]],["if",["=",["bytes.len","expected_sha"],0],["begin",["set","ok",0],["set","err",["bytes.lit","mcpb package is missing fileSha256"]],0],0],0],0],["let","actual_sha",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","sha_doc",["app._sha256_file_doc_v1",["bytes.view","mcpb_b"]]],["let","sha_docv",["bytes.view","sha_doc"]],["if",["=",["ext.data_model.doc_is_err","sha_docv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","sha_docv"]],0],["begin",["let","sha_off",["ext.data_model.root_offset","sha_docv"]],["set","actual_sha",["ext.data_model.string_get","sha_docv","sha_off"]],0]],0],0],["if",["=","ok",1],["if",["=",["bytes.eq","actual_sha","expected_sha"],1],0,["begin",["set","ok",0],["let","msgv",["std.vec.with_capacity",200]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.lit","mcpb sha mismatch: expected "]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","expected_sha"]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.lit",", got "]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","actual_sha"]]],["set","err",["std.vec.as_bytes","msgv"]],0]],0],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.alloc",0],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok: publish dry-run validation passed\n"]]]],0],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.alloc",0],["bytes.view","err"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err"]]]]]]],["bytes.alloc",0]],"kind":"defn","name":"app._publish_dry_run_native_v1","params":[{"name":"server_json_path","ty":"bytes_view"},{"name":"mcpb_path","ty":"bytes_view"},{"name":"schema_path_opt","ty":"bytes_view"},{"name":"machine_json","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","ok",1],["let","err",["bytes.alloc",0]],["let","pins",["app._pins_registry_schema_info_doc_v1"]],["let","pinsv",["bytes.view","pins"]],["if",["=",["ext.data_model.doc_is_err","pinsv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","pinsv"]],0],0],["let","schema_url",["bytes.alloc",0]],["let","schema_file",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","p_root",["ext.data_model.root_offset","pinsv"]],["let","_bytes_owner_17",["bytes.lit","schema_url"]],["set","schema_url",["app._dm_map_get_string_or_empty_v1","pinsv","p_root",["bytes.view","_bytes_owner_17"]]],["let","_bytes_owner_18",["bytes.lit","schema_file"]],["set","schema_file",["app._dm_map_get_string_or_empty_v1","pinsv","p_root",["bytes.view","_bytes_owner_18"]]],["if",["=",["bytes.len","schema_url"],0],["begin",["set","ok",0],["set","err",["bytes.lit","pins missing schema_url"]],0],0],["if",["=",["bytes.len","schema_file"],0],["begin",["set","ok",0],["set","err",["bytes.lit","pins missing schema_file"]],0],0],0],0],["let","schema_path",["bytes.alloc",0]],["if",[">",["view.len","schema_path_opt"],0],["set","schema_path",["view.to_bytes","schema_path_opt"]],["set","schema_path","schema_file"]],["let","caps",["app._fs_caps_v1"]],["let","capsv",["bytes.view","caps"]],["let","in_b",["view.to_bytes","in_path"]],["let","out_b",["view.to_bytes","out_path"]],["let","mcpb_b",["view.to_bytes","mcpb_path"]],["let","manifest_json",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","r",["std.os.fs.read_all_v1","in_b",["view.to_bytes","capsv"]]],["if",["!=",["result_bytes.err_code","r"],0],["begin",["set","ok",0],["set","err",["bytes.lit","missing input file"]],0],["set","manifest_json",["result_bytes.unwrap_or","r",["bytes.alloc",0]]]],0],0],["let","mcpb_sha",["bytes.alloc",0]],["if",["=","ok",1],["if",[">",["bytes.len","mcpb_b"],0],["begin",["let","sha_doc",["app._sha256_file_doc_v1",["bytes.view","mcpb_b"]]],["let","sha_docv",["bytes.view","sha_doc"]],["if",["=",["ext.data_model.doc_is_err","sha_docv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","sha_docv"]],0],["begin",["let","sha_off",["ext.data_model.root_offset","sha_docv"]],["set","mcpb_sha",["ext.data_model.string_get","sha_docv","sha_off"]],0]],0],0],0],["let","server_doc",["bytes.alloc",0]],["if",["=","ok",1],["begin",["set","server_doc",["app._registry_generate_server_doc_or_err_v1",["bytes.view","manifest_json"],["bytes.view","schema_url"],["bytes.view","mcpb_sha"]]],["let","sv",["bytes.view","server_doc"]],["if",["=",["ext.data_model.doc_is_err","sv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","sv"]],0],0],0],0],["let","server_docv",["bytes.view","server_doc"]],["let","server_map_off",["if",["=","ok",1],["ext.data_model.root_offset","server_docv"],-1]],["let","payload",["bytes.alloc",0]],["if",["=","ok",1],["begin",["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","server_doc"]]],["let","json_docv",["bytes.view","json_doc"]],["if",["=",["ext.data_model.doc_is_err","json_docv"],1],["begin",["set","ok",0],["set","err",["bytes.lit","emit failed"]],0],["begin",["let","payload_v",["view.slice","json_docv",1,["-",["view.len","json_docv"],1]]],["set","payload",["view.to_bytes","payload_v"]],0]],0],0],["if",["=","ok",1],["begin",["let","sv",["app._schema_validate_json_or_err_doc_v1",["bytes.view","schema_path"],["bytes.view","payload"]]],["let","svv",["bytes.view","sv"]],["if",["=",["ext.data_model.doc_is_err","svv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","svv"]],0],0],0],0],["if",["=","ok",1],["begin",["let","nv",["app._validate_non_schema_constraints_or_err_doc_v1","server_docv","server_map_off"]],["let","nvv",["bytes.view","nv"]],["if",["=",["ext.data_model.doc_is_err","nvv"],1],["begin",["set","ok",0],["set","err",["ext.data_model.doc_error_msg","nvv"]],0],0],0],0],["if",["=","ok",1],["begin",["let","outv",["std.vec.with_capacity",["+",["bytes.len","payload"],1]]],["set","outv",["std.vec.extend_bytes","outv",["bytes.view","payload"]]],["set","outv",["std.vec.push","outv",10]],["let","out_text",["std.vec.as_bytes","outv"]],["let","w",["std.os.fs.write_all_v1","out_b","out_text",["view.to_bytes","capsv"]]],["if",["=",["result_i32.is_ok","w"],1],0,["begin",["set","ok",0],["set","err",["bytes.lit","write failed"]],0]],0],0],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.alloc",0],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["let","msgv",["std.vec.with_capacity",["+",["view.len","out_path"],20]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.lit","ok: wrote "]]],["set","msgv",["std.vec.extend_bytes","msgv","out_path"]],["set","msgv",["std.vec.push","msgv",10]],["return",["std.vec.as_bytes","msgv"]]]],0],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.alloc",0],["bytes.view","err"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err"]]]]]]],["bytes.alloc",0]],"kind":"defn","name":"app._registry_gen_native_v1","params":[{"name":"in_path","ty":"bytes_view"},{"name":"out_path","ty":"bytes_view"},{"name":"mcpb_path","ty":"bytes_view"},{"name":"schema_path_opt","ty":"bytes_view"},{"name":"machine_json","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","m_doc",["ext.json.data_model.parse","manifest_json"]],["let","m_docv",["bytes.view","m_doc"]],["if",["=",["ext.data_model.doc_is_err","m_docv"],1],["begin",["let","_bytes_owner_19",["ext.data_model.doc_error_msg","m_docv"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_19"]]]],0],["let","root_off",["ext.data_model.root_offset","m_docv"]],["if",["=",["ext.data_model.root_kind","m_docv"],5],0,["begin",["let","_bytes_owner_20",["bytes.lit","manifest must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_20"]]]]],["let","_bytes_owner_21",["bytes.lit","identifier"]],["let","identifier",["app._dm_map_get_string_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_21"]]],["if",["=",["bytes.len","identifier"],0],["begin",["let","_bytes_owner_22",["bytes.lit","manifest identifier is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_22"]]]],0],["if",["=",["app._bytes_contains_mcp_v1",["bytes.view","identifier"]],1],0,["begin",["let","_bytes_owner_23",["bytes.lit","identifier must contain substring 'mcp'"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_23"]]]]],["let","_bytes_owner_24",["bytes.lit","version"]],["let","version",["app._dm_map_get_string_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_24"]]],["if",["=",["bytes.len","version"],0],["begin",["let","_bytes_owner_25",["bytes.lit","manifest version is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_25"]]]],0],["let","_bytes_owner_26",["bytes.lit","description"]],["let","description",["app._dm_map_get_string_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_26"]]],["if",["=",["bytes.len","description"],0],["begin",["let","_bytes_owner_27",["bytes.lit","manifest description is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_27"]]]],0],["let","_bytes_owner_28",["bytes.lit","display_name"]],["let","display_name",["app._dm_map_get_string_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_28"]]],["if",["=",["bytes.len","display_name"],0],["begin",["let","_bytes_owner_29",["bytes.lit","manifest display_name is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_29"]]]],0],["let","out_payload",["std.vec.with_capacity",0]],["let","out_count",0],["let","v_schema",["ext.data_model.value_string","schema_url"]],["let","v_name",["ext.data_model.value_string",["bytes.view","identifier"]]],["let","v_version",["ext.data_model.value_string",["bytes.view","version"]]],["let","v_description",["ext.data_model.value_string",["bytes.view","description"]]],["let","v_title",["ext.data_model.value_string",["bytes.view","display_name"]]],["let","_bytes_owner_30",["bytes.lit","$schema"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_30"],["bytes.view","v_schema"]]],["set","out_count",["+","out_count",1]],["let","_bytes_owner_31",["bytes.lit","name"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_31"],["bytes.view","v_name"]]],["set","out_count",["+","out_count",1]],["let","_bytes_owner_32",["bytes.lit","version"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_32"],["bytes.view","v_version"]]],["set","out_count",["+","out_count",1]],["let","_bytes_owner_33",["bytes.lit","description"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_33"],["bytes.view","v_description"]]],["set","out_count",["+","out_count",1]],["let","_bytes_owner_34",["bytes.lit","title"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_34"],["bytes.view","v_title"]]],["set","out_count",["+","out_count",1]],["let","_bytes_owner_35",["bytes.lit","websiteUrl"]],["let","website",["app._dm_map_get_string_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_35"]]],["if",[">",["bytes.len","website"],0],["begin",["let","v_website",["ext.data_model.value_string",["bytes.view","website"]]],["let","_bytes_owner_36",["bytes.lit","websiteUrl"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_36"],["bytes.view","v_website"]]],["set","out_count",["+","out_count",1]],0],0],["let","_bytes_owner_37",["bytes.lit","_meta"]],["let","meta_val",["app._dm_map_get_value_bytes_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_37"]]],["if",[">",["bytes.len","meta_val"],0],["begin",["if",["=",["ext.data_model.kind_at",["bytes.view","meta_val"],0],5],0,["begin",["let","_bytes_owner_38",["bytes.lit","_meta must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_38"]]]]],["let","_bytes_owner_39",["bytes.lit","_meta"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_39"],["bytes.view","meta_val"]]],["set","out_count",["+","out_count",1]],0],0],["let","_bytes_owner_40",["bytes.lit","packages"]],["let","packages_off",["ext.data_model.map_find","m_docv","root_off",["bytes.view","_bytes_owner_40"]]],["if",["<","packages_off",0],0,["begin",["if",["=",["ext.data_model.kind_at","m_docv","packages_off"],4],0,["begin",["let","_bytes_owner_41",["bytes.lit","packages must be an array"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_41"]]]]],["let","count",["ext.data_model.seq_len","m_docv","packages_off"]],["if",["<=","count",0],0,["begin",["let","pkg_payload",["std.vec.with_capacity",0]],["for","i",0,"count",["begin",["let","pkg_off",["ext.data_model.seq_get","m_docv","packages_off","i"]],["if",["=",["ext.data_model.kind_at","m_docv","pkg_off"],5],0,["begin",["let","_bytes_owner_42",["bytes.lit","package entry must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_42"]]]]],["let","_bytes_owner_43",["bytes.lit","registryType"]],["let","registry_type",["app._dm_map_get_string_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_43"]]],["if",["=",["bytes.len","registry_type"],0],["begin",["let","_bytes_owner_44",["bytes.lit","package registryType is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_44"]]]],0],["let","_bytes_owner_45",["bytes.lit","identifier"]],["let","pkg_id",["app._dm_map_get_string_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_45"]]],["if",["=",["bytes.len","pkg_id"],0],["begin",["let","_bytes_owner_46",["bytes.lit","package identifier is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_46"]]]],0],["if",["=",["app._bytes_contains_mcp_v1",["bytes.view","pkg_id"]],1],0,["begin",["let","_bytes_owner_47",["bytes.lit","package identifier must contain substring 'mcp'"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_47"]]]]],["let","transport_val",["bytes.alloc",0]],["let","_bytes_owner_48",["bytes.lit","transport"]],["let","transport_bytes",["app._dm_map_get_value_bytes_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_48"]]],["if",[">",["bytes.len","transport_bytes"],0],["if",["=",["ext.data_model.kind_at",["bytes.view","transport_bytes"],0],5],["begin",["set","transport_val","transport_bytes"],0],0],0],["if",[">",["bytes.len","transport_val"],0],0,["begin",["if",["=",["bytes.eq","registry_type",["bytes.lit","mcpb"]],1],["set","transport_val",["app._transport_stdio_value_v1"]],["begin",["let","_bytes_owner_49",["bytes.lit","url"]],["let","url",["app._dm_map_get_string_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_49"]]],["if",[">",["bytes.len","url"],0],["set","transport_val",["app._transport_http_value_v1",["bytes.view","url"]]],["set","transport_val",["app._transport_stdio_value_v1"]]],0]],0]],["let","sha",["bytes.alloc",0]],["if",["=",["if",["=",["bytes.eq","registry_type",["bytes.lit","mcpb"]],1],[">",["view.len","mcpb_sha"],0],0],1],["begin",["set","sha",["view.to_bytes","mcpb_sha"]],0],0],["if",["=",["bytes.len","sha"],0],["begin",["let","_bytes_owner_50",["bytes.lit","fileSha256"]],["set","sha",["app._dm_map_get_string_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_50"]]]],0],["let","_bytes_owner_51",["bytes.lit","version"]],["let","pkg_version",["app._dm_map_get_string_or_empty_v1","m_docv","pkg_off",["bytes.view","_bytes_owner_51"]]],["let","p_payload",["std.vec.with_capacity",0]],["let","p_count",0],["let","_bytes_owner_52",["bytes.lit","registryType"]],["let","_bytes_owner_53",["ext.data_model.value_string",["bytes.view","registry_type"]]],["set","p_payload",["app._dm_payload_push_entry_v1","p_payload",["bytes.view","_bytes_owner_52"],["bytes.view","_bytes_owner_53"]]],["set","p_count",["+","p_count",1]],["let","_bytes_owner_54",["bytes.lit","identifier"]],["let","_bytes_owner_55",["ext.data_model.value_string",["bytes.view","pkg_id"]]],["set","p_payload",["app._dm_payload_push_entry_v1","p_payload",["bytes.view","_bytes_owner_54"],["bytes.view","_bytes_owner_55"]]],["set","p_count",["+","p_count",1]],["let","_bytes_owner_56",["bytes.lit","transport"]],["set","p_payload",["app._dm_payload_push_entry_v1","p_payload",["bytes.view","_bytes_owner_56"],["bytes.view","transport_val"]]],["set","p_count",["+","p_count",1]],["if",[">",["bytes.len","pkg_version"],0],["begin",["let","_bytes_owner_57",["bytes.lit","version"]],["let","_bytes_owner_58",["ext.data_model.value_string",["bytes.view","pkg_version"]]],["set","p_payload",["app._dm_payload_push_entry_v1","p_payload",["bytes.view","_bytes_owner_57"],["bytes.view","_bytes_owner_58"]]],["set","p_count",["+","p_count",1]],0],0],["if",[">",["bytes.len","sha"],0],["begin",["let","_bytes_owner_59",["bytes.lit","fileSha256"]],["let","_bytes_owner_60",["ext.data_model.value_string",["bytes.view","sha"]]],["set","p_payload",["app._dm_payload_push_entry_v1","p_payload",["bytes.view","_bytes_owner_59"],["bytes.view","_bytes_owner_60"]]],["set","p_count",["+","p_count",1]],0],0],["let","p_payload_b",["std.vec.as_bytes","p_payload"]],["let","p_map",["app._dm_map_from_payload_v1","p_count",["bytes.view","p_payload_b"]]],["set","pkg_payload",["app._dm_payload_push_value_v1","pkg_payload",["bytes.view","p_map"]]],0]],["let","pkg_payload_b",["std.vec.as_bytes","pkg_payload"]],["let","pkg_seq",["app._dm_seq_from_payload_v1","count",["bytes.view","pkg_payload_b"]]],["let","_bytes_owner_61",["bytes.lit","packages"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_61"],["bytes.view","pkg_seq"]]],["set","out_count",["+","out_count",1]],0]],0]],["let","_bytes_owner_62",["bytes.lit","remotes"]],["let","remotes_val",["app._dm_map_get_value_bytes_or_empty_v1","m_docv","root_off",["bytes.view","_bytes_owner_62"]]],["if",[">",["bytes.len","remotes_val"],0],["begin",["if",["=",["ext.data_model.kind_at",["bytes.view","remotes_val"],0],4],0,["begin",["let","_bytes_owner_63",["bytes.lit","remotes must be an array"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_63"]]]]],["let","r_len",["ext.data_model.seq_len",["bytes.view","remotes_val"],0]],["if",["<=","r_len",0],0,["begin",["let","_bytes_owner_64",["bytes.lit","remotes"]],["set","out_payload",["app._dm_payload_push_entry_v1","out_payload",["bytes.view","_bytes_owner_64"],["bytes.view","remotes_val"]]],["set","out_count",["+","out_count",1]],0]],0],0],["let","out_payload_b",["std.vec.as_bytes","out_payload"]],["let","out_map",["app._dm_map_from_payload_v1","out_count",["bytes.view","out_payload_b"]]],["ext.data_model.doc_ok",["bytes.view","out_map"]]],"kind":"defn","name":"app._registry_generate_server_doc_or_err_v1","params":[{"name":"manifest_json","ty":"bytes_view"},{"name":"schema_url","ty":"bytes_view"},{"name":"mcpb_sha","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","b_error_prefix",["bytes.lit","error: "]],["let","out",["std.vec.with_capacity",["+",["view.len","msg"],16]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_error_prefix"]]],["set","out",["std.vec.extend_bytes","out","msg"]],["set","out",["std.vec.push","out",10]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._render_error_human_v1","params":[{"name":"msg","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","count_dec",["std.fmt.u32_to_dec","created_count"]],["let","b_ok_prefix",["bytes.lit","ok: created "]],["let","b_under",["bytes.lit"," file(s) under "]],["let","b_next_prefix",["bytes.lit","next: "]],["let","out",["std.vec.with_capacity",256]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_ok_prefix"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","count_dec"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_under"]]],["set","out",["std.vec.extend_bytes","out","dir"]],["set","out",["std.vec.push","out",10]],["let","x7sl",["std.text.ascii.split_lines_view","steps_text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","steps_text","x7sl_v","i"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_next_prefix"]]],["set","out",["std.vec.extend_bytes","out","line"]],["set","out",["std.vec.push","out",10]],["set","i",["+","i",1]],0]],["std.vec.as_bytes","out"]],"kind":"defn","name":"app._render_ok_human_v1","params":[{"name":"dir","ty":"bytes_view"},{"name":"created_count","ty":"i32"},{"name":"steps_text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","env_path",["std.os.env.get",["bytes.lit","PATH"]]],["let","env_home",["std.os.env.get",["bytes.lit","HOME"]]],["let","exe_b",["view.to_bytes","exe"]],["let","exe_b_arg",["view.to_bytes",["bytes.view","exe_b"]]],["let","use_env",["if",["=",["app._bytes_has_path_sep_v1","exe"],1],0,1]],["let","req_exe",["if",["=","use_env",1],["bytes.lit","/usr/bin/env"],"exe_b"]],["let","reqb",["std.os.process.req_v1.new","req_exe"]],["if",[">",["bytes.len","env_path"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","PATH"],"env_path"]],0],["if",[">",["bytes.len","env_home"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","HOME"],"env_home"]],0],["if",[">",["view.len","cwd"],0],["set","reqb",["std.os.process.req_v1.cwd","reqb",["view.to_bytes","cwd"]]],0],["if",["=","use_env",1],["set","reqb",["std.os.process.req_v1.arg","reqb","exe_b_arg"]],0],["let","x7sl",["std.text.ascii.split_lines_view","args_text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","args_text","x7sl_v","i"]],["if",[">",["view.len","line"],0],["set","reqb",["std.os.process.req_v1.arg","reqb",["view.to_bytes","line"]]],0],["set","i",["+","i",1]],0]],["let","req",["std.os.process.req_v1.finish","reqb"]],["let","caps",["app._proc_caps_v1"]],["std.os.process.run_capture_v1","req","caps"]],"kind":"defn","name":"app._run_cmd_capture_v1","params":[{"name":"exe","ty":"bytes_view"},{"name":"cwd","ty":"bytes_view"},{"name":"args_text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","exe_override",["std.os.env.get",["bytes.lit","X07_MCP_X07"]]],["let","env_path",["std.os.env.get",["bytes.lit","PATH"]]],["let","env_home",["std.os.env.get",["bytes.lit","HOME"]]],["let","exe_default",["if",[">",["bytes.len","env_home"],0],["std.path.join",["view.to_bytes",["bytes.view","env_home"]],["bytes.lit",".x07/bin/x07"]],["bytes.lit","/usr/local/bin/x07"]]],["let","exe",["if",[">",["bytes.len","exe_override"],0],"exe_override","exe_default"]],["let","reqb",["std.os.process.req_v1.new","exe"]],["if",[">",["bytes.len","env_path"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","PATH"],"env_path"]],0],["if",[">",["bytes.len","env_home"],0],["set","reqb",["std.os.process.req_v1.env","reqb",["bytes.lit","HOME"],"env_home"]],0],["if",[">",["view.len","cwd"],0],["set","reqb",["std.os.process.req_v1.cwd","reqb",["view.to_bytes","cwd"]]],0],["let","x7sl",["std.text.ascii.split_lines_view","args_text"]],["let","x7sl_v",["bytes.view","x7sl"]],["let","n",["std.text.slices.count_v1","x7sl_v"]],["let","i",0],["for","_",0,"n",["begin",["let","line",["std.text.slices.view_at_v1","args_text","x7sl_v","i"]],["if",[">",["view.len","line"],0],["set","reqb",["std.os.process.req_v1.arg","reqb",["view.to_bytes","line"]]],0],["set","i",["+","i",1]],0]],["let","req",["std.os.process.req_v1.finish","reqb"]],["let","caps",["app._proc_caps_v1"]],["std.os.process.run_capture_v1","req","caps"]],"kind":"defn","name":"app._run_x07_capture_v1","params":[{"name":"cwd","ty":"bytes_view"},{"name":"args_text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","caps",["std.os.fs.spec.caps_default_v1"]],["let","caps_v",["bytes.view","caps"]],["let","schema_path_b",["view.to_bytes","schema_path"]],["let","read",["std.os.fs.read_all_v1","schema_path_b",["view.to_bytes","caps_v"]]],["if",["!=",["result_bytes.err_code","read"],0],["begin",["let","_bytes_owner_65",["bytes.lit","missing schema file"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_65"]]]],0],["let","schema_json",["result_bytes.unwrap_or","read",["bytes.alloc",0]]],["let","compiled",["ext.jsonschema.compile_v1",["bytes.view","schema_json"]]],["let","compiledv",["bytes.view","compiled"]],["if",["=",["ext.jsonschema.is_err_v1","compiledv"],1],["begin",["let","_bytes_owner_66",["ext.jsonschema.err_msg_v1","compiledv"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_66"]]]],0],["let","val",["ext.jsonschema.validate_v1","compiledv","instance_json"]],["let","valv",["bytes.view","val"]],["if",["=",["ext.jsonschema.is_err_v1","valv"],1],["begin",["let","_bytes_owner_67",["ext.jsonschema.errors_json_v1","valv"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_67"]]]],0],["let","_bytes_owner_68",["ext.data_model.value_null"]],["ext.data_model.doc_ok",["bytes.view","_bytes_owner_68"]]],"kind":"defn","name":"app._schema_validate_json_or_err_doc_v1","params":[{"name":"schema_path","ty":"bytes_view"},{"name":"instance_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","args_v",["std.vec.with_capacity",128]],["set","args_v",["std.vec.extend_bytes","args_v","path"]],["set","args_v",["std.vec.push","args_v",10]],["let","args_text",["std.vec.as_bytes","args_v"]],["let","resp",["app._run_cmd_capture_v1",["bytes.lit","sha256sum"],["bytes.lit","."],["bytes.view","args_text"]]],["let","resp2",["bytes.alloc",0]],["if",["=",["std.os.process.is_err",["bytes.view","resp"]],1],["begin",["let","args2_v",["std.vec.with_capacity",128]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.lit","-a"]]],["set","args2_v",["std.vec.push","args2_v",10]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.lit","256"]]],["set","args2_v",["std.vec.push","args2_v",10]],["set","args2_v",["std.vec.extend_bytes","args2_v","path"]],["set","args2_v",["std.vec.push","args2_v",10]],["let","args2_text",["std.vec.as_bytes","args2_v"]],["set","resp2",["app._run_cmd_capture_v1",["bytes.lit","shasum"],["bytes.lit","."],["bytes.view","args2_text"]]],0],0],["let","_bytes_owner_69",["if",["=",["bytes.len","resp2"],0],"resp","resp2"]],["let","usev",["bytes.view","_bytes_owner_69"]],["if",["=",["std.os.process.is_err","usev"],1],["begin",["let","_bytes_owner_70",["bytes.lit","sha256 tool not available"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_70"]]]],0],["if",["!=",["std.os.process.resp_exit_code","usev"],0],["begin",["let","_bytes_owner_71",["std.os.process.resp_stderr","usev"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_71"]]]],0],["let","out",["std.os.process.resp_stdout","usev"]],["let","outv",["bytes.view","out"]],["if",["<u",["view.len","outv"],64],["begin",["let","_bytes_owner_72",["bytes.lit","sha256 output parse failed"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_72"]]]],0],["let","sha_v",["view.slice","outv",0,64]],["let","sha",["view.to_bytes","sha_v"]],["if",["=",["app._is_hex64_lower_v1",["bytes.view","sha"]],1],0,["begin",["let","_bytes_owner_73",["bytes.lit","sha256 output not 64 lowercase hex"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_73"]]]]],["let","val",["ext.data_model.value_string",["bytes.view","sha"]]],["ext.data_model.doc_ok",["bytes.view","val"]]],"kind":"defn","name":"app._sha256_file_doc_v1","params":[{"name":"path","ty":"bytes_view"}],"result":"bytes"},{"body":["bytes.lit","{\"schema_version\":\"x07cli.specrows@0.1.0\",\"app\":{\"name\":\"x07-mcp\",\"version\":\"0.1.0\",\"about\":\"X07 MCP kit tooling.\"},\"rows\":[[\"root\",\"flag\",\"\",\"--cli-specrows\",\"cli_specrows\",\"\",{\"global\":true}],[\"scaffold\",\"arg\",\"SUBCMD\",\"subcmd\",\"\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--template\",\"template\",\"STR\",\"\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"\",{\"required\":true}],[\"scaffold\",\"opt\",\"\",\"--toolchain-version\",\"toolchain_version\",\"STR\",\"\",{}],[\"scaffold\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"check\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"\",{\"required\":true}],[\"check\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"bundle\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"\",{}],[\"bundle\",\"opt\",\"\",\"--out-dir\",\"out_dir\",\"PATH\",\"\",{}],[\"bundle\",\"flag\",\"\",\"--mcpb\",\"mcpb\",\"\",{}],[\"bundle\",\"opt\",\"\",\"--server-dir\",\"server-dir\",\"PATH\",\"\",{}],[\"bundle\",\"opt\",\"\",\"--out\",\"out\",\"PATH\",\"\",{}],[\"bundle\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"registry\",\"arg\",\"SUBCMD\",\"subcmd\",\"\",{\"required\":true}],[\"registry\",\"opt\",\"\",\"--in\",\"in\",\"PATH\",\"\",{}],[\"registry\",\"opt\",\"\",\"--out\",\"out\",\"PATH\",\"\",{}],[\"registry\",\"opt\",\"\",\"--mcpb\",\"mcpb\",\"PATH\",\"\",{}],[\"registry\",\"opt\",\"\",\"--schema\",\"schema\",\"PATH\",\"\",{}],[\"registry\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"publish\",\"flag\",\"\",\"--dry-run\",\"dry-run\",\"\",{}],[\"publish\",\"opt\",\"\",\"--server-json\",\"server-json\",\"PATH\",\"\",{}],[\"publish\",\"opt\",\"\",\"--mcpb\",\"mcpb\",\"PATH\",\"\",{}],[\"publish\",\"opt\",\"\",\"--schema\",\"schema\",\"PATH\",\"\",{}],[\"publish\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"conformance\",\"opt\",\"\",\"--url\",\"url\",\"STR\",\"\",{}],[\"conformance\",\"opt\",\"\",\"--baseline\",\"baseline\",\"PATH\",\"\",{}],[\"conformance\",\"opt\",\"\",\"--spawn\",\"spawn\",\"STR\",\"\",{}],[\"conformance\",\"opt\",\"\",\"--mode\",\"mode\",\"STR\",\"\",{}],[\"conformance\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}],[\"dev\",\"opt\",\"\",\"--dir\",\"dir\",\"PATH\",\"\",{}],[\"dev\",\"opt\",\"\",\"--cfg\",\"cfg\",\"PATH\",\"\",{}],[\"codegen\",\"opt\",\"\",\"--repo-root\",\"repo_root\",\"PATH\",\"\",{}],[\"codegen\",\"opt\",\"\",\"--machine\",\"machine\",\"STR\",\"\",{}]]}"],"kind":"defn","name":"app._spec_json_v1","params":[],"result":"bytes"},{"body":["bytes.lit","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"],"kind":"defn","name":"app._specbin_b64_v1","params":[],"result":"bytes"},{"body":["if",["bytes.eq","template",["bytes.lit","mcp-server"]],["x07.mcp.cli.assets.mcp-server.get_b64_v1","path"],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["x07.mcp.cli.assets.mcp-server-stdio.get_b64_v1","path"],["if",["bytes.eq","template",["bytes.lit","mcp-server-http"]],["x07.mcp.cli.assets.mcp-server-http.get_b64_v1","path"],["option_bytes.none"]]]],"kind":"defn","name":"app._template_get_b64_v1","params":[{"name":"template","ty":"bytes"},{"name":"path","ty":"bytes_view"}],"result":"option_bytes"},{"body":["if",["bytes.eq","template",["bytes.lit","mcp-server"]],["x07.mcp.cli.assets.mcp-server.paths_text_v1"],["if",["bytes.eq","template",["bytes.lit","mcp-server-stdio"]],["x07.mcp.cli.assets.mcp-server-stdio.paths_text_v1"],["if",["bytes.eq","template",["bytes.lit","mcp-server-http"]],["x07.mcp.cli.assets.mcp-server-http.paths_text_v1"],["bytes.alloc",0]]]],"kind":"defn","name":"app._template_paths_text_v1","params":[{"name":"template","ty":"bytes"}],"result":"bytes"},{"body":["begin",["let","payload",["std.vec.with_capacity",0]],["let","k_type",["bytes.lit","type"]],["let","k_url",["bytes.lit","url"]],["let","_bytes_owner_74",["bytes.lit","streamable-http"]],["let","v_type",["ext.data_model.value_string",["bytes.view","_bytes_owner_74"]]],["let","v_url",["ext.data_model.value_string","url"]],["set","payload",["app._dm_payload_push_entry_v1","payload",["bytes.view","k_type"],["bytes.view","v_type"]]],["set","payload",["app._dm_payload_push_entry_v1","payload",["bytes.view","k_url"],["bytes.view","v_url"]]],["let","payload_b",["std.vec.as_bytes","payload"]],["app._dm_map_from_payload_v1",2,["bytes.view","payload_b"]]],"kind":"defn","name":"app._transport_http_value_v1","params":[{"name":"url","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","payload",["std.vec.with_capacity",0]],["let","k_type",["bytes.lit","type"]],["let","_bytes_owner_75",["bytes.lit","stdio"]],["let","v_type",["ext.data_model.value_string",["bytes.view","_bytes_owner_75"]]],["set","payload",["app._dm_payload_push_entry_v1","payload",["bytes.view","k_type"],["bytes.view","v_type"]]],["let","payload_b",["std.vec.as_bytes","payload"]],["app._dm_map_from_payload_v1",1,["bytes.view","payload_b"]]],"kind":"defn","name":"app._transport_stdio_value_v1","params":[],"result":"bytes"},{"body":["begin",["let","_bytes_owner_76",["bytes.lit","name"]],["let","name",["app._dm_map_get_string_or_empty_v1","b","map_off",["bytes.view","_bytes_owner_76"]]],["if",["=",["app._bytes_contains_mcp_v1",["bytes.view","name"]],1],0,["begin",["let","_bytes_owner_77",["bytes.lit","name must contain substring 'mcp'"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_77"]]]]],["let","_bytes_owner_78",["bytes.lit","packages"]],["let","packages_off",["ext.data_model.map_find","b","map_off",["bytes.view","_bytes_owner_78"]]],["if",["<","packages_off",0],0,["begin",["if",["=",["ext.data_model.kind_at","b","packages_off"],4],0,["begin",["let","_bytes_owner_79",["bytes.lit","package entry must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_79"]]]]],["let","count",["ext.data_model.seq_len","b","packages_off"]],["for","i",0,"count",["begin",["let","pkg_off",["ext.data_model.seq_get","b","packages_off","i"]],["if",["=",["ext.data_model.kind_at","b","pkg_off"],5],0,["begin",["let","_bytes_owner_80",["bytes.lit","package entry must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_80"]]]]],["let","_bytes_owner_81",["bytes.lit","identifier"]],["let","identifier",["app._dm_map_get_string_or_empty_v1","b","pkg_off",["bytes.view","_bytes_owner_81"]]],["if",["=",["bytes.len","identifier"],0],["begin",["let","_bytes_owner_82",["bytes.lit","package identifier is required"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_82"]]]],0],["if",["=",["app._bytes_contains_mcp_v1",["bytes.view","identifier"]],1],0,["begin",["let","_bytes_owner_83",["bytes.lit","package identifier must contain substring 'mcp'"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_83"]]]]],["let","_bytes_owner_84",["bytes.lit","registryType"]],["let","registry_type",["app._dm_map_get_string_or_empty_v1","b","pkg_off",["bytes.view","_bytes_owner_84"]]],["if",["=",["bytes.eq","registry_type",["bytes.lit","mcpb"]],1],["begin",["let","_bytes_owner_85",["bytes.lit","fileSha256"]],["let","sha",["app._dm_map_get_string_or_empty_v1","b","pkg_off",["bytes.view","_bytes_owner_85"]]],["if",["=",["bytes.len","sha"],0],["begin",["let","_bytes_owner_86",["bytes.lit","mcpb package requires fileSha256"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_86"]]]],0],["if",["=",["app._is_hex64_lower_v1",["bytes.view","sha"]],1],0,["begin",["let","_bytes_owner_87",["bytes.lit","mcpb package fileSha256 must match ^[0-9a-f]{64}$"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_87"]]]]],0],0],0]],0]],["let","_bytes_owner_88",["bytes.lit","_meta"]],["let","meta_off",["ext.data_model.map_find","b","map_off",["bytes.view","_bytes_owner_88"]]],["if",["<","meta_off",0],0,["begin",["if",["=",["ext.data_model.kind_at","b","meta_off"],5],0,["begin",["let","_bytes_owner_89",["bytes.lit","_meta must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_89"]]]]],["let","meta_len",["ext.data_model.map_len","b","meta_off"]],["if",["<","meta_len",0],["begin",["let","_bytes_owner_90",["bytes.lit","_meta must be an object"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_90"]]]],0],["let","allowed",["bytes.lit","io.modelcontextprotocol.registry/publisher-provided"]],["for","j",0,"meta_len",["begin",["let","k",["ext.data_model.map_key_at","b","meta_off","j"]],["if",["=",["bytes.eq","k","allowed"],1],0,["begin",["let","_bytes_owner_91",["bytes.lit","_meta contains unsupported keys"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_91"]]]]],0]],["let","end",["ext.data_model.skip_value","b","meta_off"]],["if",["<","end",0],["begin",["let","_bytes_owner_92",["bytes.lit","_meta exceeds 4096 bytes"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_92"]]]],0],["let","meta_val",["view.to_bytes",["view.slice","b","meta_off",["-","end","meta_off"]]]],["let","meta_doc",["ext.data_model.doc_ok",["bytes.view","meta_val"]]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","meta_doc"]]],["let","json_docv",["bytes.view","json_doc"]],["if",["=",["ext.data_model.doc_is_err","json_docv"],1],["begin",["let","_bytes_owner_93",["bytes.lit","_meta exceeds 4096 bytes"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_93"]]]],0],["let","payload_len",["-",["view.len","json_docv"],1]],["if",["<=","payload_len",4096],0,["begin",["let","_bytes_owner_94",["bytes.lit","_meta exceeds 4096 bytes"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","_bytes_owner_94"]]]]],0]],["let","_bytes_owner_95",["ext.data_model.value_null"]],["ext.data_model.doc_ok",["bytes.view","_bytes_owner_95"]]],"kind":"defn","name":"app._validate_non_schema_constraints_or_err_doc_v1","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","argv_v1",["view.to_bytes","argv_v1_in"]],["let","argv_v1_parse",["view.to_bytes",["bytes.view","argv_v1"]]],["let","spec",["app._spec_json_v1"]],["let","specbin_b64",["app._specbin_b64_v1"]],["let","specbin_doc",["ext.base64.base64_decode",["bytes.view","specbin_b64"]]],["if",["=",["ext.base64.base64_is_err",["bytes.view","specbin_doc"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: internal error\n"]]],0],["let","specbin",["ext.base64.base64_get_bytes",["bytes.view","specbin_doc"]]],["let","specbin_parse",["view.to_bytes",["bytes.view","specbin"]]],["let","doc_final",["ext.cli.parse_compiled","specbin_parse","argv_v1_parse"]],["let","doc_retry",["bytes.alloc",0]],["if",["if",["=",["ext.cli.is_ok",["bytes.view","doc_final"]],0],["bytes.eq",["ext.cli.err_msg",["bytes.view","doc_final"]],["bytes.lit","too_many_args"]],0],["begin",["let","argv0_tok",["app._argv_first_token_v1",["bytes.view","argv_v1"]]],["if",["=",["app._bytes_has_path_sep_v1",["bytes.view","argv0_tok"]],1],["begin",["let","argv_v1_drop",["app._argv_drop_first_v1",["bytes.view","argv_v1"]]],["set","doc_retry",["ext.cli.parse_compiled","specbin","argv_v1_drop"]],["if",["=",["ext.cli.is_ok",["bytes.view","doc_retry"]],1],["set","doc_final",["view.to_bytes",["bytes.view","doc_retry"]]],0],0],0],0],0],["let","docv",["bytes.view","doc_final"]],["let","k_cli_specrows",["bytes.lit","cli_specrows"]],["let","b_error_prefix",["bytes.lit","error: "]],["let","k_version",["bytes.lit","version"]],["let","k_help",["bytes.lit","help"]],["let","k_subcmd",["bytes.lit","subcmd"]],["let","k_template",["bytes.lit","template"]],["let","k_dir",["bytes.lit","dir"]],["let","k_out_dir",["bytes.lit","out_dir"]],["let","k_cfg",["bytes.lit","cfg"]],["let","k_repo_root",["bytes.lit","repo_root"]],["let","k_machine",["bytes.lit","machine"]],["let","k_in",["bytes.lit","in"]],["let","k_out",["bytes.lit","out"]],["let","k_url",["bytes.lit","url"]],["let","k_baseline",["bytes.lit","baseline"]],["let","k_spawn",["bytes.lit","spawn"]],["let","k_mode",["bytes.lit","mode"]],["let","k_server_json",["bytes.lit","server-json"]],["let","k_mcpb",["bytes.lit","mcpb"]],["let","k_schema",["bytes.lit","schema"]],["let","k_server_dir",["bytes.lit","server-dir"]],["let","k_dry_run",["bytes.lit","dry-run"]],["let","b_pkg_lock_ok",["bytes.lit","pkg lock: ok\n"]],["let","b_arch_check_ok",["bytes.lit","arch check: ok\n"]],["let","b_tests_ok",["bytes.lit","tests: ok\n"]],["let","b_bundle_prefix_os",["bytes.lit","bundle\n--profile\nos\n--json=off\n--out\n"]],["let","b_bundle_router_ok",["bytes.lit","bundle router: ok\n"]],["let","b_bundle_prefix_worker",["bytes.lit","bundle\n--profile\nsandbox\n--program\nsrc/worker_main.x07.json\n--json=off\n--out\n"]],["let","b_bundle_worker_ok",["bytes.lit","bundle worker: ok\n"]],["let","b_codegen_asset_server",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server.x07.json"]],["let","b_codegen_asset_stdio",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server-stdio.x07.json"]],["let","b_codegen_asset_http",["bytes.lit","cli/src/x07/mcp/cli/assets/mcp-server-http.x07.json"]],["let","b_codegen_asset_shared",["bytes.lit","cli/src/x07/mcp/cli/assets/shared.x07.json"]],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_cli_specrows"]],1],["begin",["process.set_exit_code_v1",0],["let","spec_out",["app._spec_json_v1"]],["let","out",["std.vec.with_capacity",["+",["bytes.len","spec_out"],1]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","spec_out"]]],["set","out",["std.vec.push","out",10]],["return",["std.vec.as_bytes","out"]]],0],["if",["=",["ext.cli.is_ok","docv"],0],["begin",["process.set_exit_code_v1",2],["let","msg",["ext.cli.err_msg","docv"]],["let","usage",["ext.cli.err_usage","docv"]],["let","out",["std.vec.with_capacity",["+",["+",["bytes.len","msg"],["bytes.len","usage"]],32]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","b_error_prefix"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","msg"]]],["set","out",["std.vec.push","out",10]],["set","out",["std.vec.extend_bytes","out",["bytes.view","usage"]]],["set","out",["std.vec.push","out",10]],["return",["std.vec.as_bytes","out"]]],0],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_version"]],1],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","x07-mcp 0.1.0\n"]]],0],["let","cmd",["ext.cli.matches_cmd","docv"]],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_help"]],1],["begin",["process.set_exit_code_v1",0],["if",["bytes.eq","cmd",["bytes.lit","scaffold"]],["return",["app._help_scaffold_v1"]],["if",["bytes.eq","cmd",["bytes.lit","check"]],["return",["app._help_check_v1"]],["if",["bytes.eq","cmd",["bytes.lit","bundle"]],["return",["app._help_bundle_v1"]],["if",["bytes.eq","cmd",["bytes.lit","registry"]],["return",["app._help_registry_v1"]],["if",["bytes.eq","cmd",["bytes.lit","publish"]],["return",["app._help_publish_v1"]],["if",["bytes.eq","cmd",["bytes.lit","dev"]],["return",["app._help_dev_v1"]],["if",["bytes.eq","cmd",["bytes.lit","codegen"]],["return",["app._help_codegen_v1"]],["if",["bytes.eq","cmd",["bytes.lit","conformance"]],["return",["app._help_conformance_v1"]],["return",["app._help_root_v1"]]]]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","check"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","steps_out",["std.vec.with_capacity",256]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","cfg_rel_check",["bytes.lit","config/mcp.server.json"]],["let","cfg_path_check",["std.path.join",["view.to_bytes","dir_v"],["view.to_bytes",["bytes.view","cfg_rel_check"]]]],["let","cfg_json_check",["std.fs.read",["bytes.view","cfg_path_check"]]],["let","cfg_doc_b_check",["ext.json.data_model.parse",["bytes.view","cfg_json_check"]]],["let","cfg_doc_check",["bytes.view","cfg_doc_b_check"]],["let","cfg_valid_check",["if",["=",["ext.data_model.doc_is_err","cfg_doc_check"],0],["=",["ext.data_model.root_kind","cfg_doc_check"],5],0]],["if",["if",["=","ok",1],["=","cfg_valid_check",0],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","invalid config/mcp.server.json"]],0],0],["let","cfg_root_check",["if",["=","cfg_valid_check",1],["ext.data_model.root_offset","cfg_doc_check"],-1]],["let","transport_off_check",["if",[">=","cfg_root_check",0],["ext.data_model.map_find","cfg_doc_check","cfg_root_check",["bytes.lit","transport"]],-1]],["let","auth_off_check",["if",[">=","cfg_root_check",0],["ext.data_model.map_find","cfg_doc_check","cfg_root_check",["bytes.lit","auth"]],-1]],["let","transport_kind_check",["bytes.lit","stdio"]],["let","bind_host_check",["bytes.lit","127.0.0.1"]],["let","auth_mode_check",["bytes.lit","none"]],["let","origin_allow_missing_check",1],["let","session_mode_check",["bytes.lit","required"]],["if",["=","cfg_valid_check",1],["begin",["if",[">=","transport_off_check",0],["begin",["let","kind_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","kind"]]],["if",["if",[">=","kind_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","kind_off_check"],3],0],["set","transport_kind_check",["ext.data_model.string_get","cfg_doc_check","kind_off_check"]],0],["let","bind_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","bind_host"]]],["if",["if",[">=","bind_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","bind_off_check"],3],0],["set","bind_host_check",["ext.data_model.string_get","cfg_doc_check","bind_off_check"]],0],["let","origin_missing_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","origin_allow_missing"]]],["if",["if",[">=","origin_missing_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","origin_missing_off_check"],1],0],["set","origin_allow_missing_check",["ext.data_model.bool_get","cfg_doc_check","origin_missing_off_check"]],0],["let","session_mode_off_check",["ext.data_model.map_find","cfg_doc_check","transport_off_check",["bytes.lit","session_mode"]]],["if",["if",[">=","session_mode_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","session_mode_off_check"],3],0],["set","session_mode_check",["ext.data_model.string_get","cfg_doc_check","session_mode_off_check"]],0],0],0],["if",[">=","auth_off_check",0],["begin",["let","auth_mode_off_check",["ext.data_model.map_find","cfg_doc_check","auth_off_check",["bytes.lit","mode"]]],["if",["if",[">=","auth_mode_off_check",0],["=",["ext.data_model.kind_at","cfg_doc_check","auth_mode_off_check"],3],0],["set","auth_mode_check",["ext.data_model.string_get","cfg_doc_check","auth_mode_off_check"]],0],0],0],0],0],["let","is_http_check",["if",["=",["bytes.eq",["bytes.view","transport_kind_check"],["bytes.lit","http"]],1],1,0]],["let","is_loopback_check",["if",["if",["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","127.0.0.1"]],1],1,["if",["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","localhost"]],1],1,["=",["bytes.eq",["bytes.view","bind_host_check"],["bytes.lit","::1"]],1]]],1,0]],["if",["if",["if",["if",["=","ok",1],["=","is_http_check",1],0],["=","is_loopback_check",0],0],["=",["bytes.eq",["bytes.view","auth_mode_check"],["bytes.lit","none"]],1],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","http non-loopback bind requires auth.mode=oauth2"]],0],0],["if",["if",["if",["if",["=","ok",1],["=","is_http_check",1],0],["=","is_loopback_check",0],0],["=","origin_allow_missing_check",1],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","http non-loopback bind requires strict Origin policy"]],0],0],["if",["if",["=","ok",1],["=",["bytes.eq",["bytes.view","session_mode_check"],["bytes.lit","disabled"]],1],0],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.lit","warning: sessions disabled\n"]]],0],["if",["if",["=","ok",1],["=","cfg_valid_check",1],0],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.lit","config gates: ok\n"]]],0],["let","args_pkg",["bytes.lit","pkg\nlock\n--project\nx07.json\n--check\n--json=off\n"]],["let","resp_pkg",["app._run_x07_capture_v1","dir_v",["bytes.view","args_pkg"]]],["let","resp_pkg_v",["bytes.view","resp_pkg"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_pkg_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 pkg lock failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_pkg_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 pkg lock failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_pkg_lock_ok"]]],0],0],0],["let","args_arch",["bytes.lit","arch\ncheck\n--repo-root\n.\n--manifest\narch/manifest.x07arch.json\n--lock\narch/manifest.lock.json\n--json=off\n"]],["let","resp_arch",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args_arch"]],["bytes.alloc",0]]],["let","resp_arch_v",["bytes.view","resp_arch"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_arch_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 arch check failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_arch_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 arch check failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_arch_check_ok"]]],0],0],0],["let","args_test",["bytes.lit","test\n--manifest\ntests/tests.json\n--json=off\n"]],["let","resp_test",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args_test"]],["bytes.alloc",0]]],["let","resp_test_v",["bytes.view","resp_test"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_test_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_test_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 test failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_tests_ok"]]],0],0],0],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","bundle"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","out_dir",["app._opt_v1","docv",["bytes.view","k_out_dir"]]],["if",["=",["bytes.len","out_dir"],0],["set","out_dir",["bytes.lit","out"]],0],["if",["=",["app._is_bad_rel_path_v1",["bytes.view","out_dir"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: --out-dir must be a relative path\n"]]],0],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","mcpb_mode",["app._flag_present_v1","docv",["bytes.view","k_mcpb"]]],["if",["=","mcpb_mode",1],["begin",["let","server_dir",["app._opt_v1","docv",["bytes.view","k_server_dir"]]],["if",["=",["bytes.len","server_dir"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: missing --server-dir\\n"]]],0],["let","out_file",["app._opt_v1","docv",["bytes.view","k_out"]]],["let","args_v_mcpb",["std.vec.with_capacity",128]],["set","args_v_mcpb",["std.vec.extend_bytes","args_v_mcpb",["bytes.lit","--server-dir"]]],["set","args_v_mcpb",["std.vec.push","args_v_mcpb",10]],["set","args_v_mcpb",["std.vec.extend_bytes","args_v_mcpb",["bytes.view","server_dir"]]],["set","args_v_mcpb",["std.vec.push","args_v_mcpb",10]],["if",[">",["bytes.len","out_file"],0],["begin",["set","args_v_mcpb",["std.vec.extend_bytes","args_v_mcpb",["bytes.lit","--out"]]],["set","args_v_mcpb",["std.vec.push","args_v_mcpb",10]],["set","args_v_mcpb",["std.vec.extend_bytes","args_v_mcpb",["bytes.view","out_file"]]],["set","args_v_mcpb",["std.vec.push","args_v_mcpb",10]],0],0],["let","args_mcpb",["std.vec.as_bytes","args_v_mcpb"]],["let","resp_mcpb",["app._run_cmd_capture_v1",["bytes.lit","servers/_shared/publish/build_from_server_dir.sh"],["bytes.lit","."],["bytes.view","args_mcpb"]]],["let","resp_mcpb_v",["bytes.view","resp_mcpb"]],["let","ok_mcpb",1],["let","err_mcpb",["bytes.alloc",0]],["if",["=",["std.os.process.is_err","resp_mcpb_v"],1],["begin",["set","ok_mcpb",0],["set","err_mcpb",["bytes.lit","mcpb bundle failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_mcpb_v"],0],["begin",["set","ok_mcpb",0],["set","err_mcpb",["std.os.process.resp_stderr","resp_mcpb_v"]],0],0]],["let","stdout_b",["if",["=","ok_mcpb",1],["std.os.process.resp_stdout","resp_mcpb_v"],["bytes.alloc",0]]],["if",["=","ok_mcpb",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.alloc",0],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["if",[">",["bytes.len","stdout_b"],0],"stdout_b",["bytes.lit","ok\\n"]]]]]],["begin",["let","err_msg","err_mcpb"],["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.alloc",0],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["let","router_out",["std.path.join",["view.to_bytes",["bytes.view","out_dir"]],["bytes.lit","mcp-router"]]],["let","worker_out",["std.path.join",["view.to_bytes",["bytes.view","out_dir"]],["bytes.lit","mcp-worker"]]],["let","steps_out",["std.vec.with_capacity",256]],["let","created_out",["std.vec.with_capacity",128]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","router_out"]]],["set","created_out",["std.vec.push","created_out",10]],["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","worker_out"]]],["set","created_out",["std.vec.push","created_out",10]],["let","args1_v",["std.vec.with_capacity",0]],["set","args1_v",["std.vec.extend_bytes","args1_v",["bytes.view","b_bundle_prefix_os"]]],["set","args1_v",["std.vec.extend_bytes","args1_v",["bytes.view","router_out"]]],["set","args1_v",["std.vec.push","args1_v",10]],["let","args1",["std.vec.as_bytes","args1_v"]],["let","resp1",["app._run_x07_capture_v1","dir_v",["bytes.view","args1"]]],["let","resp1_v",["bytes.view","resp1"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp1_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle router failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp1_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle router failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_bundle_router_ok"]]],0],0],0],["let","args2_v",["std.vec.with_capacity",0]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.view","b_bundle_prefix_worker"]]],["set","args2_v",["std.vec.extend_bytes","args2_v",["bytes.view","worker_out"]]],["set","args2_v",["std.vec.push","args2_v",10]],["let","args2",["std.vec.as_bytes","args2_v"]],["let","resp2",["if",["=","ok",1],["app._run_x07_capture_v1","dir_v",["bytes.view","args2"]],["bytes.alloc",0]]],["let","resp2_v",["bytes.view","resp2"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp2_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle worker failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp2_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 bundle worker failed"]],0],0]],["if",["=","ok",1],["set","steps_out",["std.vec.extend_bytes","steps_out",["bytes.view","b_bundle_worker_ok"]]],0],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","codegen"]],["begin",["let","repo_root",["app._opt_v1","docv",["bytes.view","k_repo_root"]]],["if",["=",["bytes.len","repo_root"],0],["set","repo_root",["bytes.lit","."]],0],["let","repo_root_v",["bytes.view","repo_root"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","created_out",["std.vec.with_capacity",256]],["let","steps_out",["std.vec.with_capacity",64]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","args_a",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server\n--module-id\nx07.mcp.cli.assets.mcp-server\n--out\ncli/src/x07/mcp/cli/assets/mcp-server.x07.json\n"]],["let","resp_a",["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_a"]]],["let","resp_a_v",["bytes.view","resp_a"]],["if",["=",["std.os.process.is_err","resp_a_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_a_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server)"]],0],0]],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_server"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_b",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server-stdio\n--module-id\nx07.mcp.cli.assets.mcp-server-stdio\n--out\ncli/src/x07/mcp/cli/assets/mcp-server-stdio.x07.json\n"]],["let","resp_b",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_b"]],["bytes.alloc",0]]],["let","resp_b_v",["bytes.view","resp_b"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_b_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-stdio)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_b_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-stdio)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_stdio"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_c",["bytes.lit","assets\nembed-dir\n--in\ntemplates/mcp-server-http\n--module-id\nx07.mcp.cli.assets.mcp-server-http\n--out\ncli/src/x07/mcp/cli/assets/mcp-server-http.x07.json\n"]],["let","resp_c",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_c"]],["bytes.alloc",0]]],["let","resp_c_v",["bytes.view","resp_c"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_c_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-http)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_c_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (mcp-server-http)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_http"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","args_d",["bytes.lit","assets\nembed-dir\n--in\ntemplates/shared\n--module-id\nx07.mcp.cli.assets.shared\n--out\ncli/src/x07/mcp/cli/assets/shared.x07.json\n"]],["let","resp_d",["if",["=","ok",1],["app._run_x07_capture_v1","repo_root_v",["bytes.view","args_d"]],["bytes.alloc",0]]],["let","resp_d_v",["bytes.view","resp_d"]],["if",["=","ok",1],["begin",["if",["=",["std.os.process.is_err","resp_d_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (shared)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_d_v"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","x07 assets embed-dir failed (shared)"]],0],0]],0],0],["if",["=","ok",1],["begin",["set","created_out",["std.vec.extend_bytes","created_out",["bytes.view","b_codegen_asset_shared"]]],["set","created_out",["std.vec.push","created_out",10]],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","steps_text",["std.vec.as_bytes","steps_out"]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["bytes.lit","ok\n"]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","conformance"]],["begin",["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","url",["app._opt_v1","docv",["bytes.view","k_url"]]],["if",["=",["bytes.len","url"],0],["set","url",["bytes.lit","http://127.0.0.1:8080/mcp"]],0],["let","baseline",["app._opt_v1","docv",["bytes.view","k_baseline"]]],["if",["=",["bytes.len","baseline"],0],["set","baseline",["bytes.lit","conformance/conformance-baseline.yml"]],0],["let","spawn",["app._opt_v1","docv",["bytes.view","k_spawn"]]],["let","mode",["app._opt_v1","docv",["bytes.view","k_mode"]]],["if",["=",["bytes.len","mode"],0],["set","mode",["bytes.lit","noauth"]],0],["let","args_v",["std.vec.with_capacity",256]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.lit","--url"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.view","url"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.lit","--baseline"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.view","baseline"]]],["set","args_v",["std.vec.push","args_v",10]],["if",[">",["bytes.len","spawn"],0],["begin",["set","args_v",["std.vec.extend_bytes","args_v",["bytes.lit","--spawn"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.view","spawn"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.lit","--mode"]]],["set","args_v",["std.vec.push","args_v",10]],["set","args_v",["std.vec.extend_bytes","args_v",["bytes.view","mode"]]],["set","args_v",["std.vec.push","args_v",10]],0],0],["let","args_text",["std.vec.as_bytes","args_v"]],["let","resp",["app._run_cmd_capture_v1",["bytes.lit","conformance/run_server_conformance.sh"],["bytes.lit","."],["bytes.view","args_text"]]],["let","resp_v",["bytes.view","resp"]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["if",["=",["std.os.process.is_err","resp_v"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","conformance failed (spawn)"]],0],["if",["!=",["std.os.process.resp_exit_code","resp_v"],0],["begin",["set","ok",0],["set","err_msg",["std.os.process.resp_stderr","resp_v"]],0],0]],["let","stdout_b",["if",["=","ok",1],["std.os.process.resp_stdout","resp_v"],["bytes.alloc",0]]],["if",["=","ok",1],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.alloc",0],["bytes.alloc",0],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["if",[">",["bytes.len","stdout_b"],0],"stdout_b",["bytes.lit","ok\\n"]]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.alloc",0],["bytes.alloc",0],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],0],["if",["bytes.eq","cmd",["bytes.lit","registry"]],["begin",["let","subcmd_registry",["app._arg_v1","docv",["bytes.view","k_subcmd"]]],["if",["=",["bytes.eq","subcmd_registry",["bytes.lit","gen"]],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: expected subcommand 'gen'\\n"]]],0],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","in_path",["app._opt_v1","docv",["bytes.view","k_in"]]],["let","out_path",["app._opt_v1","docv",["bytes.view","k_out"]]],["let","mcpb_path",["app._opt_v1","docv",["bytes.view","k_mcpb"]]],["let","schema_path",["app._opt_v1","docv",["bytes.view","k_schema"]]],["if",["=",["bytes.len","in_path"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: missing --in\\n"]]],0],["if",["=",["bytes.len","out_path"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: missing --out\\n"]]],0],["return",["app._registry_gen_native_v1",["bytes.view","in_path"],["bytes.view","out_path"],["bytes.view","mcpb_path"],["bytes.view","schema_path"],"machine_json"]]],0],["if",["bytes.eq","cmd",["bytes.lit","publish"]],["begin",["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["if",["=",["app._flag_present_v1","docv",["bytes.view","k_dry_run"]],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: publish requires --dry-run\\n"]]],0],["let","server_json",["app._opt_v1","docv",["bytes.view","k_server_json"]]],["let","mcpb_path",["app._opt_v1","docv",["bytes.view","k_mcpb"]]],["let","schema_path",["app._opt_v1","docv",["bytes.view","k_schema"]]],["if",["=",["bytes.len","server_json"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: missing --server-json\\n"]]],0],["if",["=",["bytes.len","mcpb_path"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: missing --mcpb\\n"]]],0],["return",["app._publish_dry_run_native_v1",["bytes.view","server_json"],["bytes.view","mcpb_path"],["bytes.view","schema_path"],"machine_json"]]],0],["if",["bytes.eq","cmd",["bytes.lit","dev"]],["begin",["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["if",["=",["bytes.len","dir"],0],["set","dir",["bytes.lit","."]],0],["let","cfg",["app._opt_v1","docv",["bytes.view","k_cfg"]]],["if",["=",["bytes.len","cfg"],0],["set","cfg",["bytes.lit","config/mcp.server.json"]],0],["let","cfg_path",["if",["=",["app._is_bad_rel_path_v1",["bytes.view","cfg"]],0],["std.path.join",["view.to_bytes",["bytes.view","dir"]],["view.to_bytes",["bytes.view","cfg"]]],["view.to_bytes",["bytes.view","cfg"]]]],["let","code",["begin",["let","cfg_json_dev",["std.fs.read",["bytes.view","cfg_path"]]],["let","cfg_doc_b_dev",["ext.json.data_model.parse",["bytes.view","cfg_json_dev"]]],["let","cfg_doc_dev",["bytes.view","cfg_doc_b_dev"]],["let","transport_kind_dev",["bytes.lit","stdio"]],["if",["if",["=",["ext.data_model.doc_is_err","cfg_doc_dev"],0],["=",["ext.data_model.root_kind","cfg_doc_dev"],5],0],["begin",["let","root_dev",["ext.data_model.root_offset","cfg_doc_dev"]],["let","transport_off_dev",["ext.data_model.map_find","cfg_doc_dev","root_dev",["bytes.lit","transport"]]],["if",[">=","transport_off_dev",0],["begin",["let","kind_off_dev",["ext.data_model.map_find","cfg_doc_dev","transport_off_dev",["bytes.lit","kind"]]],["if",["if",[">=","kind_off_dev",0],["=",["ext.data_model.kind_at","cfg_doc_dev","kind_off_dev"],3],0],["set","transport_kind_dev",["ext.data_model.string_get","cfg_doc_dev","kind_off_dev"]],0],0],0],0],0],["if",["=",["bytes.eq",["bytes.view","transport_kind_dev"],["bytes.lit","http"]],1],["std.mcp.transport.http.serve_from_fs_v1",["bytes.view","cfg_path"]],["std.mcp.transport.stdio.serve_from_fs_v1",["bytes.view","cfg_path"]]]]],["process.set_exit_code_v1",0],["return",["bytes.alloc",0]]],0],["if",["=",["bytes.eq","cmd",["bytes.lit","scaffold"]],0],["begin",["process.set_exit_code_v1",2],["return",["app._help_root_v1"]]],0],["let","subcmd",["app._arg_v1","docv",["bytes.view","k_subcmd"]]],["if",["=",["bytes.eq","subcmd",["bytes.lit","init"]],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: expected subcommand 'init'\n"]]],0],["let","template",["app._opt_v1","docv",["bytes.view","k_template"]]],["let","template_v",["bytes.view","template"]],["let","dir",["app._opt_v1","docv",["bytes.view","k_dir"]]],["let","dir_v",["bytes.view","dir"]],["let","machine",["app._opt_v1","docv",["bytes.view","k_machine"]]],["if",["=",["bytes.len","machine"],0],0,["if",["bytes.eq","machine",["bytes.lit","json"]],0,["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unsupported --machine value (expected 'json')\n"]]]]],["let","machine_json",["bytes.eq","machine",["bytes.lit","json"]]],["let","template_for_paths",["view.to_bytes","template_v"]],["let","template_paths_text",["app._template_paths_text_v1","template_for_paths"]],["if",["=",["bytes.len","template_paths_text"],0],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: unknown --template\n"]]],0],["if",["=",["app._is_bad_rel_path_v1",["bytes.view","dir"]],1],["begin",["process.set_exit_code_v1",2],["return",["bytes.lit","error: --dir must be a relative path\n"]]],0],["let","caps",["app._fs_caps_v1"]],["let","caps_v",["bytes.view","caps"]],["let","created_out",["std.vec.with_capacity",256]],["let","ok",1],["let","err_msg",["bytes.alloc",0]],["let","paths_x7sl",["std.text.ascii.split_lines_view",["bytes.view","template_paths_text"]]],["let","paths_x7sl_v",["bytes.view","paths_x7sl"]],["let","paths_n",["std.text.slices.count_v1","paths_x7sl_v"]],["let","i",0],["for","_",0,"paths_n",["begin",["if",["=","ok",1],["begin",["let","p",["std.text.slices.view_at_v1",["bytes.view","template_paths_text"],"paths_x7sl_v","i"]],["let","template_for_get",["view.to_bytes","template_v"]],["let","b64_opt",["app._template_get_b64_v1","template_for_get","p"]],["if",["=",["option_bytes.is_some","b64_opt"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","missing embedded file payload"]],0],["begin",["let","b64",["option_bytes.unwrap_or","b64_opt",["bytes.alloc",0]]],["let","dec_doc",["ext.base64.base64_decode",["bytes.view","b64"]]],["let","dec_docv",["bytes.view","dec_doc"]],["if",["=",["ext.base64.base64_is_err","dec_docv"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","base64 decode failed"]],0],["begin",["let","contents",["ext.base64.base64_get_bytes","dec_docv"]],["let","dir_copy",["view.to_bytes","dir_v"]],["let","dst",["std.path.join","dir_copy",["view.to_bytes","p"]]],["let","caps_copy",["view.to_bytes","caps_v"]],["let","w",["std.os.fs.write_all_v1","dst","contents","caps_copy"]],["if",["=",["result_i32.is_ok","w"],1],["begin",["set","created_out",["std.vec.extend_bytes","created_out","p"]],["set","created_out",["std.vec.push","created_out",10]],0],["begin",["set","ok",0],["let","code_dec",["std.fmt.u32_to_dec",["result_i32.err_code","w"]]],["let","msgv",["std.vec.with_capacity",128]],["let","b_write_failed_prefix",["bytes.lit","write failed (code="]],["let","b_write_failed_suffix",["bytes.lit",")"]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","b_write_failed_prefix"]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","code_dec"]]],["set","msgv",["std.vec.extend_bytes","msgv",["bytes.view","b_write_failed_suffix"]]],["set","err_msg",["std.vec.as_bytes","msgv"]],0]],0]],0]]],0],["set","i",["+","i",1]],0]],["if",["=","ok",1],["begin",["let","shared_paths_text",["x07.mcp.cli.assets.shared.paths_text_v1"]],["let","shared_x7sl",["std.text.ascii.split_lines_view",["bytes.view","shared_paths_text"]]],["let","shared_x7sl_v",["bytes.view","shared_x7sl"]],["let","shared_n",["std.text.slices.count_v1","shared_x7sl_v"]],["let","j",0],["for","_",0,"shared_n",["begin",["let","p",["std.text.slices.view_at_v1",["bytes.view","shared_paths_text"],"shared_x7sl_v","j"]],["let","b64_opt",["x07.mcp.cli.assets.shared.get_b64_v1","p"]],["if",["=",["option_bytes.is_some","b64_opt"],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","missing embedded shared file payload"]],0],["begin",["let","b64",["option_bytes.unwrap_or","b64_opt",["bytes.alloc",0]]],["let","dec_doc",["ext.base64.base64_decode",["bytes.view","b64"]]],["let","dec_docv",["bytes.view","dec_doc"]],["if",["=",["ext.base64.base64_is_err","dec_docv"],1],["begin",["set","ok",0],["set","err_msg",["bytes.lit","base64 decode failed"]],0],["begin",["let","contents",["ext.base64.base64_get_bytes","dec_docv"]],["let","dir_copy",["view.to_bytes","dir_v"]],["let","dst",["std.path.join","dir_copy",["view.to_bytes","p"]]],["let","caps_copy",["view.to_bytes","caps_v"]],["let","w",["std.os.fs.write_all_v1","dst","contents","caps_copy"]],["if",["=",["result_i32.is_ok","w"],1],["begin",["set","created_out",["std.vec.extend_bytes","created_out","p"]],["set","created_out",["std.vec.push","created_out",10]],0],["begin",["set","ok",0],["set","err_msg",["bytes.lit","write failed"]],0]],0]],0]],["set","j",["+","j",1]],0]],0],0],["let","created_text",["std.vec.as_bytes","created_out"]],["let","created_x7sl",["std.text.ascii.split_lines_view",["bytes.view","created_text"]]],["let","created_count",["std.text.slices.count_v1",["bytes.view","created_x7sl"]]],["if",["=","ok",1],["begin",["let","template_for_steps",["view.to_bytes","template_v"]],["let","steps_text",["app._next_steps_text_v1","template_for_steps","dir_v"]],["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",0],["return",["app._emit_report_json_v1",1,["bytes.view","created_text"],["bytes.view","steps_text"],["bytes.alloc",0]]]],["begin",["process.set_exit_code_v1",0],["return",["app._render_ok_human_v1",["bytes.view","dir"],"created_count",["bytes.view","steps_text"]]]]]],["begin",["if",["=","machine_json",1],["begin",["process.set_exit_code_v1",1],["return",["app._emit_report_json_v1",0,["bytes.view","created_text"],["bytes.alloc",0],["bytes.view","err_msg"]]]],["begin",["process.set_exit_code_v1",1],["return",["app._render_error_human_v1",["bytes.view","err_msg"]]]]]]]],"kind":"defn","name":"app.solve","params":[{"name":"argv_v1_in","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.base64","ext.cli","ext.data_model","ext.data_model.json","ext.json.data_model","ext.jsonschema","std.fmt","std.fs","std.mcp.transport.http","std.mcp.transport.stdio","std.os.env","std.os.fs","std.os.fs.spec","std.os.process","std.os.process.caps_v1","std.os.process.req_v1","std.path","std.text.ascii","std.text.slices","std.vec","x07.mcp.cli.assets.mcp-server","x07.mcp.cli.assets.mcp-server-http","x07.mcp.cli.assets.mcp-server-stdio","x07.mcp.cli.assets.shared"],"kind":"module","module_id":"app","schema_version":"x07.x07ast@0.5.0"}
