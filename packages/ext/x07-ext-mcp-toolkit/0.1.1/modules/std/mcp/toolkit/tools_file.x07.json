{"decls":[{"kind":"export","names":["std.mcp.toolkit.tools_file.load_tools_from_fs_v1","std.mcp.toolkit.tools_file.tool_input_schema_json_v1","std.mcp.toolkit.tools_file.tools_list_result_v1"]},{"body":7203,"kind":"defn","name":"std.mcp.toolkit.tools_file._err_duplicate_tool_name_v1","params":[],"result":"i32"},{"body":7202,"kind":"defn","name":"std.mcp.toolkit.tools_file._err_invalid_tool_name_v1","params":[],"result":"i32"},{"body":7201,"kind":"defn","name":"std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1","params":[],"result":"i32"},{"body":7204,"kind":"defn","name":"std.mcp.toolkit.tools_file._err_tool_not_found_v1","params":[],"result":"i32"},{"body":["if",["if",[">=u","c",48],["<u","c",58],0],1,["if",["if",[">=u","c",65],["<u","c",91],0],1,["if",["if",[">=u","c",97],["<u","c",123],0],1,["if",["if",["=","c",95],1,["=","c",45]],1,["=","c",46]]]]],"kind":"defn","name":"std.mcp.toolkit.tools_file._is_tool_name_char_v1","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","name"]],["if",["=","n",0],["return",0],0],["if",[">","n",128],["return",0],0],["for","i",0,"n",["if",["=",["std.mcp.toolkit.tools_file._is_tool_name_char_v1",["view.get_u8","name","i"]],1],0,["return",0]]],1],"kind":"defn","name":"std.mcp.toolkit.tools_file._is_valid_tool_name_v1","params":[{"name":"name","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","canon",["ext.json.canon.canonicalize","json"]],["if",["=",["std.bytes.len","canon"],0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","doc",["ext.json.data_model.parse",["bytes.view","canon"]]],["let","dv",["bytes.view","doc"]],["if",["=",["ext.data_model.doc_is_err","dv"],1],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["if",["!=",["ext.data_model.root_kind","dv"],5],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","dv"]],["let","k_schema",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","dv","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","schema_ver",["ext.data_model.string_get","dv","schema_off"]],["let","want",["bytes.lit","x07.mcp.tools_manifest@0.1.0"]],["if",["=",["bytes.eq",["bytes.view","schema_ver"],["bytes.view","want"]],0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","k_tools",["bytes.lit","tools"]],["let","tools_off",["ext.data_model.map_find","dv","root",["bytes.view","k_tools"]]],["if",["<","tools_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","tools_len",["ext.data_model.seq_len","dv","tools_off"]],["if",["<","tools_len",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["for","i",0,"tools_len",["begin",["let","tool_off",["ext.data_model.seq_get","dv","tools_off","i"]],["if",["<","tool_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","dv","tool_off"],5],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","k_name",["bytes.lit","name"]],["let","name_off",["ext.data_model.map_find","dv","tool_off",["bytes.view","k_name"]]],["if",["<","name_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","name",["ext.data_model.string_get","dv","name_off"]],["if",["=",["std.bytes.len","name"],0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tool_name_v1"]]],0],["if",["=",["std.mcp.toolkit.tools_file._is_valid_tool_name_v1",["bytes.view","name"]],0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tool_name_v1"]]],0],["for","j",0,"i",["begin",["let","prev_off",["ext.data_model.seq_get","dv","tools_off","j"]],["if",["<","prev_off",0],0,["begin",["let","prev_name_off",["ext.data_model.map_find","dv","prev_off",["bytes.view","k_name"]]],["if",["<","prev_name_off",0],0,["begin",["let","prev_name",["ext.data_model.string_get","dv","prev_name_off"]],["if",["=",["bytes.eq",["bytes.view","prev_name"],["bytes.view","name"]],1],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_duplicate_tool_name_v1"]]],0],0]],0]],0]],["let","k_schema_in",["bytes.lit","inputSchema"]],["let","schema_in_off",["ext.data_model.map_find","dv","tool_off",["bytes.view","k_schema_in"]]],["if",["<","schema_in_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","dv","schema_in_off"],5],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","k_x07",["bytes.lit","x07"]],["let","x07_off",["ext.data_model.map_find","dv","tool_off",["bytes.view","k_x07"]]],["if",["<","x07_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","dv","x07_off"],5],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","k_impl",["bytes.lit","impl"]],["let","impl_off",["ext.data_model.map_find","dv","x07_off",["bytes.view","k_impl"]]],["if",["<","impl_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","impl",["ext.data_model.string_get","dv","impl_off"]],["if",["=",["std.bytes.len","impl"],0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],0]],["result_bytes.ok","canon"]],"kind":"defn","name":"std.mcp.toolkit.tools_file._parse_tools_manifest_v1","params":[{"name":"json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","n",["ext.data_model.seq_len","doc","tools_off"]],["if",["<","n",0],["return",["-",0,1]],0],["let","k_name",["bytes.lit","name"]],["for","i",0,"n",["begin",["let","tool_off",["ext.data_model.seq_get","doc","tools_off","i"]],["if",["<","tool_off",0],0,["begin",["let","name_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_name"]]],["if",["<","name_off",0],0,["begin",["let","name",["ext.data_model.string_get","doc","name_off"]],["if",["=",["bytes.eq",["bytes.view","name"],"tool_name"],1],["return","tool_off"],0],0]],0]],0]],["-",0,1]],"kind":"defn","name":"std.mcp.toolkit.tools_file._tool_find_off_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"tools_off","ty":"i32"},{"name":"tool_name","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","k_annotations",["bytes.lit","annotations"]],["let","k_description",["bytes.lit","description"]],["let","k_input_schema",["bytes.lit","inputSchema"]],["let","k_name",["bytes.lit","name"]],["let","k_title",["bytes.lit","title"]],["let","name_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_name"]]],["if",["<","name_off",0],["return",["bytes.alloc",0]],0],["let","name",["ext.data_model.string_get","doc","name_off"]],["let","v_name",["ext.data_model.value_string",["bytes.view","name"]]],["let","schema_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_input_schema"]]],["if",["<","schema_off",0],["return",["bytes.alloc",0]],0],["let","schema_end",["ext.data_model.skip_value","doc","schema_off"]],["if",["<","schema_end",0],["return",["bytes.alloc",0]],0],["let","schema_val",["view.to_bytes",["view.slice","doc","schema_off",["-","schema_end","schema_off"]]]],["let","ann_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_annotations"]]],["let","has_ann",0],["let","ann_val",["bytes.alloc",0]],["if",["<","ann_off",0],0,["begin",["let","end",["ext.data_model.skip_value","doc","ann_off"]],["if",["<","end",0],0,["begin",["set","ann_val",["view.to_bytes",["view.slice","doc","ann_off",["-","end","ann_off"]]]],["set","has_ann",1]]]]],["let","title_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_title"]]],["let","title",["if",["<","title_off",0],["bytes.alloc",0],["ext.data_model.string_get","doc","title_off"]]],["let","desc_off",["ext.data_model.map_find","doc","tool_off",["bytes.view","k_description"]]],["let","desc",["if",["<","desc_off",0],["bytes.alloc",0],["ext.data_model.string_get","doc","desc_off"]]],["let","entries",["vec_u8.with_capacity",384]],["let","has_title",["if",["=",["std.bytes.len","title"],0],0,1]],["let","has_desc",["if",["=",["std.bytes.len","desc"],0],0,1]],["let","count0",["+",2,"has_ann"]],["let","count1",["+","count0","has_title"]],["let","count2",["+","count1","has_desc"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","count2"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_input_schema"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_input_schema"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","schema_val"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","schema_val"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_name"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_name"]]],["if",["=","has_ann",1],["begin",["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_annotations"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_annotations"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","ann_val"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","ann_val"]]],0],0],["if",["=","has_title",1],["begin",["let","v_title",["ext.data_model.value_string",["bytes.view","title"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_title"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_title"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_title"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_title"]]],0],0],["if",["=","has_desc",1],["begin",["let","v_desc",["ext.data_model.value_string",["bytes.view","desc"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_description"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_description"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_desc"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_desc"]]],0],0],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"std.mcp.toolkit.tools_file._tool_public_val_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"tool_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","b",["std.fs.read","path"]],["std.mcp.toolkit.tools_file._parse_tools_manifest_v1",["bytes.view","b"]]],"kind":"defn","name":"std.mcp.toolkit.tools_file.load_tools_from_fs_v1","params":[{"name":"path","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","doc",["ext.json.data_model.parse","tools_registry_json"]],["let","dv",["bytes.view","doc"]],["if",["=",["ext.data_model.doc_is_err","dv"],1],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","dv"]],["let","k_tools",["bytes.lit","tools"]],["let","tools_off",["ext.data_model.map_find","dv","root",["bytes.view","k_tools"]]],["if",["<","tools_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","tool_off",["std.mcp.toolkit.tools_file._tool_find_off_v1","dv","tools_off","tool_name"]],["if",["<","tool_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_tool_not_found_v1"]]],0],["let","k_schema_in",["bytes.lit","inputSchema"]],["let","schema_off",["ext.data_model.map_find","dv","tool_off",["bytes.view","k_schema_in"]]],["if",["<","schema_off",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","schema_end",["ext.data_model.skip_value","dv","schema_off"]],["if",["<","schema_end",0],["return",["result_bytes.err",["std.mcp.toolkit.tools_file._err_invalid_tools_manifest_v1"]]],0],["let","schema_val",["view.to_bytes",["view.slice","dv","schema_off",["-","schema_end","schema_off"]]]],["let","schema_json",["std.mcp.util.json.json_from_value_v1",["bytes.view","schema_val"]]],["result_bytes.ok","schema_json"]],"kind":"defn","name":"std.mcp.toolkit.tools_file.tool_input_schema_json_v1","params":[{"name":"tools_registry_json","ty":"bytes_view"},{"name":"tool_name","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","doc",["ext.json.data_model.parse","tools_registry_json"]],["let","dv",["bytes.view","doc"]],["if",["=",["ext.data_model.doc_is_err","dv"],1],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","dv"]],["let","k_tools",["bytes.lit","tools"]],["let","tools_off",["ext.data_model.map_find","dv","root",["bytes.view","k_tools"]]],["if",["<","tools_off",0],["return",["bytes.alloc",0]],0],["let","n",["ext.data_model.seq_len","dv","tools_off"]],["if",["<","n",0],["return",["bytes.alloc",0]],0],["let","used",["bytes.alloc","n"]],["let","tool_elems",["vec_u8.with_capacity",256]],["set","tool_elems",["vec_u8.extend_bytes","tool_elems",["codec.write_u32_le","n"]]],["let","k_name",["bytes.lit","name"]],["for","_",0,"n",["begin",["let","best_i",["-",0,1]],["let","best_name",["bytes.alloc",0]],["for","i",0,"n",["if",["=",["std.bytes.get_u8","used","i"],1],0,["begin",["let","tool_off",["ext.data_model.seq_get","dv","tools_off","i"]],["if",["<","tool_off",0],0,["begin",["let","name_off",["ext.data_model.map_find","dv","tool_off",["bytes.view","k_name"]]],["if",["<","name_off",0],0,["begin",["let","name",["ext.data_model.string_get","dv","name_off"]],["if",["<","best_i",0],["begin",["set","best_i","i"],["set","best_name","name"],0],["if",["<",["std.bytes.cmp_range",["bytes.view","name"],0,["std.bytes.len","name"],["bytes.view","best_name"],0,["std.bytes.len","best_name"]],0],["begin",["set","best_i","i"],["set","best_name","name"],0],0]],0]],0]],0]]],["if",["<","best_i",0],["return",["bytes.alloc",0]],0],["set","used",["bytes.set_u8","used","best_i",1]],["let","tool_off",["ext.data_model.seq_get","dv","tools_off","best_i"]],["if",["<","tool_off",0],["return",["bytes.alloc",0]],0],["let","tool_val",["std.mcp.toolkit.tools_file._tool_public_val_v1","dv","tool_off"]],["if",["=",["std.bytes.len","tool_val"],0],["return",["bytes.alloc",0]],0],["set","tool_elems",["vec_u8.extend_bytes","tool_elems",["codec.write_u32_le",["std.bytes.len","tool_val"]]]],["set","tool_elems",["vec_u8.extend_bytes","tool_elems",["bytes.view","tool_val"]]],0]],["let","tool_elems_b",["vec_u8.into_bytes","tool_elems"]],["let","tools_val",["ext.data_model.value_seq_from_elems",["bytes.view","tool_elems_b"]]],["if",["=",["std.bytes.len","tools_val"],0],["return",["bytes.alloc",0]],0],["let","k_tools_out",["bytes.lit","tools"]],["let","result_entries",["vec_u8.with_capacity",128]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",1]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["std.bytes.len","k_tools_out"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","k_tools_out"]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["std.bytes.len","tools_val"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","tools_val"]]],["let","result_entries_b",["vec_u8.into_bytes","result_entries"]],["let","result_val",["ext.data_model.value_map_from_entries",["bytes.view","result_entries_b"]]],["std.mcp.util.json.json_from_value_v1",["bytes.view","result_val"]]],"kind":"defn","name":"std.mcp.toolkit.tools_file.tools_list_result_v1","params":[{"name":"tools_registry_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.json.canon","ext.json.data_model","std.bytes","std.fs","std.mcp.util.json"],"kind":"module","module_id":"std.mcp.toolkit.tools_file","schema_version":"x07.x07ast@0.5.0"}
