{"decls":[{"kind":"export","names":["std.mcp.toolkit.resources_file.load_resources_from_fs_v1","std.mcp.toolkit.resources_file.load_resources_from_json_v1","std.mcp.toolkit.resources_file.resources_list_result_v1","std.mcp.toolkit.resources_file.resources_read_result_v1"]},{"body":7302,"kind":"defn","name":"std.mcp.toolkit.resources_file._err_duplicate_resource_uri_v1","params":[],"result":"i32"},{"body":7303,"kind":"defn","name":"std.mcp.toolkit.resources_file._err_invalid_resource_uri_v1","params":[],"result":"i32"},{"body":7301,"kind":"defn","name":"std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1","params":[],"result":"i32"},{"body":7304,"kind":"defn","name":"std.mcp.toolkit.resources_file._err_resource_not_found_v1","params":[],"result":"i32"},{"body":["begin",["let","k_uri",["bytes.lit","uri"]],["let","k_name",["bytes.lit","name"]],["let","k_description",["bytes.lit","description"]],["let","k_mime",["bytes.lit","mimeType"]],["let","uri_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_uri"]]],["if",["<","uri_off",0],["return",["bytes.alloc",0]],0],["let","uri",["ext.data_model.string_get","doc","uri_off"]],["let","v_uri",["ext.data_model.value_string",["bytes.view","uri"]]],["let","mime_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_mime"]]],["if",["<","mime_off",0],["return",["bytes.alloc",0]],0],["let","mime",["ext.data_model.string_get","doc","mime_off"]],["let","v_mime",["ext.data_model.value_string",["bytes.view","mime"]]],["let","name_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_name"]]],["let","name",["if",["<","name_off",0],["bytes.alloc",0],["ext.data_model.string_get","doc","name_off"]]],["let","desc_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_description"]]],["let","desc",["if",["<","desc_off",0],["bytes.alloc",0],["ext.data_model.string_get","doc","desc_off"]]],["let","has_name",["if",["=",["std.bytes.len","name"],0],0,1]],["let","has_desc",["if",["=",["std.bytes.len","desc"],0],0,1]],["let","entries",["vec_u8.with_capacity",256]],["let","count0",["+",2,"has_name"]],["let","count1",["+","count0","has_desc"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","count1"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_uri"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_uri"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_uri"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_uri"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_mime"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_mime"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_mime"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_mime"]]],["if",["=","has_name",1],["begin",["let","v_name",["ext.data_model.value_string",["bytes.view","name"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_name"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_name"]]],0],0],["if",["=","has_desc",1],["begin",["let","v_desc",["ext.data_model.value_string",["bytes.view","desc"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_description"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_description"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_desc"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_desc"]]],0],0],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"std.mcp.toolkit.resources_file._resource_public_val_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"item_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","b",["std.fs.read","path"]],["std.mcp.toolkit.resources_file.load_resources_from_json_v1",["bytes.view","b"]]],"kind":"defn","name":"std.mcp.toolkit.resources_file.load_resources_from_fs_v1","params":[{"name":"path","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","canon",["ext.json.canon.canonicalize","json"]],["if",["=",["std.bytes.len","canon"],0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","doc_b",["ext.json.data_model.parse",["bytes.view","canon"]]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_schema",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","doc","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","schema_ver",["ext.data_model.string_get","doc","schema_off"]],["let","want",["bytes.lit","x07.mcp.resources_manifest@0.1.0"]],["if",["=",["bytes.eq",["bytes.view","schema_ver"],["bytes.view","want"]],0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","k_resources",["bytes.lit","resources"]],["let","resources_off",["ext.data_model.map_find","doc","root",["bytes.view","k_resources"]]],["if",["<","resources_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","resources_off"],4],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","n",["ext.data_model.seq_len","doc","resources_off"]],["if",["<","n",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","k_uri",["bytes.lit","uri"]],["let","k_mime",["bytes.lit","mimeType"]],["let","k_text",["bytes.lit","text"]],["for","i",0,"n",["begin",["let","item_off",["ext.data_model.seq_get","doc","resources_off","i"]],["if",["<","item_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","item_off"],5],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","uri_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_uri"]]],["if",["<","uri_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","uri_off"],3],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","uri",["ext.data_model.string_get","doc","uri_off"]],["if",["=",["std.bytes.len","uri"],0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resource_uri_v1"]]],0],["for","j",0,"i",["begin",["let","prev_off",["ext.data_model.seq_get","doc","resources_off","j"]],["if",["<","prev_off",0],0,["begin",["let","prev_uri_off",["ext.data_model.map_find","doc","prev_off",["bytes.view","k_uri"]]],["if",["<","prev_uri_off",0],0,["begin",["let","prev_uri",["ext.data_model.string_get","doc","prev_uri_off"]],["if",["=",["bytes.eq",["bytes.view","prev_uri"],["bytes.view","uri"]],1],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_duplicate_resource_uri_v1"]]],0],0]],0]],0]],["let","mime_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_mime"]]],["if",["<","mime_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","mime_off"],3],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","text_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_text"]]],["if",["<","text_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","text_off"],3],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],0]],["result_bytes.ok","canon"]],"kind":"defn","name":"std.mcp.toolkit.resources_file.load_resources_from_json_v1","params":[{"name":"json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","resources_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_resources",["bytes.lit","resources"]],["let","resources_off",["ext.data_model.map_find","doc","root",["bytes.view","k_resources"]]],["if",["<","resources_off",0],["return",["bytes.alloc",0]],0],["let","n",["ext.data_model.seq_len","doc","resources_off"]],["if",["<","n",0],["return",["bytes.alloc",0]],0],["if",["=","n",0],["return",["bytes.lit","{\"resources\":[]}"]],0],["let","used",["bytes.alloc","n"]],["let","elems",["vec_u8.with_capacity",256]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","n"]]],["let","k_uri",["bytes.lit","uri"]],["for","_",0,"n",["begin",["let","best_i",["-",0,1]],["let","best_uri",["bytes.alloc",0]],["for","i",0,"n",["if",["=",["std.bytes.get_u8","used","i"],1],0,["begin",["let","item_off",["ext.data_model.seq_get","doc","resources_off","i"]],["if",["<","item_off",0],0,["begin",["let","uri_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_uri"]]],["if",["<","uri_off",0],0,["begin",["let","uri",["ext.data_model.string_get","doc","uri_off"]],["if",["<","best_i",0],["begin",["set","best_i","i"],["set","best_uri","uri"],0],["if",["<",["std.bytes.cmp_range",["bytes.view","uri"],0,["std.bytes.len","uri"],["bytes.view","best_uri"],0,["std.bytes.len","best_uri"]],0],["begin",["set","best_i","i"],["set","best_uri","uri"],0],0]],0]],0]],0]]],["if",["<","best_i",0],["return",["bytes.alloc",0]],0],["set","used",["bytes.set_u8","used","best_i",1]],["let","item_off",["ext.data_model.seq_get","doc","resources_off","best_i"]],["if",["<","item_off",0],["return",["bytes.alloc",0]],0],["let","item_val",["std.mcp.toolkit.resources_file._resource_public_val_v1","doc","item_off"]],["if",["=",["std.bytes.len","item_val"],0],["return",["bytes.alloc",0]],0],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le",["std.bytes.len","item_val"]]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","item_val"]]],0]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","resources_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["std.bytes.len","resources_val"],0],["return",["bytes.alloc",0]],0],["let","k_resources_out",["bytes.lit","resources"]],["let","entries",["vec_u8.with_capacity",96]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",1]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_resources_out"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_resources_out"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","resources_val"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","resources_val"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","result_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.util.json.json_from_value_v1",["bytes.view","result_val"]]],"kind":"defn","name":"std.mcp.toolkit.resources_file.resources_list_result_v1","params":[{"name":"resources_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","resources_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_resources",["bytes.lit","resources"]],["let","resources_off",["ext.data_model.map_find","doc","root",["bytes.view","k_resources"]]],["if",["<","resources_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","n",["ext.data_model.seq_len","doc","resources_off"]],["if",["<","n",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","k_uri",["bytes.lit","uri"]],["let","k_mime",["bytes.lit","mimeType"]],["let","k_text",["bytes.lit","text"]],["let","found_off",["-",0,1]],["for","i",0,"n",["if",["<","found_off",0],["begin",["let","item_off",["ext.data_model.seq_get","doc","resources_off","i"]],["if",["<","item_off",0],0,["begin",["let","uri_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_uri"]]],["if",["<","uri_off",0],0,["begin",["let","candidate",["ext.data_model.string_get","doc","uri_off"]],["if",["=",["bytes.eq",["bytes.view","candidate"],"uri"],1],["set","found_off","item_off"],0],0]],0]],0],0]],["if",["<","found_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_resource_not_found_v1"]]],0],["let","mime_off",["ext.data_model.map_find","doc","found_off",["bytes.view","k_mime"]]],["if",["<","mime_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","mime",["ext.data_model.string_get","doc","mime_off"]],["let","text_off",["ext.data_model.map_find","doc","found_off",["bytes.view","k_text"]]],["if",["<","text_off",0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","text",["ext.data_model.string_get","doc","text_off"]],["let","v_uri",["ext.data_model.value_string","uri"]],["let","v_mime",["ext.data_model.value_string",["bytes.view","mime"]]],["let","v_text",["ext.data_model.value_string",["bytes.view","text"]]],["let","k_contents",["bytes.lit","contents"]],["let","k_text_out",["bytes.lit","text"]],["let","k_mime_out",["bytes.lit","mimeType"]],["let","content_entries",["vec_u8.with_capacity",192]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",3]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","k_uri"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","k_uri"]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","v_uri"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","v_uri"]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","k_mime_out"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","k_mime_out"]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","v_mime"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","v_mime"]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","k_text_out"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","k_text_out"]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["codec.write_u32_le",["std.bytes.len","v_text"]]]],["set","content_entries",["vec_u8.extend_bytes","content_entries",["bytes.view","v_text"]]],["let","content_entries_b",["vec_u8.into_bytes","content_entries"]],["let","content_val",["ext.data_model.value_map_from_entries",["bytes.view","content_entries_b"]]],["if",["=",["std.bytes.len","content_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","contents_elems",["vec_u8.with_capacity",96]],["set","contents_elems",["vec_u8.extend_bytes","contents_elems",["codec.write_u32_le",1]]],["set","contents_elems",["vec_u8.extend_bytes","contents_elems",["codec.write_u32_le",["std.bytes.len","content_val"]]]],["set","contents_elems",["vec_u8.extend_bytes","contents_elems",["bytes.view","content_val"]]],["let","contents_elems_b",["vec_u8.into_bytes","contents_elems"]],["let","contents_val",["ext.data_model.value_seq_from_elems",["bytes.view","contents_elems_b"]]],["if",["=",["std.bytes.len","contents_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.resources_file._err_invalid_resources_manifest_v1"]]],0],["let","result_entries",["vec_u8.with_capacity",96]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",1]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["std.bytes.len","k_contents"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","k_contents"]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["std.bytes.len","contents_val"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","contents_val"]]],["let","result_entries_b",["vec_u8.into_bytes","result_entries"]],["let","result_val",["ext.data_model.value_map_from_entries",["bytes.view","result_entries_b"]]],["let","result_json",["std.mcp.util.json.json_from_value_v1",["bytes.view","result_val"]]],["result_bytes.ok","result_json"]],"kind":"defn","name":"std.mcp.toolkit.resources_file.resources_read_result_v1","params":[{"name":"resources_json","ty":"bytes_view"},{"name":"uri","ty":"bytes_view"}],"result":"result_bytes"}],"imports":["ext.data_model","ext.json.canon","ext.json.data_model","std.bytes","std.fs","std.mcp.util.json"],"kind":"module","module_id":"std.mcp.toolkit.resources_file","schema_version":"x07.x07ast@0.5.0"}
