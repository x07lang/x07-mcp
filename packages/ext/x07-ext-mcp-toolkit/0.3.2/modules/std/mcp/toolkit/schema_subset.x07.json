{"decls":[{"kind":"export","names":["std.mcp.toolkit.schema_subset.supports_v1","std.mcp.toolkit.schema_subset.validate_v1"]},{"body":["begin",["let","k_path",["bytes.lit","jsonPointer"]],["let","k_keyword",["bytes.lit","keyword"]],["let","k_message",["bytes.lit","message"]],["let","v_path",["ext.data_model.value_string","path"]],["let","v_keyword",["ext.data_model.value_string","keyword"]],["let","v_message",["ext.data_model.value_string","message"]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",3]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_keyword"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_keyword"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_keyword"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_keyword"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_message"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_message"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_message"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_message"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_path"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_path"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_path"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_path"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"std.mcp.toolkit.schema_subset._error_val_v1","params":[{"name":"path","ty":"bytes_view"},{"name":"keyword","ty":"bytes_view"},{"name":"message","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","suffix",["bytes.lit","2020-12/schema"]],["std.bytes.ends_with","dialect",["bytes.view","suffix"]]],"kind":"defn","name":"std.mcp.toolkit.schema_subset._is_supported_dialect_v1","params":[{"name":"dialect","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","slash",["bytes.lit","/"]],["std.bytes.concat",["bytes.view","slash"],"key"]],"kind":"defn","name":"std.mcp.toolkit.schema_subset._mk_path1_v1","params":[{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","st",["std.parse.i32_status_le","b"]],["if",["if",[">=u",["bytes.len","st"],5],["=",["std.bytes.get_u8","st",0],1],0],["codec.read_u32_le","st",1],-1]],"kind":"defn","name":"std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","err_val",["std.mcp.toolkit.schema_subset._error_val_v1",["bytes.view","path"],["bytes.view","keyword"],["bytes.view","message"]]],["let","p","payload"],["set","p",["vec_u8.extend_bytes","p",["codec.write_u32_le",["std.bytes.len","err_val"]]]],["set","p",["vec_u8.extend_bytes","p",["bytes.view","err_val"]]],"p"],"kind":"defn","name":"std.mcp.toolkit.schema_subset._push_error_payload_v1","params":[{"name":"payload","ty":"vec_u8"},{"name":"path","ty":"bytes"},{"name":"keyword","ty":"bytes"},{"name":"message","ty":"bytes"}],"result":"vec_u8"},{"body":["begin",["let","schema_doc_b",["ext.json.data_model.parse","schema_json"]],["let","sv",["bytes.view","schema_doc_b"]],["if",["=",["ext.data_model.doc_is_err","sv"],1],["return",0],0],["if",["!=",["ext.data_model.root_kind","sv"],5],["return",0],0],["let","root",["ext.data_model.root_offset","sv"]],["let","k_dialect",["bytes.lit","$schema"]],["let","dialect_off",["ext.data_model.map_find","sv","root",["bytes.view","k_dialect"]]],["if",[">=","dialect_off",0],["begin",["if",["!=",["ext.data_model.kind_at","sv","dialect_off"],3],["return",0],0],["let","dialect",["ext.data_model.string_get","sv","dialect_off"]],["if",["=",["std.mcp.toolkit.schema_subset._is_supported_dialect_v1",["bytes.view","dialect"]],1],0,["return",0]]],0],["let","k_type",["bytes.lit","type"]],["let","type_off",["ext.data_model.map_find","sv","root",["bytes.view","k_type"]]],["if",["<","type_off",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","sv","type_off"],3],["return",0],0],["let","ty",["ext.data_model.string_get","sv","type_off"]],["let","want_obj",["bytes.lit","object"]],["if",["=",["bytes.eq",["bytes.view","ty"],["bytes.view","want_obj"]],1],0,["return",0]],["let","k_required",["bytes.lit","required"]],["let","req_off",["ext.data_model.map_find","sv","root",["bytes.view","k_required"]]],["if",[">=","req_off",0],["begin",["if",["!=",["ext.data_model.kind_at","sv","req_off"],4],["return",0],0],["let","rn",["ext.data_model.seq_len","sv","req_off"]],["if",["<","rn",0],["return",0],0],["for","i",0,"rn",["begin",["let","it",["ext.data_model.seq_get","sv","req_off","i"]],["if",["<","it",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","sv","it"],3],["return",0],0],0]],0],0],["let","k_additional",["bytes.lit","additionalProperties"]],["let","add_off",["ext.data_model.map_find","sv","root",["bytes.view","k_additional"]]],["if",[">=","add_off",0],["if",["!=",["ext.data_model.kind_at","sv","add_off"],1],["return",0],0],0],["let","k_props",["bytes.lit","properties"]],["let","props_off",["ext.data_model.map_find","sv","root",["bytes.view","k_props"]]],["if",[">=","props_off",0],["begin",["if",["!=",["ext.data_model.kind_at","sv","props_off"],5],["return",0],0],["let","pn",["ext.data_model.map_len","sv","props_off"]],["if",["<","pn",0],["return",0],0],["for","pi",0,"pn",["begin",["let","pschema_off",["ext.data_model.map_value_at","sv","props_off","pi"]],["if",["<","pschema_off",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","sv","pschema_off"],5],["return",0],0],["let","k_ptype",["bytes.lit","type"]],["let","pty_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_ptype"]]],["if",["<","pty_off",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","sv","pty_off"],3],["return",0],0],["let","pty",["ext.data_model.string_get","sv","pty_off"]],["let","pty_v",["bytes.view","pty"]],["let","ty_str",["bytes.lit","string"]],["let","ty_bool",["bytes.lit","boolean"]],["let","ty_num",["bytes.lit","number"]],["let","ty_int",["bytes.lit","integer"]],["let","m",["ext.data_model.map_len","sv","pschema_off"]],["if",["<","m",0],["return",0],0],["for","ki",0,"m",["begin",["let","k",["ext.data_model.map_key_at","sv","pschema_off","ki"]],["let","kv",["bytes.view","k"]],["let","ok",0],["let","k_type",["bytes.lit","type"]],["let","k_title",["bytes.lit","title"]],["let","k_desc",["bytes.lit","description"]],["let","k_minl",["bytes.lit","minLength"]],["let","k_maxl",["bytes.lit","maxLength"]],["let","k_min",["bytes.lit","minimum"]],["let","k_max",["bytes.lit","maximum"]],["if",["=",["bytes.eq","kv",["bytes.view","k_type"]],1],["set","ok",1],0],["if",["=",["bytes.eq","kv",["bytes.view","k_title"]],1],["set","ok",1],0],["if",["=",["bytes.eq","kv",["bytes.view","k_desc"]],1],["set","ok",1],0],["if",["=","ok",1],0,["begin",["if",["=",["bytes.eq","pty_v",["bytes.view","ty_str"]],1],["begin",["if",["|",["=",["bytes.eq","kv",["bytes.view","k_minl"]],1],["=",["bytes.eq","kv",["bytes.view","k_maxl"]],1]],["begin",["let","v_off",["ext.data_model.map_value_at","sv","pschema_off","ki"]],["if",["!=",["ext.data_model.kind_at","sv","v_off"],2],["return",0],0],0],["return",0]],["set","ok",1]],["if",["=",["bytes.eq","pty_v",["bytes.view","ty_int"]],1],["begin",["if",["|",["=",["bytes.eq","kv",["bytes.view","k_min"]],1],["=",["bytes.eq","kv",["bytes.view","k_max"]],1]],["begin",["let","v_off",["ext.data_model.map_value_at","sv","pschema_off","ki"]],["if",["!=",["ext.data_model.kind_at","sv","v_off"],2],["return",0],0],0],["return",0]],["set","ok",1]],["if",["|",["=",["bytes.eq","pty_v",["bytes.view","ty_bool"]],1],["=",["bytes.eq","pty_v",["bytes.view","ty_num"]],1]],["return",0],["return",0]]]]]],["if",["=","ok",1],0,["return",0]],0]],["if",["|",["=",["bytes.eq","pty_v",["bytes.view","ty_str"]],1],["|",["=",["bytes.eq","pty_v",["bytes.view","ty_bool"]],1],["|",["=",["bytes.eq","pty_v",["bytes.view","ty_num"]],1],["=",["bytes.eq","pty_v",["bytes.view","ty_int"]],1]]]],0,["return",0]],0]],0],0],1],"kind":"defn","name":"std.mcp.toolkit.schema_subset.supports_v1","params":[{"name":"schema_json","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","payload",["vec_u8.with_capacity",256]],["let","count",0],["let","empty_path",["bytes.alloc",0]],["let","schema_root",0],["let","schema_doc",["ext.json.data_model.parse","schema_json"]],["let","sv",["bytes.view","schema_doc"]],["if",["=",["ext.data_model.doc_is_err","sv"],1],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],["bytes.lit","schema"],["bytes.lit","invalid schema JSON"]]],["set","count",["+","count",1]]],0],["if",["=","count",0],["begin",["if",["!=",["ext.data_model.root_kind","sv"],5],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],["bytes.lit","schema"],["bytes.lit","schema must be an object"]]],["set","count",["+","count",1]]],["set","schema_root",["ext.data_model.root_offset","sv"]]]],0],["if",["=","count",0],["begin",["let","k_dialect",["bytes.lit","$schema"]],["let","dialect_off",["ext.data_model.map_find","sv","schema_root",["bytes.view","k_dialect"]]],["if",["<","dialect_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","sv","dialect_off"],3],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/$schema"],"k_dialect",["bytes.lit","$schema must be a string"]]],["set","count",["+","count",1]]],["begin",["let","dialect",["ext.data_model.string_get","sv","dialect_off"]],["if",["=",["std.mcp.toolkit.schema_subset._is_supported_dialect_v1",["bytes.view","dialect"]],1],0,["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/$schema"],"k_dialect",["bytes.lit","unsupported JSON Schema dialect"]]],["set","count",["+","count",1]]]]]]]]],0],["if",["=","count",0],["begin",["let","k_type",["bytes.lit","type"]],["let","type_off",["ext.data_model.map_find","sv","schema_root",["bytes.view","k_type"]]],["if",["<","type_off",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/type"],"k_type",["bytes.lit","missing schema type"]]],["set","count",["+","count",1]]],["begin",["if",["!=",["ext.data_model.kind_at","sv","type_off"],3],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/type"],"k_type",["bytes.lit","type must be a string"]]],["set","count",["+","count",1]]],["begin",["let","ty",["ext.data_model.string_get","sv","type_off"]],["let","want_obj",["bytes.lit","object"]],["if",["=",["bytes.eq",["bytes.view","ty"],["bytes.view","want_obj"]],1],0,["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/type"],"k_type",["bytes.lit","only object schemas are supported"]]],["set","count",["+","count",1]]]]]]]]],0],["if",["=","count",0],["begin",["let","inst_doc",["ext.json.data_model.parse","instance_json"]],["let","iv",["bytes.view","inst_doc"]],["if",["=",["ext.data_model.doc_is_err","iv"],1],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],["bytes.lit","instance"],["bytes.lit","invalid JSON"]]],["set","count",["+","count",1]]],0],["if",["=","count",0],["begin",["let","inst_root",0],["if",["!=",["ext.data_model.root_kind","iv"],5],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],["bytes.lit","type"],["bytes.lit","expected object"]]],["set","count",["+","count",1]]],["set","inst_root",["ext.data_model.root_offset","iv"]]],["if",["=","count",0],["begin",["let","k_required",["bytes.lit","required"]],["let","req_off",["ext.data_model.map_find","sv","schema_root",["bytes.view","k_required"]]],["if",["<","req_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","sv","req_off"],4],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/required"],"k_required",["bytes.lit","required must be an array of strings"]]],["set","count",["+","count",1]]],["begin",["let","rn",["ext.data_model.seq_len","sv","req_off"]],["if",["<","rn",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/required"],"k_required",["bytes.lit","required must be an array of strings"]]],["set","count",["+","count",1]]],["begin",["let","used",["bytes.alloc","rn"]],["for","_",0,"rn",["begin",["let","best_i",["-",0,1]],["let","best_name",["bytes.alloc",0]],["for","i",0,"rn",["if",["=",["std.bytes.get_u8","used","i"],1],0,["begin",["let","item_off",["ext.data_model.seq_get","sv","req_off","i"]],["if",["<","item_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","sv","item_off"],3],0,["begin",["let","nm",["ext.data_model.string_get","sv","item_off"]],["if",["<","best_i",0],["begin",["set","best_i","i"],["set","best_name","nm"],0],["if",["<",["std.bytes.cmp_range",["bytes.view","nm"],0,["std.bytes.len","nm"],["bytes.view","best_name"],0,["std.bytes.len","best_name"]],0],["begin",["set","best_i","i"],["set","best_name","nm"],0],0]]]]]],0]]],["if",["<","best_i",0],0,["begin",["set","used",["bytes.set_u8","used","best_i",1]],0]],["if",["<","best_i",0],0,["begin",["let","found",["ext.data_model.map_find","iv","inst_root",["bytes.view","best_name"]]],["if",["<","found",0],["begin",["let","pfx",["bytes.lit","missing required property '"]],["let","sfx",["bytes.lit","'"]],["let","m1",["std.bytes.concat",["bytes.view","pfx"],["bytes.view","best_name"]]],["let","m2",["std.bytes.concat",["bytes.view","m1"],["bytes.view","sfx"]]],["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],"k_required","m2"]],["set","count",["+","count",1]]],0]]],0]]]]]]]],["let","k_properties",["bytes.lit","properties"]],["let","props_off",["ext.data_model.map_find","sv","schema_root",["bytes.view","k_properties"]]],["let","props_ok",0],["if",["<","props_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","sv","props_off"],5],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.lit","/properties"],"k_properties",["bytes.lit","properties must be an object"]]],["set","count",["+","count",1]]],["set","props_ok",1]]]],["if",["=","props_ok",1],["begin",["let","pn",["ext.data_model.map_len","sv","props_off"]],["for","pi",0,"pn",["begin",["let","pkey",["ext.data_model.map_key_at","sv","props_off","pi"]],["let","pschema_off",["ext.data_model.map_value_at","sv","props_off","pi"]],["let","inst_val_off",["ext.data_model.map_find","iv","inst_root",["bytes.view","pkey"]]],["if",["<","inst_val_off",0],0,["begin",["let","path1",["std.mcp.toolkit.schema_subset._mk_path1_v1",["bytes.view","pkey"]]],["if",["!=",["ext.data_model.kind_at","sv","pschema_off"],5],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],["bytes.lit","schema"],["bytes.lit","property schema must be an object"]]],["set","count",["+","count",1]]],["begin",["let","k_type2",["bytes.lit","type"]],["let","pty_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_type2"]]],["if",["<","pty_off",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","missing property schema type"]]],["set","count",["+","count",1]]],["begin",["let","pty",["ext.data_model.string_get","sv","pty_off"]],["let","ty_str",["bytes.lit","string"]],["let","ty_bool",["bytes.lit","boolean"]],["let","ty_num",["bytes.lit","number"]],["let","ty_int",["bytes.lit","integer"]],["begin",["let","pty_v",["bytes.view","pty"]],["if",["=",["bytes.eq","pty_v",["bytes.view","ty_str"]],1],["begin",["if",["!=",["ext.data_model.kind_at","iv","inst_val_off"],3],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","expected string"]]],["set","count",["+","count",1]],0],["begin",["let","s",["ext.data_model.string_get","iv","inst_val_off"]],["let","slen",["bytes.len","s"]],["let","k_min",["bytes.lit","minLength"]],["let","min_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_min"]]],["if",["<","min_off",0],0,["begin",["let","min_raw",["ext.data_model.number_get","sv","min_off"]],["let","min_v",["std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1",["bytes.view","min_raw"]]],["if",["<","min_v",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_min",["bytes.lit","minLength must be an integer"]]],["set","count",["+","count",1]],0],["if",["<","slen","min_v"],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_min",["bytes.lit","string shorter than minLength"]]],["set","count",["+","count",1]],0],0]]]],["let","k_max",["bytes.lit","maxLength"]],["let","max_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_max"]]],["if",["<","max_off",0],0,["begin",["let","max_raw",["ext.data_model.number_get","sv","max_off"]],["let","max_v",["std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1",["bytes.view","max_raw"]]],["if",["<","max_v",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_max",["bytes.lit","maxLength must be an integer"]]],["set","count",["+","count",1]],0],["if",[">","slen","max_v"],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_max",["bytes.lit","string longer than maxLength"]]],["set","count",["+","count",1]],0],0]]]],0]],0],["if",["=",["bytes.eq","pty_v",["bytes.view","ty_bool"]],1],["begin",["if",["!=",["ext.data_model.kind_at","iv","inst_val_off"],1],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","expected boolean"]]],["set","count",["+","count",1]],0],0],0],["if",["=",["bytes.eq","pty_v",["bytes.view","ty_num"]],1],["begin",["if",["!=",["ext.data_model.kind_at","iv","inst_val_off"],2],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","expected number"]]],["set","count",["+","count",1]],0],0],0],["if",["=",["bytes.eq","pty_v",["bytes.view","ty_int"]],1],["begin",["if",["!=",["ext.data_model.kind_at","iv","inst_val_off"],2],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","expected integer"]]],["set","count",["+","count",1]],0],["begin",["let","inst_raw",["ext.data_model.number_get","iv","inst_val_off"]],["let","inst_i",["std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1",["bytes.view","inst_raw"]]],["if",["<","inst_i",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","expected integer"]]],["set","count",["+","count",1]],0],["begin",["let","k_min",["bytes.lit","minimum"]],["let","min_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_min"]]],["if",["<","min_off",0],0,["begin",["let","min_raw",["ext.data_model.number_get","sv","min_off"]],["let","min_v",["std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1",["bytes.view","min_raw"]]],["if",["<","min_v",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_min",["bytes.lit","minimum must be an integer"]]],["set","count",["+","count",1]],0],["if",["<","inst_i","min_v"],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_min",["bytes.lit","number less than minimum"]]],["set","count",["+","count",1]],0],0]],0]],["let","k_max",["bytes.lit","maximum"]],["let","max_off",["ext.data_model.map_find","sv","pschema_off",["bytes.view","k_max"]]],["if",["<","max_off",0],0,["begin",["let","max_raw",["ext.data_model.number_get","sv","max_off"]],["let","max_v",["std.mcp.toolkit.schema_subset._parse_i32_or_neg1_v1",["bytes.view","max_raw"]]],["if",["<","max_v",0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_max",["bytes.lit","maximum must be an integer"]]],["set","count",["+","count",1]],0],["if",[">","inst_i","max_v"],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_max",["bytes.lit","number greater than maximum"]]],["set","count",["+","count",1]],0],0]],0]],0]],0]],0],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_type2",["bytes.lit","unsupported property schema type"]]],["set","count",["+","count",1]],0]]]]]]]],0]],0]],0]]],0],["let","k_additional",["bytes.lit","additionalProperties"]],["let","add_off",["ext.data_model.map_find","sv","schema_root",["bytes.view","k_additional"]]],["if",["<","add_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","sv","add_off"],1],["begin",["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["bytes.alloc",0],"k_additional",["bytes.lit","additionalProperties must be a boolean"]]],["set","count",["+","count",1]]],["begin",["let","allow",["ext.data_model.bool_get","sv","add_off"]],["if",["=","allow",0],["begin",["let","instc",["ext.data_model.map_len","iv","inst_root"]],["for","i",0,"instc",["begin",["let","k",["ext.data_model.map_key_at","iv","inst_root","i"]],["if",["=","props_ok",1],["begin",["let","found",["ext.data_model.map_find","sv","props_off",["bytes.view","k"]]],["if",["<","found",0],["begin",["let","path1",["std.mcp.toolkit.schema_subset._mk_path1_v1",["bytes.view","k"]]],["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_additional",["bytes.lit","additionalProperties is false"]]],["set","count",["+","count",1]]],0]],["begin",["let","path1",["std.mcp.toolkit.schema_subset._mk_path1_v1",["bytes.view","k"]]],["set","payload",["std.mcp.toolkit.schema_subset._push_error_payload_v1","payload",["std.bytes.copy",["bytes.view","path1"]],"k_additional",["bytes.lit","additionalProperties is false"]]],["set","count",["+","count",1]]]],0]]],0]]]]]],0],0],0]],0],["if",["=","count",0],["bytes.alloc",0],["begin",["let","payload_b",["vec_u8.into_bytes","payload"]],["let","elems",["vec_u8.with_capacity",["+",4,["std.bytes.len","payload_b"]]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","count"]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","payload_b"]]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","errs_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["std.mcp.util.json.json_from_value_v1",["bytes.view","errs_val"]]]]],"kind":"defn","name":"std.mcp.toolkit.schema_subset.validate_v1","params":[{"name":"schema_json","ty":"bytes_view"},{"name":"instance_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.json.data_model","std.bytes","std.mcp.util.json","std.parse"],"kind":"module","module_id":"std.mcp.toolkit.schema_subset","schema_version":"x07.x07ast@0.5.0"}
