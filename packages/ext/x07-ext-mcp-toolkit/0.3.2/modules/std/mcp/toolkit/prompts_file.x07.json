{"decls":[{"kind":"export","names":["std.mcp.toolkit.prompts_file.load_prompts_from_fs_v1","std.mcp.toolkit.prompts_file.load_prompts_from_json_v1","std.mcp.toolkit.prompts_file.prompts_get_result_v1","std.mcp.toolkit.prompts_file.prompts_list_result_v1"]},{"body":7402,"kind":"defn","name":"std.mcp.toolkit.prompts_file._err_duplicate_prompt_name_v1","params":[],"result":"i32"},{"body":7403,"kind":"defn","name":"std.mcp.toolkit.prompts_file._err_invalid_prompt_name_v1","params":[],"result":"i32"},{"body":7401,"kind":"defn","name":"std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1","params":[],"result":"i32"},{"body":7404,"kind":"defn","name":"std.mcp.toolkit.prompts_file._err_prompt_not_found_v1","params":[],"result":"i32"},{"body":["if",["if",[">=u","c",48],["<u","c",58],0],1,["if",["if",[">=u","c",65],["<u","c",91],0],1,["if",["if",[">=u","c",97],["<u","c",123],0],1,["if",["if",["=","c",95],1,["=","c",45]],1,["=","c",46]]]]],"kind":"defn","name":"std.mcp.toolkit.prompts_file._is_prompt_name_char_v1","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","name"]],["if",["=","n",0],["return",0],0],["if",[">","n",128],["return",0],0],["for","i",0,"n",["if",["=",["std.mcp.toolkit.prompts_file._is_prompt_name_char_v1",["view.get_u8","name","i"]],1],0,["return",0]]],1],"kind":"defn","name":"std.mcp.toolkit.prompts_file._is_valid_prompt_name_v1","params":[{"name":"name","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","k_name",["bytes.lit","name"]],["let","k_description",["bytes.lit","description"]],["let","name_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_name"]]],["if",["<","name_off",0],["return",["bytes.alloc",0]],0],["let","name",["ext.data_model.string_get","doc","name_off"]],["let","v_name",["ext.data_model.value_string",["bytes.view","name"]]],["let","desc_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_description"]]],["let","desc",["if",["<","desc_off",0],["bytes.alloc",0],["ext.data_model.string_get","doc","desc_off"]]],["let","has_desc",["if",["=",["std.bytes.len","desc"],0],0,1]],["let","entries",["vec_u8.with_capacity",128]],["let","count",["+",1,"has_desc"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","count"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_name"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_name"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_name"]]],["if",["=","has_desc",1],["begin",["let","v_desc",["ext.data_model.value_string",["bytes.view","desc"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_description"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_description"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","v_desc"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_desc"]]],0],0],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"std.mcp.toolkit.prompts_file._prompt_public_val_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"item_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","_args_len",["view.len","args_json"]],["let","_tpl_len",["view.len","template_utf8"]],["view.to_bytes","template_utf8"]],"kind":"defn","name":"std.mcp.toolkit.prompts_file._render_template_v1","params":[{"name":"template_utf8","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","b",["std.fs.read","path"]],["std.mcp.toolkit.prompts_file.load_prompts_from_json_v1",["bytes.view","b"]]],"kind":"defn","name":"std.mcp.toolkit.prompts_file.load_prompts_from_fs_v1","params":[{"name":"path","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","canon",["ext.json.canon.canonicalize","json"]],["if",["=",["std.bytes.len","canon"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","doc_b",["ext.json.data_model.parse",["bytes.view","canon"]]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_schema",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","doc","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","schema_ver",["ext.data_model.string_get","doc","schema_off"]],["let","want",["bytes.lit","x07.mcp.prompts_manifest@0.1.0"]],["if",["=",["bytes.eq",["bytes.view","schema_ver"],["bytes.view","want"]],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","k_prompts",["bytes.lit","prompts"]],["let","prompts_off",["ext.data_model.map_find","doc","root",["bytes.view","k_prompts"]]],["if",["<","prompts_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","prompts_off"],4],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","n",["ext.data_model.seq_len","doc","prompts_off"]],["if",["<","n",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","k_name",["bytes.lit","name"]],["let","k_text",["bytes.lit","text"]],["for","i",0,"n",["begin",["let","item_off",["ext.data_model.seq_get","doc","prompts_off","i"]],["if",["<","item_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","item_off"],5],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","name_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_name"]]],["if",["<","name_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","name_off"],3],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","name",["ext.data_model.string_get","doc","name_off"]],["if",["=",["std.bytes.len","name"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompt_name_v1"]]],0],["if",["=",["std.mcp.toolkit.prompts_file._is_valid_prompt_name_v1",["bytes.view","name"]],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompt_name_v1"]]],0],["for","j",0,"i",["begin",["let","prev_off",["ext.data_model.seq_get","doc","prompts_off","j"]],["if",["<","prev_off",0],0,["begin",["let","prev_name_off",["ext.data_model.map_find","doc","prev_off",["bytes.view","k_name"]]],["if",["<","prev_name_off",0],0,["begin",["let","prev_name",["ext.data_model.string_get","doc","prev_name_off"]],["if",["=",["bytes.eq",["bytes.view","prev_name"],["bytes.view","name"]],1],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_duplicate_prompt_name_v1"]]],0],0]],0]],0]],["let","text_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_text"]]],["if",["<","text_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["if",["!=",["ext.data_model.kind_at","doc","text_off"],3],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],0]],["result_bytes.ok","canon"]],"kind":"defn","name":"std.mcp.toolkit.prompts_file.load_prompts_from_json_v1","params":[{"name":"json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","prompts_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_prompts",["bytes.lit","prompts"]],["let","prompts_off",["ext.data_model.map_find","doc","root",["bytes.view","k_prompts"]]],["if",["<","prompts_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","n",["ext.data_model.seq_len","doc","prompts_off"]],["if",["<","n",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","k_name",["bytes.lit","name"]],["let","k_text",["bytes.lit","text"]],["let","k_description",["bytes.lit","description"]],["let","found_off",["-",0,1]],["for","i",0,"n",["if",["<","found_off",0],["begin",["let","item_off",["ext.data_model.seq_get","doc","prompts_off","i"]],["if",["<","item_off",0],0,["begin",["let","name_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_name"]]],["if",["<","name_off",0],0,["begin",["let","candidate",["ext.data_model.string_get","doc","name_off"]],["if",["=",["bytes.eq",["bytes.view","candidate"],"name"],1],["set","found_off","item_off"],0],0]],0]],0],0]],["if",["<","found_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_prompt_not_found_v1"]]],0],["let","text_off",["ext.data_model.map_find","doc","found_off",["bytes.view","k_text"]]],["if",["<","text_off",0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","template_text",["ext.data_model.string_get","doc","text_off"]],["let","rendered",["std.mcp.toolkit.prompts_file._render_template_v1",["bytes.view","template_text"],"args_json"]],["let","desc_off",["ext.data_model.map_find","doc","found_off",["bytes.view","k_description"]]],["let","desc",["bytes.alloc",0]],["if",[">=","desc_off",0],["begin",["set","desc",["ext.data_model.string_get","doc","desc_off"]],0],0],["let","has_desc",["if",["=",["bytes.len",["bytes.view","desc"]],0],0,1]],["let","k_messages",["bytes.lit","messages"]],["let","k_role",["bytes.lit","role"]],["let","k_content",["bytes.lit","content"]],["let","k_type",["bytes.lit","type"]],["let","k_text_out",["bytes.lit","text"]],["let","role_user",["bytes.lit","user"]],["let","type_text",["bytes.lit","text"]],["let","v_role",["ext.data_model.value_string",["bytes.view","role_user"]]],["let","v_type",["ext.data_model.value_string",["bytes.view","type_text"]]],["let","v_text",["ext.data_model.value_string",["bytes.view","rendered"]]],["let","content_entry_payload",["vec_u8.with_capacity",128]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["codec.write_u32_le",2]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["codec.write_u32_le",["std.bytes.len","k_type"]]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["bytes.view","k_type"]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["codec.write_u32_le",["std.bytes.len","v_type"]]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["bytes.view","v_type"]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["codec.write_u32_le",["std.bytes.len","k_text_out"]]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["bytes.view","k_text_out"]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["codec.write_u32_le",["std.bytes.len","v_text"]]]],["set","content_entry_payload",["vec_u8.extend_bytes","content_entry_payload",["bytes.view","v_text"]]],["let","content_entry_payload_b",["vec_u8.into_bytes","content_entry_payload"]],["let","content_entry_val",["ext.data_model.value_map_from_entries",["bytes.view","content_entry_payload_b"]]],["if",["=",["bytes.len","content_entry_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","content_elems",["vec_u8.with_capacity",96]],["set","content_elems",["vec_u8.extend_bytes","content_elems",["codec.write_u32_le",1]]],["set","content_elems",["vec_u8.extend_bytes","content_elems",["codec.write_u32_le",["std.bytes.len","content_entry_val"]]]],["set","content_elems",["vec_u8.extend_bytes","content_elems","content_entry_val"]],["let","content_elems_b",["vec_u8.into_bytes","content_elems"]],["let","content_val",["ext.data_model.value_seq_from_elems",["bytes.view","content_elems_b"]]],["if",["=",["bytes.len","content_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","msg_entries",["vec_u8.with_capacity",160]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["codec.write_u32_le",2]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["codec.write_u32_le",["std.bytes.len","k_role"]]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["bytes.view","k_role"]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["codec.write_u32_le",["std.bytes.len","v_role"]]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["bytes.view","v_role"]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["codec.write_u32_le",["std.bytes.len","k_content"]]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["bytes.view","k_content"]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries",["codec.write_u32_le",["std.bytes.len","content_val"]]]],["set","msg_entries",["vec_u8.extend_bytes","msg_entries","content_val"]],["let","msg_entries_b",["vec_u8.into_bytes","msg_entries"]],["let","msg_val",["ext.data_model.value_map_from_entries",["bytes.view","msg_entries_b"]]],["if",["=",["bytes.len","msg_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","messages_elems",["vec_u8.with_capacity",96]],["set","messages_elems",["vec_u8.extend_bytes","messages_elems",["codec.write_u32_le",1]]],["set","messages_elems",["vec_u8.extend_bytes","messages_elems",["codec.write_u32_le",["std.bytes.len","msg_val"]]]],["set","messages_elems",["vec_u8.extend_bytes","messages_elems","msg_val"]],["let","messages_elems_b",["vec_u8.into_bytes","messages_elems"]],["let","messages_val",["ext.data_model.value_seq_from_elems",["bytes.view","messages_elems_b"]]],["if",["=",["bytes.len","messages_val"],0],["return",["result_bytes.err",["std.mcp.toolkit.prompts_file._err_invalid_prompts_manifest_v1"]]],0],["let","result_entries",["vec_u8.with_capacity",160]],["let","count0",["+",1,"has_desc"]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le","count0"]]],["if",["=","has_desc",1],["begin",["let","v_desc",["ext.data_model.value_string",["bytes.view","desc"]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["std.bytes.len","k_description"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","k_description"]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["bytes.len","v_desc"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries","v_desc"]],0],0],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_messages"]]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["bytes.view","k_messages"]]],["set","result_entries",["vec_u8.extend_bytes","result_entries",["codec.write_u32_le",["bytes.len","messages_val"]]]],["set","result_entries",["vec_u8.extend_bytes","result_entries","messages_val"]],["let","result_entries_b",["vec_u8.into_bytes","result_entries"]],["let","result_val",["ext.data_model.value_map_from_entries",["bytes.view","result_entries_b"]]],["let","result_json",["std.mcp.util.json.json_from_value_v1",["bytes.view","result_val"]]],["result_bytes.ok","result_json"]],"kind":"defn","name":"std.mcp.toolkit.prompts_file.prompts_get_result_v1","params":[{"name":"prompts_json","ty":"bytes_view"},{"name":"name","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","prompts_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_prompts",["bytes.lit","prompts"]],["let","prompts_off",["ext.data_model.map_find","doc","root",["bytes.view","k_prompts"]]],["if",["<","prompts_off",0],["return",["bytes.alloc",0]],0],["let","n",["ext.data_model.seq_len","doc","prompts_off"]],["if",["<","n",0],["return",["bytes.alloc",0]],0],["if",["=","n",0],["return",["bytes.lit","{\"prompts\":[]}"]],0],["let","used",["bytes.alloc","n"]],["let","elems",["vec_u8.with_capacity",256]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","n"]]],["let","k_name",["bytes.lit","name"]],["for","_",0,"n",["begin",["let","best_i",["-",0,1]],["let","best_name",["bytes.alloc",0]],["for","i",0,"n",["if",["=",["std.bytes.get_u8","used","i"],1],0,["begin",["let","item_off",["ext.data_model.seq_get","doc","prompts_off","i"]],["if",["<","item_off",0],0,["begin",["let","name_off",["ext.data_model.map_find","doc","item_off",["bytes.view","k_name"]]],["if",["<","name_off",0],0,["begin",["let","name",["ext.data_model.string_get","doc","name_off"]],["if",["<","best_i",0],["begin",["set","best_i","i"],["set","best_name","name"],0],["if",["<",["std.bytes.cmp_range",["bytes.view","name"],0,["std.bytes.len","name"],["bytes.view","best_name"],0,["std.bytes.len","best_name"]],0],["begin",["set","best_i","i"],["set","best_name","name"],0],0]],0]],0]],0]]],["if",["<","best_i",0],["return",["bytes.alloc",0]],0],["set","used",["bytes.set_u8","used","best_i",1]],["let","item_off",["ext.data_model.seq_get","doc","prompts_off","best_i"]],["if",["<","item_off",0],["return",["bytes.alloc",0]],0],["let","item_val",["std.mcp.toolkit.prompts_file._prompt_public_val_v1","doc","item_off"]],["if",["=",["std.bytes.len","item_val"],0],["return",["bytes.alloc",0]],0],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le",["std.bytes.len","item_val"]]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","item_val"]]],0]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","prompts_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["std.bytes.len","prompts_val"],0],["return",["bytes.alloc",0]],0],["let","k_prompts_out",["bytes.lit","prompts"]],["let","entries",["vec_u8.with_capacity",96]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",1]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","k_prompts_out"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_prompts_out"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["std.bytes.len","prompts_val"]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","prompts_val"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","result_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.util.json.json_from_value_v1",["bytes.view","result_val"]]],"kind":"defn","name":"std.mcp.toolkit.prompts_file.prompts_list_result_v1","params":[{"name":"prompts_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.json.canon","ext.json.data_model","std.bytes","std.fs","std.mcp.util.json"],"kind":"module","module_id":"std.mcp.toolkit.prompts_file","schema_version":"x07.x07ast@0.5.0"}
