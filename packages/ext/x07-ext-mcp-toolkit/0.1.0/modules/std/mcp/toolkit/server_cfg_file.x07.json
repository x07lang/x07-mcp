{
  "schema_version": "x07.x07ast@0.5.0",
  "kind": "module",
  "module_id": "std.mcp.toolkit.server_cfg_file",
  "imports": ["ext.data_model", "ext.json.canon", "ext.json.data_model", "std.fs", "std.parse"],
  "decls": [
    {
      "kind": "export",
      "names": [
        "std.mcp.toolkit.server_cfg_file.load_server_cfg_from_fs_v1",
        "std.mcp.toolkit.server_cfg_file.server_name_v1",
        "std.mcp.toolkit.server_cfg_file.server_protocol_version_v1",
        "std.mcp.toolkit.server_cfg_file.server_version_v1",
        "std.mcp.toolkit.server_cfg_file.tools_manifest_path_v1",
        "std.mcp.toolkit.server_cfg_file.transport_max_line_bytes_v1",
        "std.mcp.toolkit.server_cfg_file.worker_exe_path_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1",
      "params": [],
      "result": "i32",
      "body": 7211
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file._parse_server_cfg_v1",
      "params": [{ "name": "json", "ty": "bytes_view" }],
      "result": "result_bytes",
      "body": [
        "begin",
        ["let", "canon", ["ext.json.canon.canonicalize", "json"]],
        ["if", ["=", ["bytes.len", "canon"], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "doc", ["ext.json.data_model.parse", "canon"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["!=", ["ext.data_model.root_kind", "dv"], 5], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_schema", ["bytes.lit", "schema_version"]],
        ["let", "schema_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_schema"]]],
        ["if", ["<", "schema_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "schema_ver", ["ext.data_model.string_get", "dv", "schema_off"]],
        ["let", "want", ["bytes.lit", "x07.mcp.server_config@0.1.0"]],
        ["if", ["=", ["bytes.eq", ["bytes.view", "schema_ver"], ["bytes.view", "want"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_server", ["bytes.lit", "server"]],
        ["let", "server_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_server"]]],
        ["if", ["<", "server_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["!=", ["ext.data_model.kind_at", "dv", "server_off"], 5], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_name", ["bytes.lit", "name"]],
        ["let", "name_off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_name"]]],
        ["if", ["<", "name_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.string_get", "dv", "name_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_ver", ["bytes.lit", "version"]],
        ["let", "ver_off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_ver"]]],
        ["if", ["<", "ver_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.string_get", "dv", "ver_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_pv", ["bytes.lit", "protocolVersion"]],
        ["let", "pv_off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_pv"]]],
        ["if", ["<", "pv_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.string_get", "dv", "pv_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_tools_path", ["bytes.lit", "tools_manifest_path"]],
        ["let", "tools_path_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_tools_path"]]],
        ["if", ["<", "tools_path_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.string_get", "dv", "tools_path_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_worker_exe_path", ["bytes.lit", "worker_exe_path"]],
        ["let", "worker_exe_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_worker_exe_path"]]],
        ["if", ["<", "worker_exe_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.string_get", "dv", "worker_exe_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_transport", ["bytes.lit", "transport"]],
        ["let", "transport_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_transport"]]],
        ["if", ["<", "transport_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["!=", ["ext.data_model.kind_at", "dv", "transport_off"], 5], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_kind", ["bytes.lit", "kind"]],
        ["let", "kind_off", ["ext.data_model.map_find", "dv", "transport_off", ["bytes.view", "k_kind"]]],
        ["if", ["<", "kind_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "kind", ["ext.data_model.string_get", "dv", "kind_off"]],
        ["let", "want_stdio", ["bytes.lit", "stdio"]],
        ["if", ["=", ["bytes.eq", ["bytes.view", "kind"], ["bytes.view", "want_stdio"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["let", "k_max", ["bytes.lit", "max_line_bytes"]],
        ["let", "max_off", ["ext.data_model.map_find", "dv", "transport_off", ["bytes.view", "k_max"]]],
        ["if", ["<", "max_off", 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["if", ["=", ["bytes.len", ["ext.data_model.number_get", "dv", "max_off"]], 0], ["return", ["result_bytes.err", ["std.mcp.toolkit.server_cfg_file._err_invalid_server_cfg_v1"]]], 0],
        ["result_bytes.ok", "canon"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.load_server_cfg_from_fs_v1",
      "params": [{ "name": "path", "ty": "bytes_view" }],
      "result": "result_bytes",
      "body": [
        "begin",
        ["let", "b", ["std.fs.read", "path"]],
        ["std.mcp.toolkit.server_cfg_file._parse_server_cfg_v1", "b"]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.server_name_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_server", ["bytes.lit", "server"]],
        ["let", "server_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_server"]]],
        ["if", ["<", "server_off", 0], ["return", ["bytes.alloc", 0]], 0],
        ["let", "k_name", ["bytes.lit", "name"]],
        ["let", "off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_name"]]],
        ["if", ["<", "off", 0], ["bytes.alloc", 0], ["ext.data_model.string_get", "dv", "off"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.server_version_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_server", ["bytes.lit", "server"]],
        ["let", "server_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_server"]]],
        ["if", ["<", "server_off", 0], ["return", ["bytes.alloc", 0]], 0],
        ["let", "k_version", ["bytes.lit", "version"]],
        ["let", "off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_version"]]],
        ["if", ["<", "off", 0], ["bytes.alloc", 0], ["ext.data_model.string_get", "dv", "off"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.server_protocol_version_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_server", ["bytes.lit", "server"]],
        ["let", "server_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_server"]]],
        ["if", ["<", "server_off", 0], ["return", ["bytes.alloc", 0]], 0],
        ["let", "k_pv", ["bytes.lit", "protocolVersion"]],
        ["let", "off", ["ext.data_model.map_find", "dv", "server_off", ["bytes.view", "k_pv"]]],
        ["if", ["<", "off", 0], ["bytes.alloc", 0], ["ext.data_model.string_get", "dv", "off"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.tools_manifest_path_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_tools", ["bytes.lit", "tools_manifest_path"]],
        ["let", "off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_tools"]]],
        ["if", ["<", "off", 0], ["bytes.alloc", 0], ["ext.data_model.string_get", "dv", "off"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.worker_exe_path_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", ["bytes.alloc", 0]], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_worker", ["bytes.lit", "worker_exe_path"]],
        ["let", "off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_worker"]]],
        ["if", ["<", "off", 0], ["bytes.alloc", 0], ["ext.data_model.string_get", "dv", "off"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file._parse_i32_or_0_v1",
      "params": [{ "name": "b", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "st", ["std.parse.i32_status_le", "b"]],
        ["if", ["if", [">=u", ["bytes.len", "st"], 5], ["=", ["bytes.get_u8", "st", 0], 1], 0], ["codec.read_u32_le", "st", 1], 0]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.toolkit.server_cfg_file.transport_max_line_bytes_v1",
      "params": [{ "name": "cfg_json", "ty": "bytes_view" }],
      "result": "i32",
      "body": [
        "begin",
        ["let", "doc", ["ext.json.data_model.parse", "cfg_json"]],
        ["let", "dv", ["bytes.view", "doc"]],
        ["if", ["=", ["ext.data_model.doc_is_err", "dv"], 1], ["return", 0], 0],
        ["let", "root", ["ext.data_model.root_offset", "dv"]],
        ["let", "k_transport", ["bytes.lit", "transport"]],
        ["let", "transport_off", ["ext.data_model.map_find", "dv", "root", ["bytes.view", "k_transport"]]],
        ["if", ["<", "transport_off", 0], ["return", 0], 0],
        ["let", "k_max", ["bytes.lit", "max_line_bytes"]],
        ["let", "max_off", ["ext.data_model.map_find", "dv", "transport_off", ["bytes.view", "k_max"]]],
        [
          "if",
          ["<", "max_off", 0],
          0,
          [
            "begin",
            ["let", "num", ["ext.data_model.number_get", "dv", "max_off"]],
            ["if", ["=", ["bytes.len", "num"], 0], 0, ["std.mcp.toolkit.server_cfg_file._parse_i32_or_0_v1", "num"]]
          ]
        ]
      ]
    }
  ]
}
