{"decls":[{"kind":"export","names":["std.mcp.obs.tests.test_audit_event_build_tool_invocation_v1","std.mcp.obs.tests.test_metrics_openmetrics_export_v1"]},{"body":["begin",["let","hn",["view.len","hay"]],["let","nn",["view.len","needle"]],["if",["<=","nn",0],["return",0],0],["if",["<","hn","nn"],["return",-1],0],["let","limit",["-","hn","nn"]],["for","i",0,["+","limit",1],["begin",["let","ok",1],["for","j",0,"nn",["begin",["if",["=",["view.get_u8","hay",["+","i","j"]],["view.get_u8","needle","j"]],0,["begin",["set","ok",0],["set","j","nn"],0]],0]],["if",["=","ok",1],["return","i"],0],0]],-1],"kind":"defn","name":"std.mcp.obs.tests._find_sub_v1","params":[{"name":"hay","ty":"bytes_view"},{"name":"needle","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","ts",["bytes.lit","2026-02-14T00:00:00Z"]],["let","tool",["bytes.lit","hello.log"]],["let","inv",["bytes.lit","inv_0001"]],["let","rid",["bytes.lit","3"]],["let","auth_mode",["bytes.lit","none"]],["let","empty",["bytes.alloc",0]],["let","sandbox_json",["bytes.lit","{\"fs\":{\"read\":[],\"write\":[]},\"net\":{\"allow\":[]},\"process\":{\"allow\":false}}"]],["let","budgets_json",["bytes.lit","{\"x07_budget_profile\":\"mcp_tool_default_v1\",\"run_os_limits_profile\":\"mcp_tool_default_os_v1\"}"]],["let","event",["std.mcp.obs.audit.event_build_tool_invocation_v1",["bytes.view","ts"],["bytes.view","tool"],["bytes.view","inv"],["bytes.view","rid"],["bytes.view","auth_mode"],["bytes.view","empty"],["bytes.view","empty"],["bytes.view","sandbox_json"],["bytes.view","budgets_json"],["bytes.view","empty"],0,1]],["let","doc_b",["ext.json.data_model.parse",["bytes.view","event"]]],["let","doc",["bytes.view","doc_b"]],["try",["std.test.assert_i32_eq",["ext.data_model.doc_is_err","doc"],0,["std.test.code_assert_i32_eq"]]],["try",["std.test.assert_i32_eq",["ext.data_model.root_kind","doc"],5,["std.test.code_assert_i32_eq"]]],["let","root",["ext.data_model.root_offset","doc"]],["let","k_tool",["bytes.lit","tool"]],["let","tool_off",["ext.data_model.map_find","doc","root",["bytes.view","k_tool"]]],["try",["std.test.assert_true",[">=","tool_off",0],["std.test.code_assert_true"]]],["let","got_tool",["ext.data_model.string_get","doc","tool_off"]],["try",["std.test.assert_i32_eq",["bytes.eq",["bytes.view","got_tool"],["bytes.view","tool"]],1,["std.test.code_assert_i32_eq"]]],["std.test.pass"]],"kind":"defn","name":"std.mcp.obs.tests.test_audit_event_build_tool_invocation_v1","params":[],"result":"result_i32"},{"body":["begin",["let","snap0",["std.mcp.obs.metrics.registry_defaults_v1"]],["let","labels",["bytes.lit","{\"tool\":\"hello.log\"}"]],["let","ok",["bytes.lit","ok"]],["let","snap1",["std.mcp.obs.metrics.snapshot_update_tool_call_v1",["bytes.view","snap0"],["bytes.view","labels"],7,["bytes.view","ok"],0]],["let","om",["std.mcp.obs.metrics.export_openmetrics_v1",["bytes.view","snap1"]]],["try",["std.test.assert_true",[">",["bytes.len","om"],0],["std.test.code_assert_true"]]],["let","needle",["bytes.lit","mcp_tool_calls_total{tool=\"hello.log\",status=\"ok\"} 1"]],["try",["std.test.assert_true",[">=",["std.mcp.obs.tests._find_sub_v1","om",["bytes.view","needle"]],0],["std.test.code_assert_true"]]],["std.test.pass"]],"kind":"defn","name":"std.mcp.obs.tests.test_metrics_openmetrics_export_v1","params":[],"result":"result_i32"}],"imports":["ext.data_model","ext.json.data_model","std.bytes","std.mcp.obs.audit","std.mcp.obs.metrics","std.test"],"kind":"module","module_id":"std.mcp.obs.tests","schema_version":"x07.x07ast@0.5.0"}
