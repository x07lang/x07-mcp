{"decls":[{"kind":"export","names":["std.mcp.sandbox.task_store_mem_v1.cursor_decode_v1","std.mcp.sandbox.task_store_mem_v1.cursor_encode_v1","std.mcp.sandbox.task_store_mem_v1.get_task_args_json_v1","std.mcp.sandbox.task_store_mem_v1.get_task_json_v1","std.mcp.sandbox.task_store_mem_v1.get_task_progress_token_json_v1","std.mcp.sandbox.task_store_mem_v1.get_task_request_id_json_v1","std.mcp.sandbox.task_store_mem_v1.get_task_result_json_v1","std.mcp.sandbox.task_store_mem_v1.get_task_status_v1","std.mcp.sandbox.task_store_mem_v1.get_task_ticks_done_v1","std.mcp.sandbox.task_store_mem_v1.get_task_tool_name_v1","std.mcp.sandbox.task_store_mem_v1.get_task_value_v1","std.mcp.sandbox.task_store_mem_v1.list_tasks_json_v1","std.mcp.sandbox.task_store_mem_v1.new_v1","std.mcp.sandbox.task_store_mem_v1.put_tool_task_new_v1","std.mcp.sandbox.task_store_mem_v1.set_task_cancelled_v1","std.mcp.sandbox.task_store_mem_v1.set_task_completed_v1","std.mcp.sandbox.task_store_mem_v1.set_task_failed_v1","std.mcp.sandbox.task_store_mem_v1.set_task_failed_with_result_v1","std.mcp.sandbox.task_store_mem_v1.set_task_status_message_v1","std.mcp.sandbox.task_store_mem_v1.set_task_working_step_v1"]},{"body":7402,"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1","params":[],"result":"i32"},{"body":7401,"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._err_not_found_v1","params":[],"result":"i32"},{"body":["begin",["let","n",["view.len","rec"]],["if",["if",["<","off",0],1,[">=u",["+","off",4],["+","n",1]]],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","rec","off"]],["let","start",["+","off",4]],["if",[">=u",["+","start","len"],["+","n",1]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","rec","start","len"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","params":[{"name":"rec","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],["codec.read_u32_le","store",12],0]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._hdr_lists_map_v1","params":[{"name":"store","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],["codec.read_u32_le","store",4],1]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._hdr_max_tasks_v1","params":[{"name":"store","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","store"],16],["return",0],0],["if",["!=",["codec.read_u32_le","store",0],1],["return",0],0],1],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","params":[{"name":"store","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],["codec.read_u32_le","store",8],0]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","params":[{"name":"store","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","sep",["bytes.alloc",1]],["set","sep",["bytes.set_u8","sep",0,0]],["let","a",["view.to_bytes","auth_context_id"]],["let","t",["view.to_bytes","task_id"]],["let","p",["std.bytes.concat",["bytes.view","a"],["bytes.view","sep"]]],["std.bytes.concat",["bytes.view","p"],["bytes.view","t"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._key_v1","params":[{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","lst"],4],0,["codec.read_u32_le","lst",0]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._list_count_v1","params":[{"name":"lst","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","v",["vec_u8.with_capacity",4]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le",0]]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._list_empty_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["std.mcp.sandbox.task_store_mem_v1._list_count_v1","lst"]],["if",["if",["<","idx",0],1,[">=u","idx","n"]],["return",["bytes.alloc",0]],0],["let","off",4],["for","i",0,"n",["begin",["if",["=","i","idx"],["begin",["if",[">=u",["+","off",4],["+",["view.len","lst"],1]],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","lst","off"]],["let","start",["+","off",4]],["if",[">=u",["+","start","len"],["+",["view.len","lst"],1]],["return",["bytes.alloc",0]],0],["return",["view.to_bytes",["view.slice","lst","start","len"]]]],0],["if",[">=u",["+","off",4],["+",["view.len","lst"],1]],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","lst","off"]],["set","off",["+",["+","off",4],"len"]],0]],["bytes.alloc",0]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._list_get_v1","params":[{"name":"lst","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["view.len","v"]]]],["vec_u8.extend_bytes","out","v"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"v","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","o1",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec",4]],["let","o2",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o1"]],["let","o3",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o2"]],["if",["<","o3",0],["return",-1],0],["+","o3",8]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","o1",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec",4]],["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","rec","o1"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","out",["vec_u8.with_capacity",256]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","status_code"]]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","status_message"]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","created_at"]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","last_updated_at"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["if",["<","ttl_ms",0],0,"ttl_ms"]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["if",["<","poll_ms",0],0,"poll_ms"]]]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","tool_name"]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","args_json"]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","request_id_json"]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","progress_token_json"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["if",["<","ticks_done",0],0,"ticks_done"]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["if",["<","result_kind",0],0,"result_kind"]]]],["set","out",["std.mcp.sandbox.task_store_mem_v1._push_len_bytes_v1","out","result_json"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_encode_v1","params":[{"name":"status_code","ty":"i32"},{"name":"status_message","ty":"bytes_view"},{"name":"created_at","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"ttl_ms","ty":"i32"},{"name":"poll_ms","ty":"i32"},{"name":"tool_name","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"},{"name":"request_id_json","ty":"bytes_view"},{"name":"progress_token_json","ty":"bytes_view"},{"name":"ticks_done","ty":"i32"},{"name":"result_kind","ty":"i32"},{"name":"result_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","o1",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec",4]],["let","o2",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o1"]],["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","rec","o2"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_last_updated_at_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","o1",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec",4]],["let","o2",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o1"]],["let","o3",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o2"]],["let","ttl_off","o3"],["if",["<","ttl_off",0],["return",0],0],["let","poll_off",["+","ttl_off",4]],["if",[">=u",["+","poll_off",4],["+",["view.len","rec"],1]],["return",0],0],["codec.read_u32_le","rec","poll_off"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1","rec"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["let","o_tool",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","off"]],["let","o_args",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_tool"]],["let","o_req",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_args"]],["let","o_prog",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_req"]],["let","ticks_off","o_prog"],["if",["<","ticks_off",0],["return",["bytes.alloc",0]],0],["let","kind_off",["+","ticks_off",4]],["let","res_off",["+","kind_off",4]],["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","rec","res_off"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_result_json_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1","rec"]],["if",["<","off",0],["return",0],0],["let","o_tool",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","off"]],["let","o_args",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_tool"]],["let","o_req",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_args"]],["let","o_prog",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_req"]],["let","ticks_off","o_prog"],["if",["<","ticks_off",0],["return",0],0],["let","kind_off",["+","ticks_off",4]],["if",[">=u",["+","kind_off",4],["+",["view.len","rec"],1]],["return",0],0],["codec.read_u32_le","rec","kind_off"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_result_kind_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","rec"],4],-1,["codec.read_u32_le","rec",0]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","rec",4],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_status_message_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1","rec"]],["if",["<","off",0],["return",0],0],["let","o_tool",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","off"]],["let","o_args",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_tool"]],["let","o_req",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_args"]],["let","o_prog",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o_req"]],["if",["<","o_prog",0],["return",0],0],["if",[">=u",["+","o_prog",4],["+",["view.len","rec"],1]],["return",0],0],["codec.read_u32_le","rec","o_prog"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","o1",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec",4]],["let","o2",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o1"]],["let","o3",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1","rec","o2"]],["if",["<","o3",0],["return",0],0],["if",[">=u",["+","o3",4],["+",["view.len","rec"],1]],["return",0],0],["codec.read_u32_le","rec","o3"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1","params":[{"name":"rec","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","rec"]],["if",["if",["<","off",0],1,[">=u",["+","off",4],["+","n",1]]],["return",-1],0],["let","len",["codec.read_u32_le","rec","off"]],["let","start",["+","off",4]],["if",[">=u",["+","start","len"],["+","n",1]],["return",-1],0],["+","start","len"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._skip_field_v1","params":[{"name":"rec","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["=","code",0],["return",["bytes.lit","working"]],0],["if",["=","code",1],["return",["bytes.lit","input_required"]],0],["if",["=","code",2],["return",["bytes.lit","completed"]],0],["if",["=","code",3],["return",["bytes.lit","failed"]],0],["if",["=","code",4],["return",["bytes.lit","cancelled"]],0],["bytes.lit","failed"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._status_text_v1","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","status_code",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1","rec"]],["let","status_text",["std.mcp.sandbox.task_store_mem_v1._status_text_v1","status_code"]],["let","status_msg",["std.mcp.sandbox.task_store_mem_v1._rec_status_message_v1","rec"]],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1","rec"]],["let","last_at",["std.mcp.sandbox.task_store_mem_v1._rec_last_updated_at_v1","rec"]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1","rec"]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1","rec"]],["let","k_taskId",["bytes.lit","taskId"]],["let","k_status",["bytes.lit","status"]],["let","k_statusMessage",["bytes.lit","statusMessage"]],["let","k_createdAt",["bytes.lit","createdAt"]],["let","k_lastUpdatedAt",["bytes.lit","lastUpdatedAt"]],["let","k_ttl",["bytes.lit","ttl"]],["let","k_poll",["bytes.lit","pollInterval"]],["let","v_taskId",["ext.data_model.value_string","task_id"]],["let","v_status",["ext.data_model.value_string",["bytes.view","status_text"]]],["let","v_created",["ext.data_model.value_string",["bytes.view","created_at"]]],["let","v_last",["ext.data_model.value_string",["bytes.view","last_at"]]],["let","ttl_s",["std.fmt.s32_to_dec","ttl"]],["let","poll_s",["std.fmt.s32_to_dec","poll"]],["let","v_ttl",["ext.data_model.value_number",["bytes.view","ttl_s"]]],["let","v_poll",["ext.data_model.value_number",["bytes.view","poll_s"]]],["let","n_extra",["if",[">",["bytes.len",["bytes.view","status_msg"]],0],1,0]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["+",6,"n_extra"]]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_taskId"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_taskId"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_taskId"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_taskId"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_status"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_status"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_status"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_status"]],["if",["=","n_extra",1],["begin",["let","v_sm",["ext.data_model.value_string",["bytes.view","status_msg"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_statusMessage"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_statusMessage"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_sm"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_sm"]],0],0],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_createdAt"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_createdAt"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_created"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_created"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_lastUpdatedAt"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_lastUpdatedAt"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_last"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_last"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_ttl"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_ttl"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_ttl"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_ttl"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_poll"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_poll"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v_poll"]]]],["set","entries",["vec_u8.extend_bytes","entries","v_poll"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"val"],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1._task_json_from_v1","params":[{"name":"task_id","ty":"bytes_view"},{"name":"rec","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","dec_doc",["ext.base64.base64_decode","cursor_b64"]],["let","decv",["bytes.view","dec_doc"]],["if",["=",["ext.base64.base64_is_err","decv"],1],["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]],0],["let","raw",["ext.base64.base64_get_bytes","decv"]],["let","rv",["bytes.view","raw"]],["let","n",["view.len","rv"]],["if",["<","n",8],["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]],0],["let","auth_len",["codec.read_u32_le","rv",0]],["if",["if",["<","auth_len",0],1,[">=u",["+","auth_len",8],["+","n",1]]],["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]],0],["if",["=","auth_len",["view.len","auth_context_id"]],0,["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]]],["if",["=",["view.cmp_range","rv",4,"auth_len","auth_context_id",0,"auth_len"],0],0,["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]]],["let","off",["codec.read_u32_le","rv",["+","auth_len",4]]],["result_i32.ok","off"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.cursor_decode_v1","params":[{"name":"auth_context_id","ty":"bytes_view"},{"name":"cursor_b64","ty":"bytes_view"}],"result":"result_i32"},{"body":["begin",["let","off2",["if",["<","offset",0],0,"offset"]],["let","buf",["vec_u8.with_capacity",["+",["view.len","auth_context_id"],12]]],["set","buf",["vec_u8.extend_bytes","buf",["codec.write_u32_le",["view.len","auth_context_id"]]]],["set","buf",["vec_u8.extend_bytes","buf","auth_context_id"]],["set","buf",["vec_u8.extend_bytes","buf",["codec.write_u32_le","off2"]]],["let","raw",["vec_u8.into_bytes","buf"]],["ext.base64.base64_encode",["bytes.view","raw"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.cursor_encode_v1","params":[{"name":"auth_context_id","ty":"bytes_view"},{"name":"offset","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","tool_res",["std.mcp.sandbox.task_store_mem_v1.get_task_tool_name_v1","store","auth_context_id","task_id"]],["if",["!=",["result_bytes.err_code","tool_res"],0],["return","tool_res"],0],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_args_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","val_res",["std.mcp.sandbox.task_store_mem_v1.get_task_value_v1","store","auth_context_id","task_id"]],["if",["!=",["result_bytes.err_code","val_res"],0],["return","val_res"],0],["let","val",["result_bytes.unwrap_or","val_res",["bytes.alloc",0]]],["let","json",["std.mcp.util.json.json_from_value_v1",["bytes.view","val"]]],["result_bytes.ok","json"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","req_res",["std.mcp.sandbox.task_store_mem_v1.get_task_request_id_json_v1","store","auth_context_id","task_id"]],["if",["!=",["result_bytes.err_code","req_res"],0],["return","req_res"],0],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_progress_token_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","args_res",["std.mcp.sandbox.task_store_mem_v1.get_task_args_json_v1","store","auth_context_id","task_id"]],["if",["!=",["result_bytes.err_code","args_res"],0],["return","args_res"],0],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_request_id_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["if",["=",["bytes.len","rec"],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","kind",["std.mcp.sandbox.task_store_mem_v1._rec_result_kind_v1","rec"]],["if",["=","kind",0],["return",["result_bytes.ok",["bytes.alloc",0]]],0],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._rec_result_json_v1","rec"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_result_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],0,["return",-1]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["if",["=",["bytes.len","rec"],0],["return",-1],0],["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1","rec"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_status_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","val_res",["std.mcp.sandbox.task_store_mem_v1.get_task_value_v1","store","auth_context_id","task_id"]],["if",["!=",["result_bytes.err_code","val_res"],0],["return",["result_i32.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["result_i32.ok",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_ticks_done_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_i32"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["if",["=",["bytes.len","rec"],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1","rec"]],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1","rec","tool_off"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_tool_name_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1","store"]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","empty",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty"]],["if",["=",["bytes.len","rec"],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["result_bytes.ok",["std.mcp.sandbox.task_store_mem_v1._task_json_from_v1","task_id","rec"]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.get_task_value_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1","store"],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]]],["let","lists_map",["std.mcp.sandbox.task_store_mem_v1._hdr_lists_map_v1","store"]],["let","auth_b",["view.to_bytes","auth_context_id"]],["let","empty",["std.mcp.sandbox.task_store_mem_v1._list_empty_v1"]],["let","lst",["std.hash_map_value.get_bytes_bytes_or","lists_map","auth_b","empty"]],["let","lstv",["bytes.view","lst"]],["let","n",["std.mcp.sandbox.task_store_mem_v1._list_count_v1","lstv"]],["let","offset",0],["if",[">",["view.len","cursor_b64"],0],["begin",["let","off_res",["std.mcp.sandbox.task_store_mem_v1.cursor_decode_v1","auth_context_id","cursor_b64"]],["if",["!=",["result_i32.err_code","off_res"],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_invalid_cursor_v1"]]],0],["set","offset",["result_i32.unwrap_or","off_res",0]],0],0],["let","lim",["if",["<","limit",1],1,"limit"]],["let","entries",["vec_u8.with_capacity",256]],["let","taken",0],["let","start_idx","offset"],["for","i",0,"lim",["begin",["let","idx",["+","start_idx","i"]],["if",[">=u","idx","n"],["set","i","lim"],0],["if",["<","idx","n"],["begin",["let","tid",["std.mcp.sandbox.task_store_mem_v1._list_get_v1","lstv","idx"]],["let","tj_res",["std.mcp.sandbox.task_store_mem_v1.get_task_value_v1","store","auth_context_id",["bytes.view","tid"]]],["if",["!=",["result_bytes.err_code","tj_res"],0],0,["begin",["let","tj",["result_bytes.unwrap_or","tj_res",["bytes.alloc",0]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","tj"]]]],["set","entries",["vec_u8.extend_bytes","entries","tj"]],["set","taken",["+","taken",1]],0]],0],0],0]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","elems",["vec_u8.with_capacity",256]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","taken"]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","entries_b"]]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","tasks_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["let","k_tasks",["bytes.lit","tasks"]],["let","k_next",["bytes.lit","nextCursor"]],["let","next",["bytes.alloc",0]],["let","next_obj",["ext.data_model.value_null"]],["if",["<u",["+","offset","taken"],"n"],["begin",["set","next",["std.mcp.sandbox.task_store_mem_v1.cursor_encode_v1","auth_context_id",["+","offset","taken"]]],["set","next_obj",["ext.data_model.value_string",["bytes.view","next"]]],0],0],["let","m_entries",["vec_u8.with_capacity",256]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["codec.write_u32_le",2]]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_tasks"]]]]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["bytes.view","k_tasks"]]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["codec.write_u32_le",["bytes.len","tasks_val"]]]],["set","m_entries",["vec_u8.extend_bytes","m_entries","tasks_val"]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_next"]]]]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["bytes.view","k_next"]]],["set","m_entries",["vec_u8.extend_bytes","m_entries",["codec.write_u32_le",["bytes.len","next_obj"]]]],["set","m_entries",["vec_u8.extend_bytes","m_entries","next_obj"]],["let","m_entries_b",["vec_u8.into_bytes","m_entries"]],["let","m_val",["ext.data_model.value_map_from_entries",["bytes.view","m_entries_b"]]],["result_bytes.ok",["std.mcp.util.json.json_from_value_v1",["bytes.view","m_val"]]]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.list_tasks_json_v1","params":[{"name":"store","ty":"bytes_view"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"cursor_b64","ty":"bytes_view"},{"name":"limit","ty":"i32"}],"result":"result_bytes"},{"body":["begin",["let","mt",["if",["<","max_tasks",1],1,"max_tasks"]],["let","cap",["if",["<","mt",16],"mt",16]],["let","tasks_map",["std.hash_map_value.with_capacity_bytes_bytes","cap"]],["let","lists_map",["std.hash_map_value.with_capacity_bytes_bytes",16]],["let","out",["vec_u8.with_capacity",16]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",1]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","mt"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","tasks_map"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","lists_map"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.new_v1","params":[{"name":"max_tasks","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return","store"]],["let","max_tasks",["std.mcp.sandbox.task_store_mem_v1._hdr_max_tasks_v1",["bytes.view","store"]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","lists_map",["std.mcp.sandbox.task_store_mem_v1._hdr_lists_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","status_msg",["bytes.lit","queued"]],["let","empty_b",["bytes.alloc",0]],["let","rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",0,["bytes.view","status_msg"],"created_at","last_updated_at","ttl_ms","poll_ms","tool_name","args_json","request_id_json","progress_token_json",0,0,["bytes.view","empty_b"]]],["let","_set",["std.hash_map_value.set_bytes_bytes","tasks_map","key","rec"]],["let","auth_b",["view.to_bytes","auth_context_id"]],["let","auth_key_get",["std.bytes.copy","auth_b"]],["let","auth_key_set",["std.bytes.copy","auth_b"]],["let","empty",["std.mcp.sandbox.task_store_mem_v1._list_empty_v1"]],["let","lst",["std.hash_map_value.get_bytes_bytes_or","lists_map","auth_key_get","empty"]],["let","lstv",["bytes.view","lst"]],["let","old_n",["std.mcp.sandbox.task_store_mem_v1._list_count_v1","lstv"]],["let","new_n",["if",[">=u",["+","old_n",1],"max_tasks"],"max_tasks",["+","old_n",1]]],["let","out",["vec_u8.with_capacity",["+",8,["view.len","lstv"]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","new_n"]]],["let","tid_b",["view.to_bytes","task_id"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["bytes.len",["bytes.view","tid_b"]]]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","tid_b"]]],["let","keep",["-","new_n",1]],["for","i",0,"keep",["begin",["let","t",["std.mcp.sandbox.task_store_mem_v1._list_get_v1","lstv","i"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["bytes.len",["bytes.view","t"]]]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","t"]]],0]],["let","new_lst",["vec_u8.into_bytes","out"]],["let","_set2",["std.hash_map_value.set_bytes_bytes","lists_map","auth_key_set","new_lst"]],["for","j","keep","old_n",["begin",["let","t",["std.mcp.sandbox.task_store_mem_v1._list_get_v1","lstv","j"]],["begin",["let","t_view",["bytes.view","t"]],["if",["=",["bytes.len","t_view"],0],0,["begin",["let","kdrop",["std.mcp.sandbox.task_store_mem_v1._key_v1",["bytes.view","auth_b"],"t_view"]],["std.hash_map_value.remove_bytes","tasks_map","kdrop"],0]]],0]],"store"],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.put_tool_task_new_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"created_at","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"ttl_ms","ty":"i32"},{"name":"poll_ms","ty":"i32"},{"name":"request_id_json","ty":"bytes_view"},{"name":"progress_token_json","ty":"bytes_view"},{"name":"tool_name","ty":"bytes_view"},{"name":"args_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",4,["bytes.view","empty"],["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",2,"cancel_err_json"]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_cancelled_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"cancel_err_json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["let","done_utf8",["bytes.lit","done"]],["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",2,["bytes.view","done_utf8"],["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",1,"result_json"]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_completed_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"result_json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",3,"status_message",["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",0,["bytes.view","empty"]]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_failed_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"status_message","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",3,"status_message",["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",1,"result_json"]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_failed_with_result_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"status_message","ty":"bytes_view"},{"name":"result_json","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["+",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]],1]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",0,"status_message_utf8",["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",0,["bytes.view","empty"]]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_status_message_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"status_message_utf8","ty":"bytes_view"}],"result":"result_bytes"},{"body":["begin",["if",["=",["std.mcp.sandbox.task_store_mem_v1._hdr_ok_v1",["bytes.view","store"]],1],0,["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]]],["let","tasks_map",["std.mcp.sandbox.task_store_mem_v1._hdr_tasks_map_v1",["bytes.view","store"]]],["let","key",["std.mcp.sandbox.task_store_mem_v1._key_v1","auth_context_id","task_id"]],["let","key_set",["std.bytes.copy","key"]],["let","empty",["bytes.alloc",0]],["let","empty_or",["bytes.alloc",0]],["let","rec",["std.hash_map_value.get_bytes_bytes_or","tasks_map","key","empty_or"]],["if",["=",["bytes.len",["bytes.view","rec"]],0],["return",["result_bytes.err",["std.mcp.sandbox.task_store_mem_v1._err_not_found_v1"]]],0],["let","st0",["std.mcp.sandbox.task_store_mem_v1._rec_status_code_v1",["bytes.view","rec"]]],["if",[">=","st0",2],["return",["result_bytes.ok","store"]],0],["let","created_at",["std.mcp.sandbox.task_store_mem_v1._rec_created_at_v1",["bytes.view","rec"]]],["let","ttl",["std.mcp.sandbox.task_store_mem_v1._rec_ttl_ms_v1",["bytes.view","rec"]]],["let","poll",["std.mcp.sandbox.task_store_mem_v1._rec_poll_ms_v1",["bytes.view","rec"]]],["let","tool_off",["std.mcp.sandbox.task_store_mem_v1._rec_after_poll_off_v1",["bytes.view","rec"]]],["let","tool_name",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"tool_off"]],["let","args_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"tool_off"]],["let","args_json",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"args_off"]],["let","req_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"args_off"]],["let","req_id",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"req_off"]],["let","prog_off",["std.mcp.sandbox.task_store_mem_v1._skip_field_v1",["bytes.view","rec"],"req_off"]],["let","prog",["std.mcp.sandbox.task_store_mem_v1._get_field_bytes_v1",["bytes.view","rec"],"prog_off"]],["let","ticks",["+",["std.mcp.sandbox.task_store_mem_v1._rec_ticks_done_v1",["bytes.view","rec"]],1]],["let","k1",["std.fmt.s32_to_dec",["if",["<","step",1],1,"step"]]],["let","k2",["std.fmt.s32_to_dec",["if",["<","total",1],1,"total"]]],["let","pfx",["bytes.lit","step "]],["let","mid",["bytes.lit","/"]],["let","t1",["std.bytes.concat",["bytes.view","pfx"],["bytes.view","k1"]]],["let","t2",["std.bytes.concat",["bytes.view","t1"],["bytes.view","mid"]]],["let","msg",["std.bytes.concat",["bytes.view","t2"],["bytes.view","k2"]]],["let","new_rec",["std.mcp.sandbox.task_store_mem_v1._rec_encode_v1",0,["bytes.view","msg"],["bytes.view","created_at"],"last_updated_at","ttl","poll",["bytes.view","tool_name"],["bytes.view","args_json"],["bytes.view","req_id"],["bytes.view","prog"],"ticks",0,["bytes.view","empty"]]],["std.hash_map_value.set_bytes_bytes","tasks_map","key_set","new_rec"],["result_bytes.ok","store"]],"kind":"defn","name":"std.mcp.sandbox.task_store_mem_v1.set_task_working_step_v1","params":[{"name":"store","ty":"bytes"},{"name":"auth_context_id","ty":"bytes_view"},{"name":"task_id","ty":"bytes_view"},{"name":"last_updated_at","ty":"bytes_view"},{"name":"step","ty":"i32"},{"name":"total","ty":"i32"}],"result":"result_bytes"}],"imports":["ext.base64","ext.data_model","std.bytes","std.fmt","std.hash_map_value","std.mcp.util.json"],"kind":"module","module_id":"std.mcp.sandbox.task_store_mem_v1","schema_version":"x07.x07ast@0.5.0"}
