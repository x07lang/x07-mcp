{"decls":[{"kind":"export","names":["std.mcp.transport.http_rules.accept_sse_v1","std.mcp.transport.http_rules.accept_valid_v1","std.mcp.transport.http_rules.origin_allowed_v1","std.mcp.transport.http_rules.origin_allowed_with_allowlist_v1","std.mcp.transport.http_rules.protocol_valid_v1"]},{"body":["if",["if",["if",[">=u","c",65],["<u","c",91],0],1,0],["+","c",32],"c"],"kind":"defn","name":"std.mcp.transport.http_rules._ascii_fold_u8_v1","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","hay"]],["let","m",["view.len","needle"]],["if",["<","m",1],["return",1],0],["if",["<","n","m"],["return",0],0],["for","start",0,["+",["-","n","m"],1],["begin",["let","ok",1],["for","j",0,"m",["begin",["let","hc",["std.mcp.transport.http_rules._ascii_fold_u8_v1",["view.get_u8","hay",["+","start","j"]]]],["let","nc",["std.mcp.transport.http_rules._ascii_fold_u8_v1",["view.get_u8","needle","j"]]],["if",["=","hc","nc"],0,["set","ok",0]],0]],["if",["=","ok",1],["return",1],0],0]],0],"kind":"defn","name":"std.mcp.transport.http_rules._contains_ci_v1","params":[{"name":"hay","ty":"bytes_view"},{"name":"needle","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","origin"]],["let","m",["view.len","pattern"]],["if",["<","m",1],["return",0],0],["if",["if",[">=","m",2],["if",["=",["view.get_u8","pattern",["-","m",2]],58],["=",["view.get_u8","pattern",["-","m",1]],42],0],0],["begin",["let","pref_len",["-","m",1]],["let","host_len",["-","m",2]],["if",["if",["=","n","host_len"],["=",["std.bytes.cmp_range","origin",0,"n","pattern",0,"host_len"],0],0],["return",1],0],["if",["<=","n","pref_len"],["return",0],0],["if",["=",["std.bytes.cmp_range","origin",0,"pref_len","pattern",0,"pref_len"],0],1,0]],["if",["=",["view.eq","origin","pattern"],1],1,0]]],"kind":"defn","name":"std.mcp.transport.http_rules._origin_match_pattern_v1","params":[{"name":"origin","ty":"bytes_view"},{"name":"pattern","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","a_sse",["bytes.lit","text/event-stream"]],["if",["=",["std.mcp.transport.http_rules._contains_ci_v1","accept_header",["bytes.view","a_sse"]],0],0,1]],"kind":"defn","name":"std.mcp.transport.http_rules.accept_sse_v1","params":[{"name":"accept_header","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","a_json",["bytes.lit","application/json"]],["let","a_sse",["bytes.lit","text/event-stream"]],["if",["=",["std.mcp.transport.http_rules._contains_ci_v1","accept_header",["bytes.view","a_json"]],0],["return",0],0],["if",["=",["std.mcp.transport.http_rules._contains_ci_v1","accept_header",["bytes.view","a_sse"]],0],["return",0],0],1],"kind":"defn","name":"std.mcp.transport.http_rules.accept_valid_v1","params":[{"name":"accept_header","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","default_allowlist",["bytes.lit","[\"http://localhost:*\",\"http://127.0.0.1:*\",\"https://mcp.example.com\"]"]],["std.mcp.transport.http_rules.origin_allowed_with_allowlist_v1","origin","allow_missing",["bytes.view","default_allowlist"]]],"kind":"defn","name":"std.mcp.transport.http_rules.origin_allowed_v1","params":[{"name":"origin","ty":"bytes_view"},{"name":"allow_missing","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["=",["view.len","origin"],0],["return","allow_missing"],0],["let","doc_b",["ext.json.data_model.parse","allowlist_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",0],0],["if",["!=",["ext.data_model.root_kind","doc"],4],["return",0],0],["let","root",["ext.data_model.root_offset","doc"]],["let","n",["ext.data_model.seq_len","doc","root"]],["if",["<","n",0],["return",0],0],["for","i",0,"n",["begin",["let","off",["ext.data_model.seq_get","doc","root","i"]],["if",["<","off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","doc","off"],3],0,["begin",["let","pat",["ext.data_model.string_get","doc","off"]],["if",["=",["std.mcp.transport.http_rules._origin_match_pattern_v1","origin",["bytes.view","pat"]],1],["return",1],0],0]]]],0]],0],"kind":"defn","name":"std.mcp.transport.http_rules.origin_allowed_with_allowlist_v1","params":[{"name":"origin","ty":"bytes_view"},{"name":"allow_missing","ty":"i32"},{"name":"allowlist_json","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","supported0",["bytes.lit","2025-11-25"]],["let","supported1",["bytes.lit","2025-06-18"]],["let","supported2",["bytes.lit","2025-03-26"]],["if",["=",["view.len","version_header"],0],["return",1],0],["if",["|",["=",["view.eq","version_header",["bytes.view","supported0"]],1],["|",["=",["view.eq","version_header",["bytes.view","supported1"]],1],["=",["view.eq","version_header",["bytes.view","supported2"]],1]]],1,0]],"kind":"defn","name":"std.mcp.transport.http_rules.protocol_valid_v1","params":[{"name":"version_header","ty":"bytes_view"}],"result":"i32"}],"imports":["ext.data_model","ext.json.data_model","std.bytes"],"kind":"module","module_id":"std.mcp.transport.http_rules","schema_version":"x07.x07ast@0.5.0"}
