{"decls":[{"kind":"export","names":["std.mcp.transport.http_sse_outbox_v1.rb_append_v1","std.mcp.transport.http_sse_outbox_v1.rb_empty_v1","std.mcp.transport.http_sse_outbox_v1.rb_write_after_seq_v1","std.mcp.transport.http_sse_outbox_v1.write_chunk_end_v1","std.mcp.transport.http_sse_outbox_v1.write_chunk_v1","std.mcp.transport.http_sse_outbox_v1.write_sse_head_v1"]},{"body":["begin",["let","hex",["bytes.lit","0123456789abcdef"]],["let","x",["if",["<","n",0],0,"n"]],["let","out",["vec_u8.with_capacity",8]],["let","started",0],["for","i",0,8,["begin",["let","shift",["-",28,["*","i",4]]],["let","nib",["&",[">>u","x","shift"],15]],["if",["if",["=","started",0],["=","nib",0],0],0,["begin",["set","started",1],["set","out",["vec_u8.push","out",["bytes.get_u8",["bytes.view","hex"],"nib"]]],0]],0]],["if",["=","started",0],["begin",["set","out",["vec_u8.push","out",48]],0],0],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1._u32_to_hex_nz_v1","params":[{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","doc",["std.net.io.write_all_v1","stream_handle","data","caps"]],["if",["=",["std.net.err.is_err_doc_v1",["bytes.view","doc"]],1],0,1]],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"data","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["bytes.len","rb"]],["if",["<","n",4],["begin",["let","v",["vec_u8.with_capacity",["+","payload_len",16]]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le",1]]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","seq"]]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","payload_len"]]],["set","v",["vec_u8.extend_bytes","v","payload"]],["return",["vec_u8.into_bytes","v"]]],0],["let","count0",["codec.read_u32_le","rb",0]],["let","count",["if",["<","count0",0],0,"count0"]],["let","off",4],["let","drop",["if",[">",["+","count",1],"max_events"],["-",["+","count",1],"max_events"],0]],["let","drop2",["if",["<","drop",0],0,"drop"]],["for","_",0,"drop2",["begin",["if",[">=u",["+","off",8],["+","n",1]],["begin",["set","off","n"],0],0],["let","plen",["codec.read_u32_le","rb",["+","off",4]]],["let","plen2",["if",["<","plen",0],0,"plen"]],["set","off",["+","off",["+","plen2",8]]],0]],0,["let","tail_len",["-","n","off"]],["let","new_count",["-",["+","count",1],"drop2"]],["let","v",["vec_u8.with_capacity",["+","tail_len",["+","payload_len",16]]]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","new_count"]]],["if",[">","tail_len",0],["begin",["set","v",["vec_u8.extend_bytes","v",["view.slice","rb","off","tail_len"]]],0],0],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","seq"]]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","payload_len"]]],["set","v",["vec_u8.extend_bytes","v","payload"]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.rb_append_v1","params":[{"name":"rb","ty":"bytes_view"},{"name":"seq","ty":"i32"},{"name":"payload_len","ty":"i32"},{"name":"payload","ty":"bytes_view"},{"name":"max_events","ty":"i32"}],"result":"bytes"},{"body":["codec.write_u32_le",0],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.rb_empty_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["bytes.len","rb"]],["if",["<","n",4],["return",0],0],["let","count0",["codec.read_u32_le","rb",0]],["let","count",["if",["<","count0",0],0,"count0"]],["let","off",4],["for","_",0,"count",["begin",["if",[">=u",["+","off",8],["+","n",1]],["return",0],0],["let","seq",["codec.read_u32_le","rb","off"]],["let","plen",["codec.read_u32_le","rb",["+","off",4]]],["let","plen2",["if",["<","plen",0],0,"plen"]],["let","start",["+","off",8]],["if",[">=u",["+","start","plen2"],["+","n",1]],["return",0],0],["if",[">","seq","after_seq"],["if",["=",["std.mcp.transport.http_sse_outbox_v1.write_chunk_v1","stream_handle",["view.slice","rb","start","plen2"],"caps"],1],0,["return",0]],0],["set","off",["+","start","plen2"]],0]],1],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.rb_write_after_seq_v1","params":[{"name":"rb","ty":"bytes_view"},{"name":"after_seq","ty":"i32"},{"name":"stream_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","end",["bytes.alloc",5]],["set","end",["bytes.set_u8","end",0,48]],["set","end",["bytes.set_u8","end",1,13]],["set","end",["bytes.set_u8","end",2,10]],["set","end",["bytes.set_u8","end",3,13]],["set","end",["bytes.set_u8","end",4,10]],["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle",["bytes.view","end"],"caps"]],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.write_chunk_end_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","len",["view.len","payload"]],["let","hex",["std.mcp.transport.http_sse_outbox_v1._u32_to_hex_nz_v1","len"]],["let","crlf",["bytes.alloc",2]],["set","crlf",["bytes.set_u8","crlf",0,13]],["set","crlf",["bytes.set_u8","crlf",1,10]],["if",["=",["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle",["bytes.view","hex"],"caps"],1],0,["return",0]],["if",["=",["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle",["bytes.view","crlf"],"caps"],1],0,["return",0]],["if",["=",["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle","payload","caps"],1],0,["return",0]],["if",["=",["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle",["bytes.view","crlf"],"caps"],1],0,["return",0]],1],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.write_chunk_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"payload","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","s0",["bytes.lit","HTTP/1.1 200 OK"]],["let","s1",["bytes.lit","Content-Type: text/event-stream"]],["let","s2",["bytes.lit","Cache-Control: no-cache"]],["let","s3",["bytes.lit","Connection: keep-alive"]],["let","s4",["bytes.lit","Transfer-Encoding: chunked"]],["let","crlf",["bytes.alloc",2]],["set","crlf",["bytes.set_u8","crlf",0,13]],["set","crlf",["bytes.set_u8","crlf",1,10]],["let","out",["vec_u8.with_capacity",256]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","s0"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","s1"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","s2"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","s3"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","s4"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","crlf"]]],["let","b",["vec_u8.into_bytes","out"]],["std.mcp.transport.http_sse_outbox_v1._write_all_ok_v1","stream_handle",["bytes.view","b"],"caps"]],"kind":"defn","name":"std.mcp.transport.http_sse_outbox_v1.write_sse_head_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"i32"}],"imports":["std.codec","std.net.err","std.net.io"],"kind":"module","module_id":"std.mcp.transport.http_sse_outbox_v1","schema_version":"x07.x07ast@0.5.0"}
