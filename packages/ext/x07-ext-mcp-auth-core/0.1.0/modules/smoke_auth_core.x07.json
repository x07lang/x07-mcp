{"decls":[{"kind":"export","names":["smoke_auth_core.bearer_parse_and_challenge","smoke_auth_core.prm_doc_build_and_render","smoke_auth_core.prm_url_candidates","smoke_auth_core.scopes"]},{"body":["begin",["let","hdr0",["bytes.lit","Bearer TOKEN_OK"]],["let","tok0",["std.mcp.auth.bearer_v1.parse_authorization_bearer_v1",["bytes.view","hdr0"]]],["try",["std.test.assert_bytes_eq","tok0",["bytes.lit","TOKEN_OK"],["std.test.code_assert_bytes_eq"]]],["let","hdr1",["bytes.lit","bearer  TOKEN_OK  "]],["let","tok1",["std.mcp.auth.bearer_v1.parse_authorization_bearer_v1",["bytes.view","hdr1"]]],["try",["std.test.assert_bytes_eq","tok1",["bytes.lit","TOKEN_OK"],["std.test.code_assert_bytes_eq"]]],["let","hdr_bad",["bytes.lit","Basic abc"]],["let","tok_bad",["std.mcp.auth.bearer_v1.parse_authorization_bearer_v1",["bytes.view","hdr_bad"]]],["try",["std.test.assert_i32_eq",["bytes.len",["bytes.view","tok_bad"]],0,["std.test.code_assert_i32_eq"]]],["let","resource_md",["bytes.lit","http://127.0.0.1:8314/.well-known/oauth-protected-resource/mcp"]],["let","scope",["bytes.lit","mcp:tools"]],["let","www0",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md"],["bytes.view","scope"],0]],["try",["std.test.assert_bytes_eq","www0",["bytes.lit","Bearer resource_metadata=\"http://127.0.0.1:8314/.well-known/oauth-protected-resource/mcp\", scope=\"mcp:tools\""],["std.test.code_assert_bytes_eq"]]],["let","www1",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md"],["bytes.view","scope"],2]],["try",["std.test.assert_bytes_eq","www1",["bytes.lit","Bearer resource_metadata=\"http://127.0.0.1:8314/.well-known/oauth-protected-resource/mcp\", scope=\"mcp:tools\", error=\"invalid_token\""],["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"smoke_auth_core.bearer_parse_and_challenge","params":[],"result":"result_i32"},{"body":["begin",["let","oauth_cfg",["bytes.lit","{\"schema_version\":\"x07.mcp.oauth@0.2.0\",\"resource\":\"http://127.0.0.1:8314/mcp\",\"serve_root_alias\":true,\"authorization_servers\":[\"https://auth.example.com\"],\"scopes_supported\":[\"mcp:tools\"],\"bearer_methods_supported\":[\"header\"],\"validation\":{\"kind\":\"test_static\",\"static_tokens\":[{\"token\":\"TOKEN_OK\",\"sub\":\"dev-user\",\"scope\":\"mcp:tools\"}]}}"]],["let","doc",["std.mcp.auth.prm_v1.build_prm_doc_v1",["bytes.view","oauth_cfg"]]],["let","expected",["bytes.lit","{\"authorization_servers\":[\"https://auth.example.com\"],\"bearer_methods_supported\":[\"header\"],\"resource\":\"http://127.0.0.1:8314/mcp\",\"scopes_supported\":[\"mcp:tools\"]}"]],["try",["std.test.assert_bytes_eq","doc","expected",["std.test.code_assert_bytes_eq"]]],["let","unsorted",["bytes.lit","{\"b\":1,\"a\":2}"]],["let","rendered",["std.mcp.auth.prm_v1.render_prm_json_bytes_v1",["bytes.view","unsorted"]]],["try",["std.test.assert_bytes_eq","rendered",["bytes.lit","{\"a\":2,\"b\":1}"],["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"smoke_auth_core.prm_doc_build_and_render","params":[],"result":"result_i32"},{"body":["begin",["let","resource",["bytes.lit","http://127.0.0.1:8314/mcp"]],["let","got",["std.mcp.auth.prm_v1.prm_url_candidates_from_resource_v1",["bytes.view","resource"]]],["let","expected",["bytes.lit","{\"primary\":\"http://127.0.0.1:8314/.well-known/oauth-protected-resource/mcp\",\"root\":\"http://127.0.0.1:8314/.well-known/oauth-protected-resource\"}"]],["try",["std.test.assert_bytes_eq","got","expected",["std.test.code_assert_bytes_eq"]]],["std.test.pass"]],"kind":"defn","name":"smoke_auth_core.prm_url_candidates","params":[],"result":"result_i32"},{"body":["begin",["let","text",["bytes.lit","mcp:tools mcp:tasks mcp:tools"]],["let","got",["std.mcp.auth.scopes_v1.parse_scope_str_v1",["bytes.view","text"]]],["try",["std.test.assert_bytes_eq","got",["bytes.lit","[\"mcp:tasks\",\"mcp:tools\"]"],["std.test.code_assert_bytes_eq"]]],["let","ab_json",["bytes.lit","[\"a\",\"b\"]"]],["let","bc_json",["bytes.lit","[\"b\",\"c\"]"]],["let","u",["std.mcp.auth.scopes_v1.scopes_union_v1",["bytes.view","ab_json"],["bytes.view","bc_json"]]],["try",["std.test.assert_bytes_eq","u",["bytes.lit","[\"a\",\"b\",\"c\"]"],["std.test.code_assert_bytes_eq"]]],["let","tok_scopes_ok",["bytes.lit","[\"mcp:tools\",\"mcp:tasks\"]"]],["let","req_tools",["bytes.lit","[\"mcp:tools\"]"]],["try",["std.test.assert_i32_eq",["std.mcp.auth.scopes_v1.scopes_satisfy_all_v1",["bytes.view","tok_scopes_ok"],["bytes.view","req_tools"]],1,["std.test.code_assert_i32_eq"]]],["let","tok_scopes_tools",["bytes.lit","[\"mcp:tools\"]"]],["let","req_tasks",["bytes.lit","[\"mcp:tasks\"]"]],["try",["std.test.assert_i32_eq",["std.mcp.auth.scopes_v1.scopes_satisfy_all_v1",["bytes.view","tok_scopes_tools"],["bytes.view","req_tasks"]],0,["std.test.code_assert_i32_eq"]]],["std.test.pass"]],"kind":"defn","name":"smoke_auth_core.scopes","params":[],"result":"result_i32"}],"imports":["std.bytes","std.mcp.auth.bearer_v1","std.mcp.auth.prm_v1","std.mcp.auth.scopes_v1","std.test"],"kind":"module","module_id":"smoke_auth_core","schema_version":"x07.x07ast@0.3.0"}
