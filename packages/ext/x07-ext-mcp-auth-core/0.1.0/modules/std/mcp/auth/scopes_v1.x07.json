{"decls":[{"kind":"export","names":["std.mcp.auth.scopes_v1.parse_scope_str_v1","std.mcp.auth.scopes_v1.scopes_satisfy_all_v1","std.mcp.auth.scopes_v1.scopes_union_v1"]},{"body":["if",["=","c",32],1,["if",["=","c",9],1,["if",["=","c",10],1,["if",["=","c",13],1,0]]]],"kind":"defn","name":"std.mcp.auth.scopes_v1._is_ws_v1","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","doc",["ext.data_model.doc_ok","value"]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","doc"]]],["let","jv",["bytes.view","json_doc"]],["if",["=",["ext.data_model.doc_is_err","jv"],1],["return",["bytes.alloc",0]],0],["let","n",["view.len","jv"]],["if",["<u","n",2],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","jv",1,["-","n",1]]]],"kind":"defn","name":"std.mcp.auth.scopes_v1._json_from_value_v1","params":[{"name":"value","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","pack"]],["if",["<","n",4],["return",["bytes.alloc",0]],0],["if",["=",["std.mcp.auth.scopes_v1._pack_contains_v1","pack","token"],1],["view.to_bytes","pack"],["begin",["let","count",["std.mcp.auth.scopes_v1._pack_count_v1","pack"]],["let","new_count",["+","count",1]],["let","tok_len",["view.len","token"]],["let","out",["vec_u8.with_capacity",["+","n",["+","tok_len",8]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","new_count"]]],["set","out",["vec_u8.extend_bytes","out",["view.slice","pack",4,["-","n",4]]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","tok_len"]]],["set","out",["vec_u8.extend_bytes","out","token"]],["vec_u8.into_bytes","out"]]]],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_append_unique_v1","params":[{"name":"pack","ty":"bytes_view"},{"name":"token","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","count",["std.mcp.auth.scopes_v1._pack_count_v1","pack"]],["for","i",0,"count",["begin",["let","t",["std.mcp.auth.scopes_v1._pack_token_at_v1","pack","i"]],["if",["=",["view.eq",["bytes.view","t"],"token"],1],["return",1],0],0]],0],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_contains_v1","params":[{"name":"pack","ty":"bytes_view"},{"name":"token","ty":"bytes_view"}],"result":"i32"},{"body":["if",["<",["view.len","pack"],4],0,["codec.read_u32_le","pack",0]],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_count_v1","params":[{"name":"pack","ty":"bytes_view"}],"result":"i32"},{"body":["codec.write_u32_le",0],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_empty_v1","params":[],"result":"bytes"},{"body":["begin",["let","n",["view.len","scope_text_utf8"]],["let","pack",["std.mcp.auth.scopes_v1._pack_empty_v1"]],["let","i",0],["for","_",0,"n",["begin",["set","i",["std.mcp.auth.scopes_v1._skip_ws_v1","scope_text_utf8","i"]],["if",[">=","i","n"],["return","pack"],0],["let","end",["std.mcp.auth.scopes_v1._token_end_v1","scope_text_utf8","i"]],["let","len",["-","end","i"]],["if",[">","len",0],["begin",["set","pack",["std.mcp.auth.scopes_v1._pack_append_unique_v1",["bytes.view","pack"],["view.slice","scope_text_utf8","i","len"]]],0],0],["set","i",["+","end",1]],0]],"pack"],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_from_scope_str_v1","params":[{"name":"scope_text_utf8","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","scopes_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["std.mcp.auth.scopes_v1._pack_empty_v1"]],0],["if",["!=",["ext.data_model.root_kind","doc"],4],["return",["std.mcp.auth.scopes_v1._pack_empty_v1"]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","n",["ext.data_model.seq_len","doc","root"]],["if",["<","n",0],["return",["std.mcp.auth.scopes_v1._pack_empty_v1"]],0],["let","pack",["std.mcp.auth.scopes_v1._pack_empty_v1"]],["for","i",0,"n",["begin",["let","off",["ext.data_model.seq_get","doc","root","i"]],["if",["<","off",0],0,["if",["!=",["ext.data_model.kind_at","doc","off"],3],0,["begin",["let","tok",["ext.data_model.string_get","doc","off"]],["set","pack",["std.mcp.auth.scopes_v1._pack_append_unique_v1",["bytes.view","pack"],["bytes.view","tok"]]],0]]],0]],"pack"],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_from_scopes_json_v1","params":[{"name":"scopes_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","pack"]],["if",["<","n",4],["return",["bytes.alloc",0]],0],["let","count0",["codec.read_u32_le","pack",0]],["let","count",["if",["<","count0",0],0,"count0"]],["if",["|",["<","idx",0],[">=","idx","count"]],["return",["bytes.alloc",0]],0],["let","off",4],["for","i",0,"count",["begin",["if",[">=u",["+","off",4],["+","n",1]],["return",["bytes.alloc",0]],0],["let","len0",["codec.read_u32_le","pack","off"]],["let","len",["if",["<","len0",0],0,"len0"]],["set","off",["+","off",4]],["if",[">=u",["+","off","len"],["+","n",1]],["return",["bytes.alloc",0]],0],["if",["=","i","idx"],["return",["view.to_bytes",["view.slice","pack","off","len"]]],0],["set","off",["+","off","len"]],0]],["bytes.alloc",0]],"kind":"defn","name":"std.mcp.auth.scopes_v1._pack_token_at_v1","params":[{"name":"pack","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","count",["std.mcp.auth.scopes_v1._pack_count_v1","pack"]],["if",["<=","count",0],["return",["bytes.lit","[]"]],0],["let","used",["bytes.alloc","count"]],["let","elems",["vec_u8.with_capacity",256]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","count"]]],["for","_",0,"count",["begin",["let","best_i",["-",0,1]],["let","best_tok",["bytes.alloc",0]],["for","i",0,"count",["if",["=",["std.bytes.get_u8","used","i"],1],0,["begin",["let","tok",["std.mcp.auth.scopes_v1._pack_token_at_v1","pack","i"]],["if",["<","best_i",0],["begin",["set","best_i","i"],["set","best_tok","tok"],0],["if",["<",["std.bytes.cmp_range",["bytes.view","tok"],0,["bytes.len",["bytes.view","tok"]],["bytes.view","best_tok"],0,["bytes.len",["bytes.view","best_tok"]]],0],["begin",["set","best_i","i"],["set","best_tok","tok"],0],0]],0]]],["if",["<","best_i",0],["return",["bytes.alloc",0]],0],["set","used",["bytes.set_u8","used","best_i",1]],["let","val",["ext.data_model.value_string",["bytes.view","best_tok"]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le",["bytes.len",["bytes.view","val"]]]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","val"]]],0]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","seq_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["std.mcp.auth.scopes_v1._json_from_value_v1",["bytes.view","seq_val"]]],"kind":"defn","name":"std.mcp.auth.scopes_v1._scopes_json_from_pack_v1","params":[{"name":"pack","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","text"]],["let","i","start"],["for","_",0,"n",["begin",["if",[">=","i","n"],["return","i"],0],["if",["=",["std.mcp.auth.scopes_v1._is_ws_v1",["view.get_u8","text","i"]],1],["set","i",["+","i",1]],["return","i"]],0]],"i"],"kind":"defn","name":"std.mcp.auth.scopes_v1._skip_ws_v1","params":[{"name":"text","ty":"bytes_view"},{"name":"start","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","text"]],["let","i","start"],["for","_",0,"n",["begin",["if",[">=","i","n"],["return","i"],0],["if",["=",["std.mcp.auth.scopes_v1._is_ws_v1",["view.get_u8","text","i"]],1],["return","i"],["set","i",["+","i",1]]],0]],"i"],"kind":"defn","name":"std.mcp.auth.scopes_v1._token_end_v1","params":[{"name":"text","ty":"bytes_view"},{"name":"start","ty":"i32"}],"result":"i32"},{"body":["begin",["let","pack",["std.mcp.auth.scopes_v1._pack_from_scope_str_v1","scope_text_utf8"]],["std.mcp.auth.scopes_v1._scopes_json_from_pack_v1",["bytes.view","pack"]]],"kind":"defn","name":"std.mcp.auth.scopes_v1.parse_scope_str_v1","params":[{"name":"scope_text_utf8","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","pack_token",["std.mcp.auth.scopes_v1._pack_from_scopes_json_v1","token_scopes_json"]],["let","pack_req",["std.mcp.auth.scopes_v1._pack_from_scopes_json_v1","required_scopes_json"]],["let","n",["std.mcp.auth.scopes_v1._pack_count_v1",["bytes.view","pack_req"]]],["for","i",0,"n",["begin",["let","tok",["std.mcp.auth.scopes_v1._pack_token_at_v1",["bytes.view","pack_req"],"i"]],["if",["=",["std.mcp.auth.scopes_v1._pack_contains_v1",["bytes.view","pack_token"],["bytes.view","tok"]],0],["return",0],0],0]],1],"kind":"defn","name":"std.mcp.auth.scopes_v1.scopes_satisfy_all_v1","params":[{"name":"token_scopes_json","ty":"bytes_view"},{"name":"required_scopes_json","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","pack_a",["std.mcp.auth.scopes_v1._pack_from_scopes_json_v1","a_scopes_json"]],["let","pack_b",["std.mcp.auth.scopes_v1._pack_from_scopes_json_v1","b_scopes_json"]],["let","out_pack","pack_a"],["let","n",["std.mcp.auth.scopes_v1._pack_count_v1",["bytes.view","pack_b"]]],["for","i",0,"n",["begin",["let","tok",["std.mcp.auth.scopes_v1._pack_token_at_v1",["bytes.view","pack_b"],"i"]],["set","out_pack",["std.mcp.auth.scopes_v1._pack_append_unique_v1",["bytes.view","out_pack"],["bytes.view","tok"]]],0]],["std.mcp.auth.scopes_v1._scopes_json_from_pack_v1",["bytes.view","out_pack"]]],"kind":"defn","name":"std.mcp.auth.scopes_v1.scopes_union_v1","params":[{"name":"a_scopes_json","ty":"bytes_view"},{"name":"b_scopes_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.data_model.json","ext.json.data_model","std.bytes","std.codec"],"kind":"module","module_id":"std.mcp.auth.scopes_v1","schema_version":"x07.x07ast@0.5.0"}
