{"decls":[{"kind":"export","names":["std.mcp.auth.prm_v1.build_prm_doc_v1","std.mcp.auth.prm_v1.prm_url_candidates_from_resource_v1","std.mcp.auth.prm_v1.render_prm_json_bytes_v1"]},{"body":["begin",["let","doc",["ext.data_model.doc_ok","value"]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","doc"]]],["let","jv",["bytes.view","json_doc"]],["if",["=",["ext.data_model.doc_is_err","jv"],1],["return",["bytes.alloc",0]],0],["let","n",["view.len","jv"]],["if",["<u","n",2],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","jv",1,["-","n",1]]]],"kind":"defn","name":"std.mcp.auth.prm_v1._json_from_value_v1","params":[{"name":"value","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","parsed_b",["ext.url.parse.url_parse","url_utf8"]],["let","parsed",["bytes.view","parsed_b"]],["if",["=",["view.len","parsed"],0],["return",["bytes.alloc",0]],0],["let","scheme_b",["ext.url.parse.url_scheme","parsed","url_utf8"]],["let","host_b",["ext.url.parse.url_host","parsed","url_utf8"]],["let","port_b",["ext.url.parse.url_port","parsed","url_utf8"]],["let","scheme",["bytes.view","scheme_b"]],["let","host",["bytes.view","host_b"]],["let","port",["bytes.view","port_b"]],["if",["=",["view.len","scheme"],0],["return",["bytes.alloc",0]],0],["if",["=",["view.len","host"],0],["return",["bytes.alloc",0]],0],["let","out",["vec_u8.with_capacity",["+",["+",["+",["view.len","scheme"],["view.len","host"]],["view.len","port"]],8]]],["set","out",["vec_u8.extend_bytes","out","scheme"]],["set","out",["vec_u8.push","out",58]],["set","out",["vec_u8.push","out",47]],["set","out",["vec_u8.push","out",47]],["set","out",["vec_u8.extend_bytes","out","host"]],["if",[">",["view.len","port"],0],["begin",["set","out",["vec_u8.push","out",58]],["set","out",["vec_u8.extend_bytes","out","port"]],0],0],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.auth.prm_v1._url_base_v1","params":[{"name":"url_utf8","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<","seq_off",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","doc","seq_off"],4],["return",0],0],["let","n",["ext.data_model.seq_len","doc","seq_off"]],["if",["<","n",0],["return",0],0],["for","i",0,"n",["begin",["let","it",["ext.data_model.seq_get","doc","seq_off","i"]],["if",["<","it",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","doc","it"],3],["return",0],0],0]],1],"kind":"defn","name":"std.mcp.auth.prm_v1._validate_string_seq_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"seq_off","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<","off",0],["return",["bytes.alloc",0]],0],["let","end",["ext.data_model.skip_value","doc","off"]],["if",["<","end",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc","off",["-","end","off"]]]],"kind":"defn","name":"std.mcp.auth.prm_v1._value_slice_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","want_schema",["bytes.lit","x07.mcp.oauth@0.2.0"]],["let","k_schema",["bytes.lit","schema_version"]],["let","k_resource",["bytes.lit","resource"]],["let","k_auth_servers",["bytes.lit","authorization_servers"]],["let","k_scopes_supported",["bytes.lit","scopes_supported"]],["let","k_methods",["bytes.lit","bearer_methods_supported"]],["let","doc_b",["ext.json.data_model.parse","oauth_cfg_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","schema_off",["ext.data_model.map_find","doc","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","schema_off"],3],["return",["bytes.alloc",0]],0],["let","schema_ver",["ext.data_model.string_get","doc","schema_off"]],["if",["=",["bytes.eq",["bytes.view","schema_ver"],["bytes.view","want_schema"]],0],["return",["bytes.alloc",0]],0],["let","resource_off",["ext.data_model.map_find","doc","root",["bytes.view","k_resource"]]],["if",["<","resource_off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","resource_off"],3],["return",["bytes.alloc",0]],0],["let","resource",["ext.data_model.string_get","doc","resource_off"]],["let","resource_val",["ext.data_model.value_string",["bytes.view","resource"]]],["if",["=",["bytes.len",["bytes.view","resource_val"]],0],["return",["bytes.alloc",0]],0],["let","auth_servers_off",["ext.data_model.map_find","doc","root",["bytes.view","k_auth_servers"]]],["if",["=",["std.mcp.auth.prm_v1._validate_string_seq_v1","doc","auth_servers_off"],0],["return",["bytes.alloc",0]],0],["let","auth_servers_val",["std.mcp.auth.prm_v1._value_slice_v1","doc","auth_servers_off"]],["let","scopes_off",["ext.data_model.map_find","doc","root",["bytes.view","k_scopes_supported"]]],["let","scopes_val",["begin",["let","empty_elems",["vec_u8.with_capacity",4]],["set","empty_elems",["vec_u8.extend_bytes","empty_elems",["codec.write_u32_le",0]]],["let","empty_elems_b",["vec_u8.into_bytes","empty_elems"]],["ext.data_model.value_seq_from_elems",["bytes.view","empty_elems_b"]]]],["if",["=",["std.mcp.auth.prm_v1._validate_string_seq_v1","doc","scopes_off"],1],["begin",["set","scopes_val",["std.mcp.auth.prm_v1._value_slice_v1","doc","scopes_off"]],0],0],["let","methods_off",["ext.data_model.map_find","doc","root",["bytes.view","k_methods"]]],["let","methods_val",["bytes.alloc",0]],["if",["=",["std.mcp.auth.prm_v1._validate_string_seq_v1","doc","methods_off"],1],["begin",["set","methods_val",["std.mcp.auth.prm_v1._value_slice_v1","doc","methods_off"]],0],["begin",["let","b_header",["bytes.lit","header"]],["let","v_header",["ext.data_model.value_string",["bytes.view","b_header"]]],["let","elems",["vec_u8.with_capacity",64]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le",1]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le",["bytes.len",["bytes.view","v_header"]]]]],["set","elems",["vec_u8.extend_bytes","elems",["bytes.view","v_header"]]],["let","elems_b",["vec_u8.into_bytes","elems"]],["set","methods_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],0]],["let","v_auth_servers","auth_servers_val"],["let","v_scopes","scopes_val"],["let","v_methods","methods_val"],["let","entries",["vec_u8.with_capacity",512]],["let","count",4],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","count"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_resource"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_resource"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","resource_val"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","resource_val"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_auth_servers"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_auth_servers"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_auth_servers"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_auth_servers"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_scopes_supported"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_scopes_supported"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_scopes"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_scopes"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_methods"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_methods"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_methods"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_methods"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.auth.prm_v1._json_from_value_v1",["bytes.view","map_val"]]],"kind":"defn","name":"std.mcp.auth.prm_v1.build_prm_doc_v1","params":[{"name":"oauth_cfg_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","base",["std.mcp.auth.prm_v1._url_base_v1","resource_url_utf8"]],["if",["=",["bytes.len",["bytes.view","base"]],0],["return",["bytes.alloc",0]],0],["let","parsed_b",["ext.url.parse.url_parse","resource_url_utf8"]],["let","parsed",["bytes.view","parsed_b"]],["let","path_b",["ext.url.parse.url_path","parsed","resource_url_utf8"]],["let","path",["bytes.view","path_b"]],["let","prm_root_path",["bytes.lit","/.well-known/oauth-protected-resource"]],["let","root_url",["std.bytes.concat",["bytes.view","base"],["bytes.view","prm_root_path"]]],["let","primary_url",["std.bytes.concat",["bytes.view","root_url"],"path"]],["let","k_primary",["bytes.lit","primary"]],["let","k_root",["bytes.lit","root"]],["let","v_primary",["ext.data_model.value_string",["bytes.view","primary_url"]]],["let","v_root",["ext.data_model.value_string",["bytes.view","root_url"]]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",2]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_primary"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_primary"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_primary"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_primary"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_root"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_root"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_root"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_root"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.auth.prm_v1._json_from_value_v1",["bytes.view","map_val"]]],"kind":"defn","name":"std.mcp.auth.prm_v1.prm_url_candidates_from_resource_v1","params":[{"name":"resource_url_utf8","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","canon",["ext.json.canon.canonicalize","prm_doc_json"]],["if",["=",["bytes.len",["bytes.view","canon"]],0],["bytes.alloc",0],"canon"]],"kind":"defn","name":"std.mcp.auth.prm_v1.render_prm_json_bytes_v1","params":[{"name":"prm_doc_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.data_model.json","ext.json.canon","ext.json.data_model","ext.url.parse","std.bytes","std.codec"],"kind":"module","module_id":"std.mcp.auth.prm_v1","schema_version":"x07.x07ast@0.5.0"}
