{
  "schema_version": "x07.x07ast@0.5.0",
  "kind": "module",
  "module_id": "std.mcp.tool.errors",
  "imports": ["ext.data_model", "std.mcp.diag", "std.mcp.util.json"],
  "decls": [
    {
      "kind": "export",
      "names": ["std.mcp.tool.errors.diag_schema_validation_v1", "std.mcp.tool.errors.diag_v1"]
    },
    {
      "kind": "defn",
      "name": "std.mcp.tool.errors.diag_v1",
      "params": [
        { "name": "x07_diag", "ty": "bytes_view" },
        { "name": "category", "ty": "bytes_view" },
        { "name": "detail_json", "ty": "bytes_view" },
        { "name": "suggested_fix", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "k_type", ["bytes.lit", "type"]],
        ["let", "k_x07_diag", ["bytes.lit", "x07_diag"]],
        ["let", "k_category", ["bytes.lit", "category"]],
        ["let", "k_detail", ["bytes.lit", "detail"]],
        ["let", "k_suggested_fix", ["bytes.lit", "suggested_fix"]],
        ["let", "v_type", ["ext.data_model.value_string", ["bytes.view", ["std.mcp.diag.error_type_v1"]]]],
        ["let", "v_diag", ["ext.data_model.value_string", "x07_diag"]],
        ["let", "v_category", ["ext.data_model.value_string", "category"]],
        ["let", "detail_val", ["std.mcp.util.json.value_from_json_or_empty_map_v1", "detail_json"]],
        ["let", "v_suggested_fix", ["ext.data_model.value_string", "suggested_fix"]],
        ["let", "entries", ["vec_u8.with_capacity", 384]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", 5]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "k_category"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "k_category"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "v_category"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "v_category"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "k_detail"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "k_detail"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "detail_val"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "detail_val"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "k_suggested_fix"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "k_suggested_fix"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "v_suggested_fix"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "v_suggested_fix"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "k_type"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "k_type"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "v_type"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "v_type"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "k_x07_diag"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "k_x07_diag"]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", ["codec.write_u32_le", ["bytes.len", "v_diag"]]]],
        ["set", "entries", ["vec_u8.extend_bytes", "entries", "v_diag"]],
        ["let", "entries_b", ["vec_u8.into_bytes", "entries"]],
        ["let", "diag_val", ["ext.data_model.value_map_from_entries", ["bytes.view", "entries_b"]]],
        ["if", ["=", ["bytes.len", "diag_val"], 0], ["return", ["bytes.alloc", 0]], 0],
        ["std.mcp.util.json.json_from_value_v1", ["bytes.view", "diag_val"]]
      ]
    },
    {
      "kind": "defn",
      "name": "std.mcp.tool.errors.diag_schema_validation_v1",
      "params": [
        { "name": "tool_name", "ty": "bytes_view" },
        { "name": "errors_json", "ty": "bytes_view" }
      ],
      "result": "bytes",
      "body": [
        "begin",
        ["let", "k_tool", ["bytes.lit", "tool"]],
        ["let", "k_errors", ["bytes.lit", "errors"]],
        ["let", "v_tool", ["ext.data_model.value_string", "tool_name"]],
        ["let", "v_errors", ["std.mcp.util.json.value_from_json_or_null_v1", "errors_json"]],
        ["let", "detail_entries", ["vec_u8.with_capacity", 128]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", ["codec.write_u32_le", 2]]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", ["codec.write_u32_le", ["bytes.len", "k_errors"]]]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", "k_errors"]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", ["codec.write_u32_le", ["bytes.len", "v_errors"]]]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", "v_errors"]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", ["codec.write_u32_le", ["bytes.len", "k_tool"]]]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", "k_tool"]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", ["codec.write_u32_le", ["bytes.len", "v_tool"]]]],
        ["set", "detail_entries", ["vec_u8.extend_bytes", "detail_entries", "v_tool"]],
        ["let", "detail_entries_b", ["vec_u8.into_bytes", "detail_entries"]],
        ["let", "detail_val", ["ext.data_model.value_map_from_entries", ["bytes.view", "detail_entries_b"]]],
        ["let", "detail_json", ["std.mcp.util.json.json_from_value_v1", ["bytes.view", "detail_val"]]],
        ["let", "cat", ["bytes.lit", "schema_validation"]],
        ["let", "fix", ["bytes.lit", "Provide all required fields per the tool's inputSchema."]],
        [
          "std.mcp.tool.errors.diag_v1",
          ["bytes.view", ["std.mcp.diag.code_invalid_args_v1"]],
          ["bytes.view", "cat"],
          ["bytes.view", "detail_json"],
          ["bytes.view", "fix"]
        ]
      ]
    }
  ]
}

