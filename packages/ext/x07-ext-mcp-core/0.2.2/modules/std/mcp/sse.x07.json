{"decls":[{"kind":"export","names":["std.mcp.sse.encode_event_v1","std.mcp.sse.encode_retry_v1","std.mcp.sse.event_id_make_v1","std.mcp.sse.event_id_parse_seq_v1","std.mcp.sse.event_id_parse_session_id_v1","std.mcp.sse.event_id_parse_stream_key_v1","std.mcp.sse.event_id_parse_stream_kind_v1","std.mcp.sse.stream_key_from_id_json_v1"]},{"body":["begin",["let","n",["view.len","b"]],["for","i","start","n",["if",["=","c",["view.get_u8","b","i"]],["return","i"],0]],-1],"kind":"defn","name":"std.mcp.sse._find_byte_from_v1","params":[{"name":"b","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",["<","n",1],["return",-1],0],["let","x",0],["for","i",0,"n",["begin",["let","ch",["view.get_u8","b","i"]],["if",["if",[">=u","ch",48],["<u","ch",58],0],0,["return",-1]],["let","d",["-","ch",48]],["if",[">","x",214748364],["return",-1],0],["if",["if",["=","x",214748364],[">","d",7],0],["return",-1],0],["set","x",["+",["*","x",10],"d"]],0]],"x"],"kind":"defn","name":"std.mcp.sse._parse_i32_dec_strict_nonneg_v1","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","pref_id",["bytes.lit","id: "]],["let","pref_data",["bytes.lit","data: "]],["let","id_len",["view.len","event_id"]],["let","data_len",["view.len","data_json_or_empty"]],["let","cap",["+","id_len",["+","data_len",32]]],["let","out",["vec_u8.with_capacity","cap"]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","pref_id"]]],["set","out",["vec_u8.extend_bytes","out","event_id"]],["set","out",["vec_u8.push","out",10]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","pref_data"]]],["if",[">","data_len",0],["begin",["set","out",["vec_u8.extend_bytes","out","data_json_or_empty"]],0],0],["set","out",["vec_u8.push","out",10]],["set","out",["vec_u8.push","out",10]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sse.encode_event_v1","params":[{"name":"event_id","ty":"bytes_view"},{"name":"data_json_or_empty","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","ms",["if",["<","ms_i32",0],0,"ms_i32"]],["let","pref",["bytes.lit","retry: "]],["let","dec",["std.fmt.s32_to_dec","ms"]],["let","dec_len",["view.len",["bytes.view","dec"]]],["let","out",["vec_u8.with_capacity",["+","dec_len",16]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","pref"]]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","dec"]]],["set","out",["vec_u8.push","out",10]],["set","out",["vec_u8.push","out",10]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sse.encode_retry_v1","params":[{"name":"ms_i32","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","slash",47],["let","seq_dec",["std.fmt.s32_to_dec",["if",["<","seq_i32",0],0,"seq_i32"]]],["let","sid_len",["view.len","session_id"]],["let","kind_len",["view.len","stream_kind"]],["let","key_len",["view.len","stream_key"]],["let","seq_len",["view.len",["bytes.view","seq_dec"]]],["let","cap",["+","sid_len",["+","kind_len",["+","key_len",["+","seq_len",8]]]]],["let","out",["vec_u8.with_capacity","cap"]],["set","out",["vec_u8.extend_bytes","out","session_id"]],["set","out",["vec_u8.push","out","slash"]],["set","out",["vec_u8.extend_bytes","out","stream_kind"]],["set","out",["vec_u8.push","out","slash"]],["set","out",["vec_u8.extend_bytes","out","stream_key"]],["set","out",["vec_u8.push","out","slash"]],["set","out",["vec_u8.extend_bytes","out",["bytes.view","seq_dec"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sse.event_id_make_v1","params":[{"name":"session_id","ty":"bytes_view"},{"name":"stream_kind","ty":"bytes_view"},{"name":"stream_key","ty":"bytes_view"},{"name":"seq_i32","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","slash",47],["let","n",["view.len","event_id"]],["let","p0",["std.mcp.sse._find_byte_from_v1","event_id",0,"slash"]],["if",["<","p0",0],["return",-1],0],["let","p1",["std.mcp.sse._find_byte_from_v1","event_id",["+","p0",1],"slash"]],["if",["<","p1",0],["return",-1],0],["let","p2",["std.mcp.sse._find_byte_from_v1","event_id",["+","p1",1],"slash"]],["if",["<","p2",0],["return",-1],0],["let","seq_view",["view.slice","event_id",["+","p2",1],["-","n",["+","p2",1]]]],["std.mcp.sse._parse_i32_dec_strict_nonneg_v1","seq_view"]],"kind":"defn","name":"std.mcp.sse.event_id_parse_seq_v1","params":[{"name":"event_id","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","slash",47],["let","p0",["std.mcp.sse._find_byte_from_v1","event_id",0,"slash"]],["if",["<","p0",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","event_id",0,"p0"]]],"kind":"defn","name":"std.mcp.sse.event_id_parse_session_id_v1","params":[{"name":"event_id","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","slash",47],["let","p0",["std.mcp.sse._find_byte_from_v1","event_id",0,"slash"]],["if",["<","p0",0],["return",["bytes.alloc",0]],0],["let","p1",["std.mcp.sse._find_byte_from_v1","event_id",["+","p0",1],"slash"]],["if",["<","p1",0],["return",["bytes.alloc",0]],0],["let","p2",["std.mcp.sse._find_byte_from_v1","event_id",["+","p1",1],"slash"]],["if",["<","p2",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","event_id",["+","p1",1],["-","p2",["+","p1",1]]]]],"kind":"defn","name":"std.mcp.sse.event_id_parse_stream_key_v1","params":[{"name":"event_id","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","slash",47],["let","p0",["std.mcp.sse._find_byte_from_v1","event_id",0,"slash"]],["if",["<","p0",0],["return",["bytes.alloc",0]],0],["let","p1",["std.mcp.sse._find_byte_from_v1","event_id",["+","p0",1],"slash"]],["if",["<","p1",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","event_id",["+","p0",1],["-","p1",["+","p0",1]]]]],"kind":"defn","name":"std.mcp.sse.event_id_parse_stream_kind_v1","params":[{"name":"event_id","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","id_json"]],["if",["<","n",1],["return",["bytes.alloc",0]],0],["let","all_digits",1],["for","i",0,"n",["begin",["let","ch",["view.get_u8","id_json","i"]],["if",["if",[">=u","ch",48],["<u","ch",58],0],0,["set","all_digits",0]],0]],0,["if",["=","all_digits",1],["return",["std.bytes.copy","id_json"]],0],["let","canon",["ext.json.canon.canonicalize","id_json"]],["let","h",-2128831035],["let","prime",16777619],["let","m",["bytes.len",["bytes.view","canon"]]],["for","j",0,"m",["begin",["let","c",["bytes.get_u8",["bytes.view","canon"],"j"]],["set","h",["*","prime",["^","h","c"]]],0]],0,["let","hex",["bytes.lit","0123456789abcdef"]],["let","out",["vec_u8.with_capacity",8]],["for","k",0,8,["begin",["let","shift",["-",28,["*","k",4]]],["let","nib",["&",[">>u","h","shift"],15]],["let","ch",["bytes.get_u8",["bytes.view","hex"],"nib"]],["set","out",["vec_u8.push","out","ch"]],0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.mcp.sse.stream_key_from_id_json_v1","params":[{"name":"id_json","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.json.canon","std.bytes","std.fmt"],"kind":"module","module_id":"std.mcp.sse","schema_version":"x07.x07ast@0.5.0"}
