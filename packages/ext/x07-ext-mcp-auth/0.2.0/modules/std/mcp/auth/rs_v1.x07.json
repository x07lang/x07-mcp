{"decls":[{"kind":"export","names":["std.mcp.auth.rs_v1.oauth2_authenticate_http_v1","std.mcp.auth.rs_v1.oauth2_authorize_scopes_v1","std.mcp.auth.rs_v1.oauth2_rs_from_oauth_cfg_v1"]},{"body":["begin",["let","k_validation",["bytes.lit","validation"]],["let","k_static_tokens",["bytes.lit","static_tokens"]],["let","k_token",["bytes.lit","token"]],["let","k_sub",["bytes.lit","sub"]],["let","k_scope",["bytes.lit","scope"]],["let","validation_off",["ext.data_model.map_find","cfg_doc","cfg_root",["bytes.view","k_validation"]]],["let","tokens_off",["ext.data_model.map_find","cfg_doc","validation_off",["bytes.view","k_static_tokens"]]],["if",["!=",["ext.data_model.kind_at","cfg_doc","tokens_off"],4],["return",["bytes.alloc",0]],0],["let","n",["ext.data_model.seq_len","cfg_doc","tokens_off"]],["if",["<","n",0],["return",["bytes.alloc",0]],0],["let","out",["bytes.alloc",0]],["for","i",0,"n",["begin",["let","item_off",["ext.data_model.seq_get","cfg_doc","tokens_off","i"]],["if",["if",[">=","item_off",0],["=",["ext.data_model.kind_at","cfg_doc","item_off"],5],0],["begin",["let","candidate",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cfg_doc","item_off",["bytes.view","k_token"]]],["if",["=",["bytes.eq",["bytes.view","candidate"],"token"],1],["begin",["let","sub",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cfg_doc","item_off",["bytes.view","k_sub"]]],["let","scope_text",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cfg_doc","item_off",["bytes.view","k_scope"]]],["let","scopes_json",["std.mcp.auth.scopes_v1.parse_scope_str_v1",["bytes.view","scope_text"]]],["let","aud_json",["bytes.lit","[]"]],["let","ctx_val",["std.mcp.auth.rs_v1._ctx_val_v1",["bytes.view","sub"],["bytes.view","scopes_json"],["bytes.view","aud_json"]]],["set","out","ctx_val"],0],0],0],0],0]],"out"],"kind":"defn","name":"std.mcp.auth.rs_v1._auth_test_static_ctx_or_empty_v1","params":[{"name":"cfg_doc","ty":"bytes_view"},{"name":"cfg_root","ty":"i32"},{"name":"token","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_validation",["bytes.lit","validation"]],["let","k_kind",["bytes.lit","kind"]],["let","validation_off",["ext.data_model.map_find","cfg_doc","cfg_root",["bytes.view","k_validation"]]],["let","kind",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cfg_doc","validation_off",["bytes.view","k_kind"]]],"kind"],"kind":"defn","name":"std.mcp.auth.rs_v1._cfg_validation_kind_v1","params":[{"name":"cfg_doc","ty":"bytes_view"},{"name":"cfg_root","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","k_sub",["bytes.lit","sub"]],["let","k_scopes_json",["bytes.lit","scopes_json"]],["let","k_aud_json",["bytes.lit","aud_json"]],["let","entries",["vec_u8.with_capacity",256]],["let","has_sub",["if",[">",["view.len","sub"],0],1,0]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["+",2,"has_sub"]]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_scopes_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_scopes_json"]]],["let","v_scopes_json",["ext.data_model.value_string","scopes_json"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_scopes_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_scopes_json"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_aud_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_aud_json"]]],["let","v_aud_json",["ext.data_model.value_string","aud_json"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_aud_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_aud_json"]]],["if",["=","has_sub",1],["begin",["let","v_sub",["ext.data_model.value_string","sub"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_sub"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_sub"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_sub"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_sub"]]],0],0],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._ctx_val_v1","params":[{"name":"sub","ty":"bytes_view"},{"name":"scopes_json","ty":"bytes_view"},{"name":"aud_json","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_ok",["bytes.lit","ok"]],["let","k_err_status",["bytes.lit","err_status"]],["let","k_err_www",["bytes.lit","err_www_authenticate"]],["let","v_ok",["ext.data_model.value_bool",0]],["let","_x07_tmp_borrow_decls_4_body_5_2_1",["std.fmt.s32_to_dec","status"]],["let","v_status",["ext.data_model.value_number",["bytes.view","_x07_tmp_borrow_decls_4_body_5_2_1"]]],["let","v_www",["ext.data_model.value_string","www_auth"]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",3]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_ok"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_ok"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_ok"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_ok"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_err_status"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_err_status"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_status"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_status"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_err_www"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_err_www"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_www"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_www"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.auth.rs_v1._json_from_value_v1",["bytes.view","map_val"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._err_pack_v1","params":[{"name":"status","ty":"i32"},{"name":"www_auth","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","headers_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","v0",["std.mcp.auth.rs_v1._map_string_or_empty_v1","doc","root","name0"]],["if",[">",["bytes.len",["bytes.view","v0"]],0],"v0",["std.mcp.auth.rs_v1._map_string_or_empty_v1","doc","root","name1"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._headers_get_v1","params":[{"name":"headers_json","ty":"bytes_view"},{"name":"name0","ty":"bytes_view"},{"name":"name1","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_validation",["bytes.lit","validation"]],["let","k_introspection",["bytes.lit","introspection"]],["let","k_require_audience",["bytes.lit","require_audience"]],["let","k_audience",["bytes.lit","audience"]],["let","validation_off",["ext.data_model.map_find","cfg_doc","cfg_root",["bytes.view","k_validation"]]],["let","intro_off",["ext.data_model.map_find","cfg_doc","validation_off",["bytes.view","k_introspection"]]],["let","require_audience",["std.mcp.auth.rs_v1._map_bool_or_default_v1","cfg_doc","intro_off",["bytes.view","k_require_audience"],0]],["if",["=","require_audience",0],["return",1],0],["let","aud_cfg_off",["ext.data_model.map_find","cfg_doc","intro_off",["bytes.view","k_audience"]]],["if",["=",["std.mcp.auth.rs_v1._validate_string_seq_v1","cfg_doc","aud_cfg_off"],0],["return",0],0],["let","aud_doc_b",["ext.json.data_model.parse","aud_json"]],["let","aud_doc",["bytes.view","aud_doc_b"]],["if",["=",["ext.data_model.doc_is_err","aud_doc"],1],["return",0],0],["if",["!=",["ext.data_model.root_kind","aud_doc"],4],["return",0],0],["let","aud_root",["ext.data_model.root_offset","aud_doc"]],["let","aud_n",["ext.data_model.seq_len","aud_doc","aud_root"]],["if",["<","aud_n",0],["return",0],0],["let","cfg_n",["ext.data_model.seq_len","cfg_doc","aud_cfg_off"]],["if",["<","cfg_n",0],["return",0],0],["for","i",0,"cfg_n",["begin",["let","cfg_it",["ext.data_model.seq_get","cfg_doc","aud_cfg_off","i"]],["if",["if",[">=","cfg_it",0],["=",["ext.data_model.kind_at","cfg_doc","cfg_it"],3],0],["begin",["let","needle",["ext.data_model.string_get","cfg_doc","cfg_it"]],["for","j",0,"aud_n",["begin",["let","off",["ext.data_model.seq_get","aud_doc","aud_root","j"]],["if",["if",[">=","off",0],["=",["ext.data_model.kind_at","aud_doc","off"],3],0],["if",["begin",["let","aud_item",["ext.data_model.string_get","aud_doc","off"]],["=",["bytes.eq",["bytes.view","aud_item"],["bytes.view","needle"]],1]],["return",1],0],0],0]],0],0],0]],0],"kind":"defn","name":"std.mcp.auth.rs_v1._introspection_audience_ok_v1","params":[{"name":"cfg_doc","ty":"bytes_view"},{"name":"cfg_root","ty":"i32"},{"name":"aud_json","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","doc",["ext.data_model.doc_ok","value"]],["let","json_doc",["ext.data_model.json.emit_canon",["bytes.view","doc"]]],["let","jv",["bytes.view","json_doc"]],["if",["=",["ext.data_model.doc_is_err","jv"],1],["return",["bytes.alloc",0]],0],["let","n",["view.len","jv"]],["if",["<u","n",2],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","jv",1,["-","n",1]]]],"kind":"defn","name":"std.mcp.auth.rs_v1._json_from_value_v1","params":[{"name":"value","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<","map_off",0],["return","fallback"],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return","fallback"],0],["if",["!=",["ext.data_model.kind_at","doc","off"],1],["return","fallback"],0],["ext.data_model.bool_get","doc","off"]],"kind":"defn","name":"std.mcp.auth.rs_v1._map_bool_or_default_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"},{"name":"fallback","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<","map_off",0],["return",["bytes.alloc",0]],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","off"],3],["return",["bytes.alloc",0]],0],["ext.data_model.string_get","doc","off"]],"kind":"defn","name":"std.mcp.auth.rs_v1._map_string_or_empty_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_oauth_cfg_json",["bytes.lit","oauth_cfg_json"]],["let","doc_b",["ext.json.data_model.parse","rs_pack"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["std.mcp.auth.rs_v1._map_string_or_empty_v1","doc","root",["bytes.view","k_oauth_cfg_json"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._oauth_cfg_from_rs_pack_v1","params":[{"name":"rs_pack","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_ok",["bytes.lit","ok"]],["let","k_ctx",["bytes.lit","ctx"]],["let","v_ok",["ext.data_model.value_bool",1]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",2]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_ok"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_ok"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_ok"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_ok"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_ctx"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_ctx"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","ctx_val"]]]],["set","entries",["vec_u8.extend_bytes","entries","ctx_val"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["std.mcp.auth.rs_v1._json_from_value_v1",["bytes.view","map_val"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._ok_pack_v1","params":[{"name":"ctx_val","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","k_md",["bytes.lit","resource_metadata_url"]],["let","doc_b",["ext.json.data_model.parse","rs_pack"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["bytes.alloc",0]],0],["let","root",["ext.data_model.root_offset","doc"]],["std.mcp.auth.rs_v1._map_string_or_empty_v1","doc","root",["bytes.view","k_md"]]],"kind":"defn","name":"std.mcp.auth.rs_v1._resource_md_from_rs_pack_v1","params":[{"name":"rs_pack","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["std.mcp.auth.rs_v1._validate_string_seq_v1","doc","seq_off"],0],["return",0],0],["let","n",["ext.data_model.seq_len","doc","seq_off"]],["for","i",0,"n",["begin",["let","off",["ext.data_model.seq_get","doc","seq_off","i"]],["if",["<","off",0],0,["if",["begin",["let","tok",["ext.data_model.string_get","doc","off"]],["=",["bytes.eq",["bytes.view","tok"],"needle"],1]],["return",1],0]],0]],0],"kind":"defn","name":"std.mcp.auth.rs_v1._seq_string_contains_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"seq_off","ty":"i32"},{"name":"needle","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<","seq_off",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","doc","seq_off"],4],["return",0],0],["let","n",["ext.data_model.seq_len","doc","seq_off"]],["if",["<","n",0],["return",0],0],["for","i",0,"n",["begin",["let","it",["ext.data_model.seq_get","doc","seq_off","i"]],["if",["<","it",0],["return",0],0],["if",["!=",["ext.data_model.kind_at","doc","it"],3],["return",0],0],0]],1],"kind":"defn","name":"std.mcp.auth.rs_v1._validate_string_seq_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"seq_off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","cfg_json",["std.mcp.auth.rs_v1._oauth_cfg_from_rs_pack_v1","rs_pack"]],["let","resource_md_url",["std.mcp.auth.rs_v1._resource_md_from_rs_pack_v1","rs_pack"]],["if",["=",["bytes.len",["bytes.view","cfg_json"]],0],["return",["bytes.alloc",0]],0],["if",["=",["bytes.len",["bytes.view","resource_md_url"]],0],["return",["bytes.alloc",0]],0],["let","hdr_name0",["bytes.lit","Authorization"]],["let","hdr_name1",["bytes.lit","authorization"]],["let","authz",["std.mcp.auth.rs_v1._headers_get_v1","req_headers_json",["bytes.view","hdr_name0"],["bytes.view","hdr_name1"]]],["let","authz_probe",["view.to_bytes",["bytes.view","authz"]]],["if",["=",["bytes.len",["bytes.view","authz_probe"]],0],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",0]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]],["begin",["let","token",["std.mcp.auth.bearer_v1.parse_authorization_bearer_v1",["bytes.view","authz"]]],["let","token_probe",["view.to_bytes",["bytes.view","token"]]],["if",["=",["bytes.len",["bytes.view","token_probe"]],0],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",1]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]],["begin",["let","cfg_canon",["ext.json.canon.canonicalize",["bytes.view","cfg_json"]]],["if",["=",["bytes.len",["bytes.view","cfg_canon"]],0],["return",["bytes.alloc",0]],0],["let","cfg_doc_b",["ext.json.data_model.parse",["bytes.view","cfg_canon"]]],["let","cfg_doc",["bytes.view","cfg_doc_b"]],["if",["=",["ext.data_model.doc_is_err","cfg_doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","cfg_doc"],5],["return",["bytes.alloc",0]],0],["let","cfg_root",["ext.data_model.root_offset","cfg_doc"]],["let","kind",["std.mcp.auth.rs_v1._cfg_validation_kind_v1","cfg_doc","cfg_root"]],["let","kind_test_static",["bytes.lit","test_static"]],["let","kind_intro",["bytes.lit","introspection_v1"]],["let","kind_probe",["view.to_bytes",["bytes.view","kind"]]],["if",["=",["bytes.eq",["bytes.view","kind_probe"],["bytes.view","kind_test_static"]],1],["begin",["let","ctx_val",["std.mcp.auth.rs_v1._auth_test_static_ctx_or_empty_v1","cfg_doc","cfg_root",["bytes.view","token"]]],["let","ctx_probe",["view.to_bytes",["bytes.view","ctx_val"]]],["if",[">",["bytes.len",["bytes.view","ctx_probe"]],0],["std.mcp.auth.rs_v1._ok_pack_v1",["bytes.view","ctx_val"]],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",2]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]]]],["if",["=",["bytes.eq",["bytes.view","kind"],["bytes.view","kind_intro"]],1],["begin",["let","resp_json",["std.mcp.auth.introspection_v1.introspection_call_v1",["bytes.view","cfg_json"],["bytes.view","token"]]],["let","resp_probe",["view.to_bytes",["bytes.view","resp_json"]]],["if",["=",["bytes.len",["bytes.view","resp_probe"]],0],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",2]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]],["begin",["let","val_json",["std.mcp.auth.introspection_v1.introspection_validate_v1",["bytes.view","cfg_json"],["bytes.view","resp_json"]]],["let","val_doc_b",["ext.json.data_model.parse",["bytes.view","val_json"]]],["let","val_doc",["bytes.view","val_doc_b"]],["if",["=",["ext.data_model.doc_is_err","val_doc"],1],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.root_kind","val_doc"],5],["return",["bytes.alloc",0]],0],["let","val_root",["ext.data_model.root_offset","val_doc"]],["let","k_active",["bytes.lit","active"]],["let","active_off",["ext.data_model.map_find","val_doc","val_root",["bytes.view","k_active"]]],["let","active",["if",["if",[">=","active_off",0],["=",["ext.data_model.kind_at","val_doc","active_off"],1],0],["ext.data_model.bool_get","val_doc","active_off"],0]],["if",["=","active",0],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",2]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]],["begin",["let","k_sub",["bytes.lit","sub"]],["let","k_scope_json",["bytes.lit","scope_json"]],["let","k_aud_json",["bytes.lit","aud_json"]],["let","sub",["std.mcp.auth.rs_v1._map_string_or_empty_v1","val_doc","val_root",["bytes.view","k_sub"]]],["let","scope_json",["std.mcp.auth.rs_v1._map_string_or_empty_v1","val_doc","val_root",["bytes.view","k_scope_json"]]],["let","aud_json",["std.mcp.auth.rs_v1._map_string_or_empty_v1","val_doc","val_root",["bytes.view","k_aud_json"]]],["let","aud_probe",["view.to_bytes",["bytes.view","aud_json"]]],["if",["=",["std.mcp.auth.rs_v1._introspection_audience_ok_v1","cfg_doc","cfg_root",["bytes.view","aud_probe"]],0],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",2]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]],["begin",["let","ctx_val",["std.mcp.auth.rs_v1._ctx_val_v1",["bytes.view","sub"],["bytes.view","scope_json"],["bytes.view","aud_json"]]],["std.mcp.auth.rs_v1._ok_pack_v1",["bytes.view","ctx_val"]]]]]]]]],["begin",["let","www",["std.mcp.auth.bearer_v1.build_www_authenticate_bearer_v1",["bytes.view","resource_md_url"],"required_scope_text",1]],["std.mcp.auth.rs_v1._err_pack_v1",401,["bytes.view","www"]]]]]]]]]],"kind":"defn","name":"std.mcp.auth.rs_v1.oauth2_authenticate_http_v1","params":[{"name":"rs_pack","ty":"bytes_view"},{"name":"req_headers_json","ty":"bytes_view"},{"name":"required_scope_text","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","doc_b",["ext.json.data_model.parse","ctx_pack"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",0],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",0],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_scopes_json",["bytes.lit","scopes_json"]],["let","scopes_json",["std.mcp.auth.rs_v1._map_string_or_empty_v1","doc","root",["bytes.view","k_scopes_json"]]],["let","required_scopes_json",["std.mcp.auth.scopes_v1.parse_scope_str_v1","required_scope_text"]],["std.mcp.auth.scopes_v1.scopes_satisfy_all_v1",["bytes.view","scopes_json"],["bytes.view","required_scopes_json"]]],"kind":"defn","name":"std.mcp.auth.rs_v1.oauth2_authorize_scopes_v1","params":[{"name":"ctx_pack","ty":"bytes_view"},{"name":"required_scope_text","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","canon",["ext.json.canon.canonicalize","oauth_cfg_json"]],["if",["=",["bytes.len",["bytes.view","canon"]],0],["return",["result_bytes.err",9100]],0],["let","doc_b",["ext.json.data_model.parse",["bytes.view","canon"]]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",["result_bytes.err",9101]],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",["result_bytes.err",9102]],0],["let","root",["ext.data_model.root_offset","doc"]],["let","k_resource",["bytes.lit","resource"]],["let","resource_off",["ext.data_model.map_find","doc","root",["bytes.view","k_resource"]]],["if",["<","resource_off",0],["return",["result_bytes.err",9103]],0],["if",["!=",["ext.data_model.kind_at","doc","resource_off"],3],["return",["result_bytes.err",9104]],0],["let","resource",["ext.data_model.string_get","doc","resource_off"]],["let","candidates_json",["std.mcp.auth.prm_v1.prm_url_candidates_from_resource_v1",["bytes.view","resource"]]],["if",["=",["bytes.len",["bytes.view","candidates_json"]],0],["return",["result_bytes.err",9105]],0],["let","cand_doc_b",["ext.json.data_model.parse",["bytes.view","candidates_json"]]],["let","cand_doc",["bytes.view","cand_doc_b"]],["if",["=",["ext.data_model.doc_is_err","cand_doc"],1],["return",["result_bytes.err",9106]],0],["if",["!=",["ext.data_model.root_kind","cand_doc"],5],["return",["result_bytes.err",9107]],0],["let","cand_root",["ext.data_model.root_offset","cand_doc"]],["let","k_primary",["bytes.lit","primary"]],["let","k_root",["bytes.lit","root"]],["let","primary_url",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cand_doc","cand_root",["bytes.view","k_primary"]]],["let","root_url",["std.mcp.auth.rs_v1._map_string_or_empty_v1","cand_doc","cand_root",["bytes.view","k_root"]]],["if",["=",["bytes.len",["bytes.view","primary_url"]],0],["return",["result_bytes.err",9108]],0],["if",["=",["bytes.len",["bytes.view","root_url"]],0],["return",["result_bytes.err",9109]],0],["let","prm_json",["std.mcp.auth.prm_v1.build_prm_doc_v1",["bytes.view","canon"]]],["if",["=",["bytes.len",["bytes.view","prm_json"]],0],["return",["result_bytes.err",9110]],0],["let","k_serve_root_alias",["bytes.lit","serve_root_alias"]],["let","serve_root_alias",["std.mcp.auth.rs_v1._map_bool_or_default_v1","doc","root",["bytes.view","k_serve_root_alias"],1]],["let","k_oauth_cfg_json",["bytes.lit","oauth_cfg_json"]],["let","k_resource_md",["bytes.lit","resource_metadata_url"]],["let","k_resource_md_root",["bytes.lit","resource_metadata_root_url"]],["let","k_prm_json",["bytes.lit","prm_json"]],["let","k_resource_out",["bytes.lit","resource"]],["let","k_root_alias_out",["bytes.lit","serve_root_alias"]],["let","v_cfg",["ext.data_model.value_string",["bytes.view","canon"]]],["let","v_md",["ext.data_model.value_string",["bytes.view","primary_url"]]],["let","v_md_root",["ext.data_model.value_string",["bytes.view","root_url"]]],["let","v_prm",["ext.data_model.value_string",["bytes.view","prm_json"]]],["let","v_resource",["ext.data_model.value_string",["bytes.view","resource"]]],["let","v_root_alias",["ext.data_model.value_bool","serve_root_alias"]],["let","entries",["vec_u8.with_capacity",1024]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",6]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_oauth_cfg_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_oauth_cfg_json"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_cfg"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_cfg"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_resource_md"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_resource_md"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_md"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_md"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_resource_md_root"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_resource_md_root"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_md_root"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_md_root"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_prm_json"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_prm_json"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_prm"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_prm"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_resource_out"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_resource_out"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_resource"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_resource"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","k_root_alias_out"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","k_root_alias_out"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len",["bytes.view","v_root_alias"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.view","v_root_alias"]]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["let","json",["std.mcp.auth.rs_v1._json_from_value_v1",["bytes.view","map_val"]]],["if",["=",["bytes.len",["bytes.view","json"]],0],["result_bytes.err",9111],["result_bytes.ok","json"]]],"kind":"defn","name":"std.mcp.auth.rs_v1.oauth2_rs_from_oauth_cfg_v1","params":[{"name":"oauth_cfg_json","ty":"bytes_view"}],"result":"result_bytes"}],"imports":["ext.data_model","ext.data_model.json","ext.json.canon","ext.json.data_model","std.bytes","std.codec","std.fmt","std.mcp.auth.bearer_v1","std.mcp.auth.introspection_v1","std.mcp.auth.prm_v1","std.mcp.auth.scopes_v1"],"kind":"module","module_id":"std.mcp.auth.rs_v1","schema_version":"x07.x07ast@0.5.0"}
