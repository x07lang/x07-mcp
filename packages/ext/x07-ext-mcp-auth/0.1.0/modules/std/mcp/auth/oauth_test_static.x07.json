{"decls":[{"kind":"export","names":["std.mcp.auth.oauth_test_static.verify_status_v1"]},{"body":["begin",["let","n",["view.len","authorization_header"]],["if",["<=","n",7],["return",["bytes.alloc",0]],0],["let","prefix",["bytes.lit","Bearer "]],["let","head",["view.slice","authorization_header",0,7]],["if",["=",["view.eq","head",["bytes.view","prefix"]],0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","authorization_header",7,["-","n",7]]]],"kind":"defn","name":"std.mcp.auth.oauth_test_static._extract_bearer_token_v1","params":[{"name":"authorization_header","ty":"bytes_view"}],"result":"bytes"},{"body":["if",["=","c",32],1,["if",["=","c",9],1,0]],"kind":"defn","name":"std.mcp.auth.oauth_test_static._is_ws_v1","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<","map_off",0],["return",["bytes.alloc",0]],0],["let","off",["ext.data_model.map_find","doc","map_off","key"]],["if",["<","off",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","doc","off"],3],["return",["bytes.alloc",0]],0],["ext.data_model.string_get","doc","off"]],"kind":"defn","name":"std.mcp.auth.oauth_test_static._map_string_or_empty_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","required_scopes"]],["if",["<=","n",0],["return",1],0],["let","i",0],["for","_",0,"n",["begin",["set","i",["std.mcp.auth.oauth_test_static._skip_ws_v1","required_scopes","i"]],["if",[">=","i","n"],["return",1],0],["let","end",["std.mcp.auth.oauth_test_static._token_end_v1","required_scopes","i"]],["let","tok_len",["-","end","i"]],["if",[">","tok_len",0],["begin",["let","token",["view.slice","required_scopes","i","tok_len"]],["if",["=",["std.mcp.auth.oauth_test_static._scope_contains_v1","granted_scopes","token"],0],["return",0],0],0],0],["set","i",["+","end",1]],0]],1],"kind":"defn","name":"std.mcp.auth.oauth_test_static._scope_contains_all_v1","params":[{"name":"granted_scopes","ty":"bytes_view"},{"name":"required_scopes","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","scope_len",["view.len","scope"]],["if",["<=","scope_len",0],["return",1],0],["let","n",["view.len","scopes_text"]],["if",["<=","n",0],["return",0],0],["let","i",0],["for","_",0,"n",["begin",["set","i",["std.mcp.auth.oauth_test_static._skip_ws_v1","scopes_text","i"]],["if",[">=","i","n"],["return",0],0],["let","end",["std.mcp.auth.oauth_test_static._token_end_v1","scopes_text","i"]],["let","tok_len",["-","end","i"]],["if",["if",["=","tok_len","scope_len"],["=",["std.bytes.cmp_range","scopes_text","i","tok_len","scope",0,"scope_len"],0],0],["return",1],0],["set","i",["+","end",1]],0]],0],"kind":"defn","name":"std.mcp.auth.oauth_test_static._scope_contains_v1","params":[{"name":"scopes_text","ty":"bytes_view"},{"name":"scope","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","text"]],["let","i","start"],["for","_",0,"n",["begin",["if",[">=","i","n"],["return","i"],0],["if",["=",["std.mcp.auth.oauth_test_static._is_ws_v1",["view.get_u8","text","i"]],1],["set","i",["+","i",1]],["return","i"]],0]],"i"],"kind":"defn","name":"std.mcp.auth.oauth_test_static._skip_ws_v1","params":[{"name":"text","ty":"bytes_view"},{"name":"start","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","text"]],["let","i","start"],["for","_",0,"n",["begin",["if",[">=","i","n"],["return","i"],0],["if",["=",["std.mcp.auth.oauth_test_static._is_ws_v1",["view.get_u8","text","i"]],1],["return","i"],["set","i",["+","i",1]]],0]],"i"],"kind":"defn","name":"std.mcp.auth.oauth_test_static._token_end_v1","params":[{"name":"text","ty":"bytes_view"},{"name":"start","ty":"i32"}],"result":"i32"},{"body":["begin",["let","k_validation",["bytes.lit","validation"]],["let","k_static_tokens",["bytes.lit","static_tokens"]],["let","k_token",["bytes.lit","token"]],["let","k_scope",["bytes.lit","scope"]],["let","token",["std.mcp.auth.oauth_test_static._extract_bearer_token_v1","authorization_header"]],["if",["<=",["bytes.len","token"],0],["return",401],0],["let","doc_b",["ext.json.data_model.parse","oauth_doc_json"]],["let","doc",["bytes.view","doc_b"]],["if",["=",["ext.data_model.doc_is_err","doc"],1],["return",401],0],["if",["!=",["ext.data_model.root_kind","doc"],5],["return",401],0],["let","root",["ext.data_model.root_offset","doc"]],["let","validation_off",["ext.data_model.map_find","doc","root",["bytes.view","k_validation"]]],["if",["<","validation_off",0],["return",401],0],["let","tokens_off",["ext.data_model.map_find","doc","validation_off",["bytes.view","k_static_tokens"]]],["if",["<","tokens_off",0],["return",401],0],["if",["!=",["ext.data_model.kind_at","doc","tokens_off"],4],["return",401],0],["let","n",["ext.data_model.seq_len","doc","tokens_off"]],["if",["<","n",0],["return",401],0],["for","i",0,"n",["begin",["let","item_off",["ext.data_model.seq_get","doc","tokens_off","i"]],["if",["<","item_off",0],0,["begin",["if",["!=",["ext.data_model.kind_at","doc","item_off"],5],0,["begin",["let","candidate",["std.mcp.auth.oauth_test_static._map_string_or_empty_v1","doc","item_off",["bytes.view","k_token"]]],["if",["=",["bytes.eq",["bytes.view","candidate"],["bytes.view","token"]],1],["begin",["if",["<=",["view.len","required_scope_text"],0],["return",200],0],["let","granted",["std.mcp.auth.oauth_test_static._map_string_or_empty_v1","doc","item_off",["bytes.view","k_scope"]]],["if",["=",["std.mcp.auth.oauth_test_static._scope_contains_all_v1",["bytes.view","granted"],"required_scope_text"],1],["return",200],["return",403]]],0],0]],0]],0]],401],"kind":"defn","name":"std.mcp.auth.oauth_test_static.verify_status_v1","params":[{"name":"oauth_doc_json","ty":"bytes_view"},{"name":"authorization_header","ty":"bytes_view"},{"name":"required_scope_text","ty":"bytes_view"}],"result":"i32"}],"imports":["ext.data_model","ext.json.data_model","std.bytes"],"kind":"module","module_id":"std.mcp.auth.oauth_test_static","schema_version":"x07.x07ast@0.5.0"}
