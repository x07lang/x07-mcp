{
  "schema_version": "x07.arch.manifest@0.1.0",
  "repo": { "id": "x07-mcp", "root": "." },
  "externals": {
    "allowed_import_prefixes": ["std.", "ext."],
    "allowed_exact": ["mcp.user"]
  },
  "nodes": [
    {
      "id": "mcp_auth_pure",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-auth/*/modules/**/*.x07.json"]
      },
      "world": "solve-pure",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": ["std.os."], "allow_prefixes": [] }
    },
    {
      "id": "mcp_core_pure",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-core/*/modules/**/*.x07.json"]
      },
      "world": "solve-pure",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": ["std.os."], "allow_prefixes": [] }
    },
    {
      "id": "mcp_toolkit_fs",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-toolkit/*/modules/**/*.x07.json"]
      },
      "world": "solve-fs",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": [], "allow_prefixes": [] }
    },
    {
      "id": "mcp_worker_fs",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-worker/*/modules/**/*.x07.json"]
      },
      "world": "solve-fs",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": ["std.os."], "allow_prefixes": [] }
    },
    {
      "id": "mcp_sandbox_os",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-sandbox/*/modules/**/*.x07.json"]
      },
      "world": "run-os",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": [], "allow_prefixes": [] }
    },
    {
      "id": "mcp_obs_os",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-obs/*/modules/**/*.x07.json"]
      },
      "world": "run-os",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": [], "allow_prefixes": [] }
    },
    {
      "id": "mcp_transport_stdio_os",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-transport-stdio/*/modules/**/*.x07.json"]
      },
      "world": "run-os",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": [], "allow_prefixes": [] }
    },
    {
      "id": "mcp_transport_http_os",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-transport-http/*/modules/**/*.x07.json"]
      },
      "world": "run-os",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": [], "allow_prefixes": [] }
    },
    {
      "id": "mcp_rr_fs",
      "match": {
        "module_prefixes": [],
        "path_globs": ["packages/ext/x07-ext-mcp-rr/*/modules/**/*.x07.json"]
      },
      "world": "run-os",
      "visibility": { "mode": "public", "visible_to": [] },
      "imports": { "deny_prefixes": ["std.os."], "allow_prefixes": [] }
    }
  ],
  "rules": [
    {
      "kind": "layers_v1",
      "id": "layers.main_v1",
      "layers": [
        "mcp_core_pure",
        "mcp_auth_pure",
        "mcp_toolkit_fs",
        "mcp_worker_fs",
        "mcp_sandbox_os",
        "mcp_obs_os",
        "mcp_transport_stdio_os",
        "mcp_transport_http_os",
        "mcp_rr_fs"
      ],
      "direction": "down"
    },
    { "kind": "deny_cycles_v1", "id": "deny_cycles.nodes_v1", "scope": "nodes" }
  ],
  "checks": {
    "deny_cycles": true,
    "deny_orphans": true,
    "enforce_visibility": false,
    "enforce_world_caps": true,
    "brand_boundary_v1": { "enabled": false },
    "allowlist_mode": {
      "enabled": true,
      "default_allow_external": true,
      "default_allow_internal": false
    }
  },
  "tool_budgets": {
    "max_modules": 5000,
    "max_edges": 50000,
    "max_diags": 2000,
    "contracts_budgets": { "max_contract_files": 2000, "max_contract_bytes": 67108864 }
  },
  "contracts_v1": {
    "rr": {
      "index_path": "arch/rr/index.x07rr.json",
      "gen_dir": "arch/rr",
      "require_policy_for_os_calls": true
    },
    "budgets": {
      "index_path": "arch/budgets/index.x07budgets.json",
      "gen_dir": "arch/budgets/gen",
      "require_scopes": false
    },
    "canonical_json": { "mode": "jcs_rfc8785_v1" }
  }
}
