{
  "schema_version": "x07.x07ast@0.5.0",
  "kind": "module",
  "module_id": "mcp.user",
  "imports": [
    "std.mcp.diag",
    "std.mcp.tool.result"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "mcp.user.call_tool_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "mcp.user.call_tool_v1",
      "params": [
        {
          "name": "tool_name",
          "ty": "bytes_view"
        },
        {
          "name": "ctx_json",
          "ty": "bytes_view"
        },
        {
          "name": "args_json",
          "ty": "bytes_view"
        }
      ],
      "result": "bytes",
      "body": [
        "begin",
        [
          "let",
          "t1",
          [
            "bytes.lit",
            "stripe.list_customers"
          ]
        ],
        [
          "let",
          "t2",
          [
            "bytes.lit",
            "stripe.get_customer"
          ]
        ],
        [
          "let",
          "diag_invalid_args",
          [
            "std.mcp.diag.code_invalid_args_v1"
          ]
        ],
        [
          "let",
          "ok1",
          [
            "bytes.lit",
            "stripe_list_customers_ok"
          ]
        ],
        [
          "let",
          "ok2",
          [
            "bytes.lit",
            "stripe_get_customer_ok"
          ]
        ],
        [
          "let",
          "err_text",
          [
            "bytes.lit",
            "unknown tool"
          ]
        ],
        [
          "let",
          "err_detail",
          [
            "bytes.lit",
            "{}"
          ]
        ],
        [
          "if",
          [
            "=",
            [
              "bytes.eq",
              "tool_name",
              [
                "bytes.view",
                "t1"
              ]
            ],
            1
          ],
          [
            "return",
            [
              "std.mcp.tool.result.ok_text_v1",
              [
                "bytes.view",
                "ok1"
              ]
            ]
          ],
          0
        ],
        [
          "if",
          [
            "=",
            [
              "bytes.eq",
              "tool_name",
              [
                "bytes.view",
                "t2"
              ]
            ],
            1
          ],
          [
            "return",
            [
              "std.mcp.tool.result.ok_text_v1",
              [
                "bytes.view",
                "ok2"
              ]
            ]
          ],
          0
        ],
        [
          "std.mcp.tool.result.err_v1",
          [
            "bytes.view",
            "diag_invalid_args"
          ],
          [
            "bytes.view",
            "err_text"
          ],
          [
            "bytes.view",
            "err_detail"
          ]
        ]
      ]
    }
  ]
}
